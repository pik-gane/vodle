;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-install-serviceworker",ev:"0.1",l:!0,f:function(t,e){(()=>{var{hasOwnProperty:e,toString:r}=Object.prototype;function n(t,e){void 0===e&&(e=t.hasAttribute("hidden")),e?t.removeAttribute("hidden"):t.setAttribute("hidden","")}var i=self.AMP_CONFIG||{},s=("string"==typeof i.thirdPartyFrameRegex?new RegExp(i.thirdPartyFrameRegex):i.thirdPartyFrameRegex)||/^d-\d+\.ampproject\.net$/,o=("string"==typeof i.cdnProxyRegex?new RegExp(i.cdnProxyRegex):i.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function c(t){if(!self.document||!self.document.head)return null;if(self.location&&o.test(self.location.origin))return null;const e=self.document.head.querySelector(`meta[name="${t}"]`);return e&&e.getAttribute("content")||null}var a={thirdParty:i.thirdPartyUrl||"https://3p.ampproject.net",thirdPartyFrameHost:i.thirdPartyFrameHost||"ampproject.net",thirdPartyFrameRegex:s,cdn:i.cdnUrl||c("runtime-host")||"https://cdn.ampproject.org",cdnProxyRegex:o,localhostRegex:/^https?:\/\/localhost(:\d+)?$/,errorReporting:i.errorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r",betaErrorReporting:i.betaErrorReportingUrl||"https://us-central1-amp-error-reporting.cloudfunctions.net/r-beta",localDev:i.localDev||!1,trustedViewerHosts:[/(^|\.)google\.(com?|[a-z]{2}|com?\.[a-z]{2}|cat)$/,/(^|\.)gmail\.(com|dev)$/],geoApi:i.geoApiUrl||c("amp-geo-api")};self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var l=self.__AMP_LOG;function u(t){return l.user||(l.user=h()),function(t,e){return e&&e.ownerDocument.defaultView!=t}(l.user.win,t)?l.userForEmbed||(l.userForEmbed=h()):l.user}function h(t){return function(t,e){throw new Error("failed to call initLogConstructor")}()}function f(t,e,r,n,i,s,o,c,a,l,u){return t}function d(t,e,r,n,i,s,o,c,a,l,h){return u().assert(t,e,r,n,i,s,o,c,a,l,h)}function p(t,e){return g(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),e)}function m(t){return t.nodeType?(e=t,r=(e.ownerDocument||e).defaultView,p(r,"ampdoc")).getAmpDoc(t):t;var e,r}function v(t){const e=m(t);return e.isSingleDoc()?e.win:e}function g(t,e){f(w(t,e));const r=function(t){let e=t.__AMP_SERVICES;return e||(e=t.__AMP_SERVICES={}),e}(t)[e];return r.obj||(f(r.ctor),f(r.context),r.obj=new r.ctor(r.context),f(r.obj),r.context=null,r.resolve&&r.resolve(r.obj)),r.obj}function w(t,e){const r=t.__AMP_SERVICES&&t.__AMP_SERVICES[e];return!(!r||!r.ctor)}var P,_=t=>function(t,e){return g(v(m(t)),e)}(t,"documentInfo").get(),A=t=>function(t,e){const r=v(m(t));return w(r,e)?g(r,e):null}(t,"url");function b(t){const e=t.indexOf("#");return-1==e?t:t.substring(0,e)}new Set(["c","v","a","ad"]);var k="amp-install-serviceworker",R=class extends t.BaseElement{constructor(t){var e;super(t),this.Xw=null,this.Yw=null,this.tk=(e=this.win,p(e,"platform")).isSafari()}buildCallback(){const{win:t}=this;if(!("serviceWorker"in t.navigator))return void this.ek();const e=this.mA(),r=this.element.getAttribute("src");if(e.assertHttpsUrl(r,this.element),!e.isProxyOrigin(r)&&!e.isProxyOrigin(t.location.href)||this.tk)e.parse(t.location.href).origin==e.parse(r).origin?this.rk().then((()=>function(t,e,r){const n={};return r.hasAttribute("data-scope")&&(n.scope=r.getAttribute("data-scope")),t.navigator.serviceWorker.register(e,n).then((function(e){const n=e.installing;return n?n.addEventListener("statechange",(n=>{"activated"===n.target.state&&I(e,t,r)})):e.active&&I(e,t,r),e}),(function(t){u().error(k,"ServiceWorker registration failed:",t)}))}(this.win,r,this.element))):this.user().error(k,"Did not install ServiceWorker because it does not match the current origin: "+r);else{const t=this.element.getAttribute("data-iframe-src");if(t){e.assertHttpsUrl(t,this.element);const{origin:r}=e.parse(t),n=_(this.element),i=e.parse(n.sourceUrl),s=e.parse(n.canonicalUrl);d(r==i.origin||r==s.origin,"data-iframe-src (%s) should be a URL on the same origin as the source (%s) or canonical URL (%s) of the AMP-document.",r,i.origin,s.origin),this.Xw=t,this.rk().then((()=>this.nk()))}}(e.isProxyOrigin(r)||e.isProxyOrigin(t.location.href))&&this.tk&&this.user().error(k,"Did not install ServiceWorker because of safari double keyring caching as it will not have any effect")}rk(){return Promise.all([this.loadPromise(this.win),this.getAmpDoc().whenFirstVisible()])}nk(){return this.mutateElement((()=>{n(this.element,!1);const t=this.win.document.createElement("iframe");t.setAttribute("sandbox","allow-same-origin allow-scripts"),t.src=this.Xw,this.element.appendChild(t)}))}ek(){if(!this.getAmpDoc().isSingleDoc())return;const t=this.getAmpDoc(),{win:e}=this,r=this.mA(),n=r.parse(e.location.href),i=this.element.getAttribute("data-no-service-worker-fallback-url-match");let s,o=this.element.getAttribute("data-no-service-worker-fallback-shell-url");if(i||o){d(i&&o,'Both, "%s" and "%s" must be specified for url-rewrite',"data-no-service-worker-fallback-url-match","data-no-service-worker-fallback-shell-url"),o=b(o);try{s=new RegExp(i)}catch(t){throw u().createError('Invalid "data-no-service-worker-fallback-url-match" expression',t)}d(r.getSourceOrigin(n)==r.parse(o).origin,'Shell source origin "%s" must be the same as source origin "%s"',o,n.href),this.Yw=new y(t,s,o,this.element),r.isSecure(o)&&this.ik(o)}}ik(t){return this.rk().then((()=>{this.mutateElement((()=>this.sk(t)))}))}sk(t){const{win:e}=this,r=e.document.createElement("iframe");r.id="i-amphtml-shell-preload",r.setAttribute("src",t+"#preload"),n(r,!1),r.setAttribute("sandbox","allow-scripts allow-same-origin"),this.loadPromise(r).then((()=>{var t,e;null===(e=(t=r).parentElement)||void 0===e||e.removeChild(t)})),this.element.appendChild(r)}mA(){return A(this.element)}},y=class{constructor(t,e,r,n){this.win=t.win,this.ck=e,this.ak=r,this.lk=A(n),this.uk=this.lk.parse(r),function(t,e,r,n){!function(t,e,r,n){let i=t,s=r;const o=function(){if(void 0!==P)return P;P=!1;try{const t={get capture(){return P=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return P}();i.addEventListener("click",(t=>{try{return s(t)}catch(t){var e,r;throw null===(e=(r=self).__AMP_REPORT_ERROR)||void 0===e||e.call(r,t),t}}),!!o&&n)}(t,0,r,void 0)}(t.getRootNode(),0,this.wc.bind(this))}wc(t){if(t.defaultPrevented)return;const e=(r=t.target).closest?r.closest("A"):function(t,e,r){let n;for(n=t;n&&void 0!==n;n=n.parentElement)if(e(n))return n;return null}(r,(t=>function(t,e){const r=t.matches||t.webkitMatchesSelector||t.mozMatchesSelector||t.msMatchesSelector||t.oMatchesSelector;return!!r&&r.call(t,"A")}(t)));var r;if(!e||!e.href)return;const n=this.lk.parse(e.href);if(n.origin!=this.uk.origin||n.pathname==this.uk.pathname||!this.ck.test(n.href))return;if(e.getAttribute("i-amphtml-orig-href"))return;const{win:i}=this;b(n.href)!=b(i.location.href)&&(e.setAttribute("i-amphtml-orig-href",e.href),e.href=this.ak+"#href="+encodeURIComponent(`${n.pathname}${n.search}${n.hash}`))}};function I(t,e,r){!function(t,e){if("performance"in t){const r=t.performance.getEntriesByType("resource").filter((t=>"script"===t.initiatorType&&t.name.startsWith(a.cdn))).map((t=>t.name)),n=e.active;n.postMessage&&n.postMessage(JSON.stringify({"type":"AMP__FIRST-VISIT-CACHING","payload":r}))}}(e,t),r.hasAttribute("data-prefetch")&&function(t,e){const{document:r}=e,n=[].map.call(r.querySelectorAll("a[data-rel=prefetch]"),(t=>t.href));if(function(t){const e=t.createElement("link");return!(!e.relList||!e.relList.supports)&&e.relList.supports("prefetch")}(r))n.forEach((t=>{const e=r.createElement("link");e.setAttribute("rel","prefetch"),e.setAttribute("href",t),r.head.appendChild(e)}));else{const e=t.active;e.postMessage&&e.postMessage(JSON.stringify({"type":"AMP__LINK-PREFETCH","payload":n}))}}(t,e)}t.registerElement(k,R)})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */}});
//# sourceMappingURL=amp-install-serviceworker-0.1.mjs.map