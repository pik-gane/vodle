{"version":3,"file":"worker.nodom.js","sources":["../../../output/worker-thread/strings.js","../../../output/worker-thread/phase.js","../../../output/worker-thread/nodes.js","../../../output/worker-thread/MutationTransfer.js","../../../output/worker-thread/amp/amp.js","../../../output/worker-thread/function.js","../../../output/worker-thread/dom/DocumentStub.js","../../../output/worker-thread/amp/delete-globals.js","../../../output/worker-thread/Storage.js","../../../output/worker-thread/initialize-storage.js","../../../output/worker-thread/index.nodom.amp.js"],"sourcesContent":["let count = 0;\nlet transfer = [];\nconst mapping = new Map();\n/**\n * Stores a string in mapping and returns the index of the location.\n * @param value string to store\n * @return location in map\n */\nexport function store(value) {\n    // Server version of the lib never transfers.\n    if (process.env.SERVER) {\n        return 0;\n    }\n    if (mapping.has(value)) {\n        // Safe to cast since we verified the mapping contains the value\n        return mapping.get(value);\n    }\n    mapping.set(value, count);\n    transfer.push(value);\n    return count++;\n}\n/**\n * Retrieve the index for a string (mostly used for tests).\n * @param value string value we need to know the index of\n * @returns index in the map for the string\n */\nexport function getForTesting(value) {\n    return mapping.get(value);\n}\nexport function getForTestingPartial(value) {\n    const found = Array.from(mapping.keys()).find((str) => str.includes(value));\n    if (found) {\n        return mapping.get(found);\n    }\n}\n/**\n * Returns strings registered but not yet transferred.\n * Side effect: Resets the transfer array to default value, to prevent passing the same values multiple times.\n */\nexport function consume() {\n    const strings = transfer;\n    transfer = [];\n    return strings;\n}\n//# sourceMappingURL=strings.js.map","export let phase = 0 /* Initializing */;\nexport const set = (newPhase) => (phase = newPhase);\n//# sourceMappingURL=phase.js.map","import { phase } from './phase';\nlet count = 0;\nlet transfer = [];\nconst mapping = new Map();\n/**\n * Override the store for a node during the initialization phase.\n * @param node Node to store and modify with index\n * @param override Override number to use as the identifier.\n *\n * NOTE: THIS IS ONLY TO BE USED DURING INITIALIZATION.\n */\nexport function storeOverride(node, override) {\n    // Server version of the lib never transfers.\n    if (process.env.SERVER) {\n        return 0;\n    }\n    if (phase === 0 /* Initializing */) {\n        mapping.set((node[7 /* index */] = override), node);\n        count = Math.max(count, override);\n    }\n    return override;\n}\n/**\n * Stores a node in mapping, and makes the index available on the Node directly.\n * @param node Node to store and modify with index\n * @return index Node was stored with in mapping\n */\nexport function store(node) {\n    // Server version of the lib never transfers.\n    if (process.env.SERVER) {\n        return 0;\n    }\n    if (node[7 /* index */] !== undefined) {\n        return node[7 /* index */];\n    }\n    mapping.set((node[7 /* index */] = ++count), node);\n    if (phase > 0 /* Initializing */) {\n        // After Initialization, include all future dom node creation into the list for next transfer.\n        transfer.push(node);\n    }\n    return count;\n}\n/**\n * Retrieves a node based on an index.\n * @param index location in map to retrieve a Node for\n * @return either the Node represented in index position, or null if not available.\n */\nexport function get(index) {\n    // mapping has a 1 based index, since on first store we ++count before storing.\n    return (!!index && mapping.get(index)) || null;\n}\n/**\n * Returns nodes registered but not yet transferred.\n * Side effect: Resets the transfer array to default value, to prevent passing the same values multiple times.\n */\nexport function consume() {\n    const copy = transfer;\n    transfer = [];\n    return copy;\n}\n//# sourceMappingURL=nodes.js.map","import { consume as consumeNodes } from './nodes';\nimport { consume as consumeStrings } from './strings';\nimport { phase, set as setPhase } from './phase';\nlet pending = false;\nlet pendingMutations = [];\n// TODO(choumx): Change `mutation` to Array<Uint16> to prevent casting errors e.g. integer underflow, precision loss.\nexport function transfer(document, mutation) {\n    if (process.env.SERVER) {\n        return;\n    }\n    if (phase > 0 /* Initializing */ && document[58 /* allowTransfer */]) {\n        pending = true;\n        pendingMutations = pendingMutations.concat(mutation);\n        Promise.resolve().then((_) => {\n            if (pending) {\n                const nodes = new Uint16Array(consumeNodes().reduce((acc, node) => acc.concat(node[8 /* creationFormat */]), [])).buffer;\n                const mutations = new Uint16Array(pendingMutations).buffer;\n                document.postMessage({\n                    [54 /* phase */]: phase,\n                    [12 /* type */]: phase === 2 /* Mutating */ ? 3 /* MUTATE */ : 2 /* HYDRATE */,\n                    [37 /* nodes */]: nodes,\n                    [41 /* strings */]: consumeStrings(),\n                    [36 /* mutations */]: mutations,\n                }, [nodes, mutations]);\n                pendingMutations = [];\n                pending = false;\n                setPhase(2 /* Mutating */);\n            }\n        });\n    }\n}\n//# sourceMappingURL=MutationTransfer.js.map","import { store } from '../strings';\nimport { transfer } from '../MutationTransfer';\nexport class AMP {\n    document;\n    constructor(document) {\n        this.document = document;\n    }\n    /**\n     * Returns a promise that resolves with the value of `key`.\n     * @param key\n     */\n    getState(key = '') {\n        return new Promise((resolve) => {\n            const messageHandler = (event) => {\n                const message = event.data;\n                if (message[12 /* type */] !== 11 /* GET_STORAGE */) {\n                    return;\n                }\n                // TODO: There is a race condition here if there are multiple concurrent\n                // getState(k) messages in flight, where k is the same value.\n                const storageMessage = message;\n                if (storageMessage[74 /* storageKey */] !== key) {\n                    return;\n                }\n                this.document.removeGlobalEventListener('message', messageHandler);\n                const value = storageMessage[21 /* value */];\n                resolve(value);\n            };\n            this.document.addGlobalEventListener('message', messageHandler);\n            transfer(this.document, [12 /* STORAGE */, 1 /* GET */, 2 /* AmpState */, /* key */ store(key), /* value */ 0]);\n            setTimeout(resolve, 500, null); // TODO: Why a magical constant, define and explain.\n        });\n    }\n    /**\n     * Deep-merges `state` into the existing state.\n     * @param state\n     */\n    setState(state) {\n        // Stringify `state` so it can be post-messaged as a transferrable.\n        let stringified;\n        try {\n            stringified = JSON.stringify(state);\n        }\n        catch (e) {\n            throw new Error(`AMP.setState only accepts valid JSON as input.`);\n        }\n        transfer(this.document, [12 /* STORAGE */, 2 /* SET */, 2 /* AmpState */, /* key */ 0, /* value */ store(stringified)]);\n    }\n}\n//# sourceMappingURL=amp.js.map","import { transfer } from './MutationTransfer';\nimport { store } from './strings';\nconst exportedFunctions = {};\nexport function callFunctionMessageHandler(event, document) {\n    const msg = event.data;\n    if (msg[12 /* type */] !== 12 /* FUNCTION */) {\n        return;\n    }\n    const functionMessage = msg;\n    const fnIdentifier = functionMessage[77 /* functionIdentifier */];\n    const fnArguments = JSON.parse(functionMessage[78 /* functionArguments */]);\n    const index = functionMessage[7 /* index */];\n    const fn = exportedFunctions[fnIdentifier];\n    if (!fn) {\n        transfer(document, [\n            13 /* FUNCTION_CALL */,\n            2 /* REJECT */,\n            index,\n            store(JSON.stringify(`[worker-dom]: Exported function \"${fnIdentifier}\" could not be found.`)),\n        ]);\n        return;\n    }\n    Promise.resolve(fn) // Forcing promise flows allows us to skip a try/catch block.\n        .then((f) => f.apply(null, fnArguments))\n        .then((value) => {\n        transfer(document, [13 /* FUNCTION_CALL */, 1 /* RESOLVE */, index, store(JSON.stringify(value))]);\n    }, (err) => {\n        const errorMessage = JSON.stringify(err.message || err);\n        transfer(document, [\n            13 /* FUNCTION_CALL */,\n            2 /* REJECT */,\n            index,\n            store(JSON.stringify(`[worker-dom]: Function \"${fnIdentifier}\" threw: \"${errorMessage}\"`)),\n        ]);\n    });\n}\nexport function exportFunction(name, fn) {\n    if (!name || name === '') {\n        throw new Error(`[worker-dom]: Attempt to export function was missing an identifier.`);\n    }\n    if (typeof fn !== 'function') {\n        throw new Error(`[worker-dom]: Attempt to export non-function failed: (\"${name}\", ${typeof fn}).`);\n    }\n    if (name in exportedFunctions) {\n        throw new Error(`[worker-dom]: Attempt to re-export function failed: \"${name}\".`);\n    }\n    exportedFunctions[name] = fn;\n}\nexport function resetForTesting() {\n    for (const key of Object.keys(exportedFunctions)) {\n        delete exportedFunctions[key];\n    }\n}\n//# sourceMappingURL=function.js.map","import { set as setPhase } from '../phase';\n/**\n * A lightweight Document stub for the no-dom amp binary.\n */\nexport class DocumentStub {\n    // Internal variables.\n    defaultView;\n    postMessage;\n    addGlobalEventListener;\n    removeGlobalEventListener;\n    [58 /* allowTransfer */] = true;\n    [7 /* index */] = -1;\n    constructor() {\n        this.defaultView = { document: this };\n    }\n    [59 /* observe */]() {\n        setPhase(2 /* Mutating */);\n    }\n}\n//# sourceMappingURL=DocumentStub.js.map","const ALLOWLISTED_GLOBALS = {\n    Array: true,\n    ArrayBuffer: true,\n    BigInt: true,\n    BigInt64Array: true,\n    BigUint64Array: true,\n    Boolean: true,\n    Cache: true,\n    CustomEvent: true,\n    DataView: true,\n    Date: true,\n    Error: true,\n    EvalError: true,\n    Event: true,\n    EventTarget: true,\n    Float32Array: true,\n    Float64Array: true,\n    Function: true,\n    Infinity: true,\n    Int16Array: true,\n    Int32Array: true,\n    Int8Array: true,\n    Intl: true,\n    JSON: true,\n    Map: true,\n    Math: true,\n    NaN: true,\n    Number: true,\n    Object: true,\n    Promise: true,\n    Proxy: true,\n    RangeError: true,\n    ReferenceError: true,\n    Reflect: true,\n    RegExp: true,\n    Set: true,\n    String: true,\n    Symbol: true,\n    SyntaxError: true,\n    TextDecoder: true,\n    TextEncoder: true,\n    TypeError: true,\n    URIError: true,\n    URL: true,\n    Uint16Array: true,\n    Uint32Array: true,\n    Uint8Array: true,\n    Uint8ClampedArray: true,\n    WeakMap: true,\n    WeakSet: true,\n    WebAssembly: true,\n    WebSocket: true,\n    XMLHttpRequest: true,\n    atob: true,\n    addEventListener: true,\n    removeEventListener: true,\n    btoa: true,\n    caches: true,\n    clearInterval: true,\n    clearTimeout: true,\n    console: true,\n    decodeURI: true,\n    decodeURIComponent: true,\n    document: true,\n    encodeURI: true,\n    encodeURIComponent: true,\n    escape: true,\n    fetch: true,\n    indexedDB: true,\n    isFinite: true,\n    isNaN: true,\n    location: true,\n    navigator: true,\n    onerror: true,\n    onrejectionhandled: true,\n    onunhandledrejection: true,\n    parseFloat: true,\n    parseInt: true,\n    performance: true,\n    requestAnimationFrame: true,\n    cancelAnimationFrame: true,\n    self: true,\n    setTimeout: true,\n    setInterval: true,\n    unescape: true,\n};\n// Modify global scope by removing disallowed properties.\nexport function deleteGlobals(global) {\n    /**\n     * @param object\n     * @param property\n     * @return True if property was deleted from object. Otherwise, false.\n     */\n    const deleteUnsafe = (object, property) => {\n        if (!ALLOWLISTED_GLOBALS.hasOwnProperty(property)) {\n            try {\n                delete object[property];\n                return true;\n            }\n            catch (e) { }\n        }\n        return false;\n    };\n    // Walk up global's prototype chain and dereference non-allowlisted properties\n    // until EventTarget is reached.\n    let current = global;\n    while (current && current.constructor !== EventTarget) {\n        const deleted = [];\n        const failedToDelete = [];\n        Object.getOwnPropertyNames(current).forEach((prop) => {\n            if (deleteUnsafe(current, prop)) {\n                deleted.push(prop);\n            }\n            else {\n                failedToDelete.push(prop);\n            }\n        });\n        console.info(`Removed ${deleted.length} references from`, current, ':', deleted);\n        if (failedToDelete.length) {\n            console.info(`Failed to remove ${failedToDelete.length} references from`, current, ':', failedToDelete);\n        }\n        current = Object.getPrototypeOf(current);\n    }\n}\n//# sourceMappingURL=delete-globals.js.map","import { store } from './strings';\nimport { transfer } from './MutationTransfer';\n/**\n * @param document\n * @param location\n * @param data\n */\nexport function createStorage(document, location, data) {\n    const storage = Object.assign(Object.create(null), data);\n    // Define properties on a prototype-less object instead of a class so that\n    // it behaves more like normal objects, e.g. bracket notation and JSON.stringify.\n    const define = Object.defineProperty;\n    define(storage, 'length', {\n        get() {\n            return Object.keys(this).length;\n        },\n    });\n    define(storage, 'key', {\n        value(n) {\n            const keys = Object.keys(this);\n            return n >= 0 && n < keys.length ? keys[n] : null;\n        },\n    });\n    define(storage, 'getItem', {\n        value(key) {\n            const value = this[key];\n            return value ? value : null;\n        },\n    });\n    define(storage, 'setItem', {\n        value(key, value) {\n            const stringValue = String(value);\n            this[key] = stringValue;\n            transfer(document, [12 /* STORAGE */, 2 /* SET */, location, store(key), store(stringValue)]);\n        },\n    });\n    define(storage, 'removeItem', {\n        value(key) {\n            delete this[key];\n            transfer(document, [\n                12 /* STORAGE */,\n                2 /* SET */,\n                location,\n                store(key),\n                0, // value == 0 represents deletion.\n            ]);\n        },\n    });\n    define(storage, 'clear', {\n        value() {\n            Object.keys(this).forEach((key) => {\n                delete this[key];\n            });\n            transfer(document, [\n                12 /* STORAGE */,\n                2 /* SET */,\n                location,\n                0,\n                0, // value == 0 represents deletion.\n            ]);\n        },\n    });\n    return storage;\n}\n//# sourceMappingURL=Storage.js.map","import { createStorage } from './Storage';\nexport function initializeStorage(document, localStorageInit, sessionStorageInit) {\n    const window = document.defaultView;\n    if (localStorageInit.storage) {\n        window.localStorage = createStorage(document, 0 /* Local */, localStorageInit.storage);\n    }\n    else {\n        console.warn(localStorageInit.errorMsg);\n    }\n    if (sessionStorageInit.storage) {\n        window.sessionStorage = createStorage(document, 1 /* Session */, sessionStorageInit.storage);\n    }\n    else {\n        console.warn(sessionStorageInit.errorMsg);\n    }\n}\n//# sourceMappingURL=initialize-storage.js.map","import { AMP } from './amp/amp';\nimport { callFunctionMessageHandler, exportFunction } from './function';\nimport { DocumentStub } from './dom/DocumentStub';\nimport { deleteGlobals } from './amp/delete-globals';\nimport { initializeStorage } from './initialize-storage';\nconst noop = () => void 0;\nexport const workerDOM = (function (postMessage, addEventListener, removeEventListener) {\n    const document = new DocumentStub();\n    // TODO(choumx): Avoid polluting Document's public API.\n    document.postMessage = postMessage;\n    document.addGlobalEventListener = addEventListener;\n    document.removeGlobalEventListener = removeEventListener;\n    return document.defaultView;\n})(postMessage.bind(self) || noop, addEventListener.bind(self) || noop, removeEventListener.bind(self) || noop);\n// Modify global scope by removing disallowed properties.\ndeleteGlobals(self);\n// Offer APIs like AMP.setState() on the global scope.\nself.AMP = new AMP(workerDOM.document);\n// Allows for function invocation\nself.exportFunction = exportFunction;\naddEventListener('message', (evt) => callFunctionMessageHandler(evt, workerDOM.document));\nexport const hydrate = (document, strings, hydrateableNode, cssKeys, globalEventHandlerKeys, size, localStorageInit, sessionStorageInit) => {\n    initializeStorage(document, localStorageInit, sessionStorageInit);\n};\n//# sourceMappingURL=index.nodom.amp.js.map"],"names":["transfer","consumeNodes","setPhase"],"mappings":"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"}