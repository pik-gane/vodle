{"version":3,"file":"src_app_previewpoll_previewpoll_module_ts.js","mappings":"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","sources":["./src/app/previewpoll/previewpoll-routing.module.ts","./src/app/previewpoll/previewpoll.module.ts","./src/app/previewpoll/previewpoll.page.ts"],"sourcesContent":["/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { PreviewpollPage } from './previewpoll.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PreviewpollPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class PreviewpollPageRoutingModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { PreviewpollPageRoutingModule } from './previewpoll-routing.module';\n\nimport { PreviewpollPage } from './previewpoll.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    PreviewpollPageRoutingModule,\n    TranslateModule.forChild()\n  ],\n  declarations: [PreviewpollPage]\n})\nexport class PreviewpollPageModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { TranslateService } from '@ngx-translate/core';\n\nimport { GlobalService } from \"../global.service\";\nimport { Poll } from '../poll.service';\n\n@Component({\n  selector: 'app-previewpoll',\n  templateUrl: './previewpoll.page.html',\n  styleUrls: ['./previewpoll.page.scss'],\n})\nexport class PreviewpollPage implements OnInit {\n\n  Object = Object;\n  page = \"previewpoll\";\n\n  pid: string;\n  p: Poll;\n\n  // LIFECYCLE:\n\n  ready = false;  \n  \n  constructor(\n      public router: Router,\n      private route: ActivatedRoute,\n      public translate: TranslateService,\n      public G: GlobalService) {\n    this.G.L.entry(\"PreviewpollPage.constructor\");\n    this.route.params.subscribe( params => { \n      this.pid = params['pid'];\n    } );\n  }\n\n  ngOnInit() {\n    this.G.L.entry(\"PreviewpollPage.ngOnInit\");\n  }\n\n  ionViewWillEnter() {\n    this.G.L.entry(\"PreviewpollPage.ionViewWillEnter\");\n    this.G.D.page = this;\n  }\n\n  ionViewDidEnter() {\n    this.G.L.entry(\"PreviewpollPage.ionViewDidEnter\");\n    if (this.G.D.ready) {\n      this.onDataReady();\n    }\n    this.G.L.debug(\"PreviewpollPage.ready:\", this.ready);\n  }\n\n  onDataReady() {\n    // called when DataService initialization was slower than view initialization\n    this.G.L.entry(\"PreviewpollPage.onDataReady\");\n    if (this.pid in this.G.P.polls) {\n      this.p = this.G.P.polls[this.pid];\n      this.p.set_due();\n      this.G.P.update_ref_date();\n      if (this.p.state == 'draft') {\n        this.G.L.info(\"PreviewpollPage showing existing draft\", this.pid);\n      } else {\n        this.G.L.warn(\"DraftpollPage non-draft pid ignored, redirecting to mypolls page\", this.pid);\n        this.router.navigate([\"/mypolls\"]);\n        return;\n      }\n    } else {\n      this.G.L.warn(\"PreviewpollPage unknown pid ignored, redirecting to mypolls page\", this.pid, this.G.P.polls);\n      this.router.navigate([\"/mypolls\"]);\n      return;\n    }\n    this.ready = true;\n  }\n\n  ionViewDidLeave() {\n    this.G.L.entry(\"PreviewpollPage.ionViewDidLeave\");\n    this.G.D.save_state();\n    this.G.L.exit(\"PreviewpollPage.ionViewDidLeave\");\n  }\n\n  // HOOKS:\n\n  publish_button_clicked() {\n    this.G.L.entry(\"PreviewpollPage.publish_button_clicked\");\n    // TODO: \n    // - again check that due is in future!\n    // - show spinner while busy!\n    // fix db credentials:\n    this.p.set_db_credentials();\n    // generate a random poll password:\n    this.p.init_password();\n    // register the user herself as a voter in the poll:\n    this.p.init_myvid();\n    this.p.start_date = new Date();\n    // wait for these changes to user db to be finished before continuing!\n    this.G.D.wait_for_user_db().finally(() => {\n      // set state to running, which will cause the poll data to be stored in the designated server:\n      this.p.state = 'running';\n      // wait for these changes to poll db to be finished before continuing!\n      this.G.D.wait_for_poll_db(this.pid).finally(() => {\n        // NO LONGER: set own ratings to zero:\n        // this.p.init_myratings();\n        this.p.creator = this.G.S.email;\n        // if test, register simulated voters:\n        this.G.L.trace(\"PreviewpollPage.publish_button_clicked poll is_test\", this.p.is_test, this.G.D.getp(this.pid, 'is_test'));\n        if (this.p.is_test) {\n          for (const oid of this.p.oids) {\n            const ratings = JSON.parse(this.G.D.getp(this.pid, 'simulated_ratings.'+oid));\n            if (Array.isArray(ratings)) {\n              this.G.L.trace(\"PreviewpollPage.publish_button_clicked registering simulated voters...\");\n              for (const i in ratings) {\n                const vid = \"simulated\"+i,\n                      r = ratings[i];\n                this.G.D.setv_in_polldb(this.pid, 'rating.'+oid, r, vid);\n                this.G.P.update_own_rating(this.pid, vid, oid, r, false);\n                this.G.L.trace(\"PreviewpollPage.publish_button_clicked registered simulated voter\", i);\n              }\n            }\n          }\n          this.p.tally_all();\n        }\n        // go to invitation page:\n        this.router.navigate(['/inviteto/'+this.pid]);\n        this.G.L.exit(\"PreviewpollPage.publish_button_clicked\");\n      });\n    });\n  }\n\n}\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}