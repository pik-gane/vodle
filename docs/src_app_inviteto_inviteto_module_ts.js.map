{"version":3,"file":"src_app_inviteto_inviteto_module_ts.js","mappings":"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","sources":["./src/app/inviteto/inviteto-routing.module.ts","./src/app/inviteto/inviteto.module.ts","./src/app/inviteto/inviteto.page.ts","./node_modules/@capacitor/share/dist/esm/definitions.js","./node_modules/@capacitor/share/dist/esm/index.js"],"sourcesContent":["/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { InvitetoPage } from './inviteto.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: InvitetoPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class InvitetoPageRoutingModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { InvitetoPageRoutingModule } from './inviteto-routing.module';\n\nimport { InvitetoPage } from './inviteto.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    InvitetoPageRoutingModule,\n    TranslateModule.forChild()\n  ],\n  declarations: [InvitetoPage]\n})\nexport class InvitetoPageModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { TranslateService } from '@ngx-translate/core';\n\nimport { Capacitor } from '@capacitor/core';\nimport { Share } from '@capacitor/share';\nimport { LocalNotifications } from '@capacitor/local-notifications';\n\nimport { GlobalService } from \"../global.service\";\nimport { Poll } from '../poll.service';\n\nimport { environment } from '../../environments/environment';\n\n@Component({\n  selector: 'app-inviteto',\n  templateUrl: './inviteto.page.html',\n  styleUrls: ['./inviteto.page.scss'],\n})\nexport class InvitetoPage implements OnInit {\n\n  pid: string;\n  p: Poll;\n  came_from_preview: boolean;\n  details_expanded: boolean;\n  invite_link: string;\n  message_title: string;\n  message_body: string;\n  email_href: string;\n  can_use_web_share: boolean;\n  can_share: boolean;\n\n  // LIFECYCLE:\n\n  ready = false;  \n\n  constructor(\n    public router: Router,\n    private route: ActivatedRoute,\n    public translate: TranslateService,\n    public G: GlobalService) {\n    this.G.L.entry(\"InvitetoPage.constructor\");\n    this.route.params.subscribe( params => { \n      this.pid = params['pid'];\n    } );\n  }\n\n  ngOnInit() {\n    this.G.L.entry(\"InvitetoPage.ngOnInit\");\n  }\n\n  ionViewWillEnter() {\n    this.G.L.entry(\"InvitetoPage.ionViewWillEnter\");\n    this.G.D.page = this;\n    this.came_from_preview = true; // TODO: set depending on url!\n    this.details_expanded = false;\n    this.can_use_web_share = (typeof navigator.share === \"function\");\n    this.can_share = Capacitor.isNativePlatform() || this.can_use_web_share;\n  }\n\n  ionViewDidEnter() {\n    this.G.L.entry(\"InvitetoPage.ionViewDidEnter\");\n    if (this.G.D.ready) {\n      this.onDataReady();\n    }\n    this.G.L.debug(\"InvitetoPage.ready:\", this.ready);\n  }\n\n  onDataReady() {\n    // called when DataService initialization was slower than view initialization\n    this.G.L.entry(\"InvitetoPage.onDataReady\");\n    if (this.pid in this.G.P.polls) {\n      this.p = this.G.P.polls[this.pid];\n      if (this.p.state == 'draft') {\n        this.G.L.warn(\"InvitetoPage called for draft poll, redirecting to mypolls page\", this.pid);\n        this.router.navigate([\"/mypolls\"]);\n      } \n    } else {\n      this.G.L.warn(\"InvitetoPage unknown pid ignored, redirecting to mypolls page\", this.pid, this.G.P.polls);\n      this.router.navigate([\"/mypolls\"]);\n    }\n    this.invite_link = (\n      environment.magic_link_base_url + \"joinpoll/\" \n      + encodeURIComponent(this.p.db_server_url) + \"/\" \n      + encodeURIComponent(this.p.db_password) + \"/\" \n      + this.pid + \"/\" \n      + this.p.password);\n    this.G.L.info(\"InvitetoPage invite link:\", this.invite_link);\n    // TODO: make indentation in body work:\n    this.message_title = this.translate.instant('invite-email.subject', {due: this.G.D.format_date(this.p.due)});\n    this.message_body = (this.translate.instant('invite-email.body-greeting') + \"\\n\\n\" \n                + this.translate.instant('invite-email.body-before-title') + \"\\n\\n\"\n                + String.fromCharCode(160).repeat(4) + this.p.title + \".\\n\\n\"\n                + this.translate.instant('invite-email.body-closes', {due: this.G.D.format_date(this.p.due)}) + \"\\n\\n\"\n                + this.translate.instant('invite-email.body-before-link') + \"\\n\\n\" \n                + String.fromCharCode(160).repeat(4) + this.invite_link + \"\\n\\n\"\n                + this.translate.instant('invite-email.body-dont-share') + \"\\n\\n\"\n                + this.translate.instant('invite-email.body-regards'));\n    this.email_href = \"mailto:?subject=\" + encodeURIComponent(this.message_title) + \"&body=\" + encodeURIComponent(this.message_body);\n    this.ready = true;\n  }\n\n  ionViewDidLeave() {\n    this.G.L.entry(\"InvitetoPage.ionViewDidLeave\");\n    this.G.D.save_state();\n    this.G.L.exit(\"InvitetoPage.ionViewDidLeave\");\n  }\n  \n  // HOOKS:\n\n  share_button_clicked() {\n    this.G.L.entry(\"InvitetoPage.share_button_clicked\");\n    Share.share({\n      title: this.message_title,\n      text: this.message_body,\n//      url: this.invite_link, // not added since contained in body, otherwise will appear twice...\n      dialogTitle: 'Share vodle invite link',\n    }).then(res => {\n      this.G.L.info(\"InvitetoPage.share_button_clicked succeeded\", res);\n    }).catch(err => {\n      this.G.L.error(\"InvitetoPage.share_button_clicked failed\", err);\n    });\n/*\n    try {\n      navigator.share({ title: title, url: this.invite_link })\n      .then(() => {\n        console.log(\"Data was shared successfully\");\n      }).catch(err => {\n      console.error(\"Share failed:\", err);\n      });\n    } catch (err) {\n      console.error(\"Share not invoked:\", err);\n    }\n*/\n  }\n\n  copy_button_clicked() {\n    this.G.L.entry(\"InvitetoPage.copy_button_clicked\");\n    window.navigator.clipboard.writeText(this.invite_link);\n    LocalNotifications.schedule({\n      notifications: [{\n        title: this.translate.instant(\"inviteto.notification-copied-link-title\"),\n        body: this.translate.instant(\"inviteto.notification-copied-link-body\"),\n        id: null\n      }]\n    })\n    .then(res => {\n      this.G.L.trace(\"InvitetoPage.copy_button_clicked localNotifications.schedule succeeded:\", res);\n    }).catch(err => {\n      this.G.L.warn(\"InvitetoPage.copy_button_clicked localNotifications.schedule failed:\", err);\n    });\n    this.G.L.exit(\"InvitetoPage.copy_button_clicked\");\n  }\n}\n","export {};\n","import { registerPlugin } from '@capacitor/core';\nconst Share = registerPlugin('Share', {\n    web: () => import('./web').then(m => new m.ShareWeb()),\n});\nexport * from './definitions';\nexport { Share };\n"],"names":["registerPlugin","Share","web","then","m","ShareWeb"],"sourceRoot":"webpack:///","x_google_ignoreList":[3,4]}