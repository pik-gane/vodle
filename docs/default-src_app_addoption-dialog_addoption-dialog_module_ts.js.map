{"version":3,"file":"default-src_app_addoption-dialog_addoption-dialog_module_ts.js","mappings":"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","sources":["./src/app/addoption-dialog/addoption-dialog-routing.module.ts","./src/app/addoption-dialog/addoption-dialog.module.ts","./src/app/addoption-dialog/addoption-dialog.page.ts","./src/app/sharedcomponents/unique-form-validator.ts"],"sourcesContent":["/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { AddoptionDialogPage } from './addoption-dialog.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: AddoptionDialogPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class AddoptionDialogPageRoutingModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { AddoptionDialogPageRoutingModule } from './addoption-dialog-routing.module';\n\nimport { AddoptionDialogPage } from './addoption-dialog.page';\nexport { AddoptionDialogPage } from './addoption-dialog.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ReactiveFormsModule,\n    AddoptionDialogPageRoutingModule,\n    TranslateModule.forChild()\n  ],\n  declarations: [AddoptionDialogPage],\n  exports: [AddoptionDialogPage]\n})\nexport class AddoptionDialogPageModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { Component, OnInit, Input, ChangeDetectorRef, ViewChild } from '@angular/core';\nimport { Validators, UntypedFormBuilder, UntypedFormGroup, UntypedFormControl, ValidationErrors, AbstractControl } from '@angular/forms';\nimport { IonInput, PopoverController } from '@ionic/angular';\nimport { LocalNotifications } from '@capacitor/local-notifications';\nimport { TranslateService } from '@ngx-translate/core';\n\nimport { unique_name_validator$ } from '../sharedcomponents/unique-form-validator';\nimport { Observable, of } from 'rxjs';\n\nimport { Capacitor } from '@capacitor/core';\n//import { Share } from '@capacitor/share';\n//import { LocalNotifications } from '@capacitor/local-notifications';\n\nimport { environment } from '../../environments/environment';\nimport { GlobalService } from \"../global.service\";\nimport { PollPage } from '../poll/poll.module';  \nimport { Poll, Option } from '../poll.service';\n\n@Component({\n  selector: 'app-addoption-dialog',\n  templateUrl: './addoption-dialog.page.html',\n  styleUrls: ['./addoption-dialog.page.scss'],\n})\nexport class AddoptionDialogPage implements OnInit {\n\n  E = environment;\n  \n  @Input() parent: PollPage;\n\n  ready = false;\n\n//  can_use_web_share: boolean;\n//  can_share: boolean;\n\n  formGroup: UntypedFormGroup;\n\n  p: Poll;\n  poll_link: string;\n  message_title: string;\n  message_body: string;\n  mailto_url: string;\n\n  constructor(\n    public formBuilder: UntypedFormBuilder, \n    private popover: PopoverController,\n    public G: GlobalService,\n    public translate: TranslateService,\n    private ref: ChangeDetectorRef\n  ) { \n  }\n\n  ngOnInit() {\n  }\n\n  ionViewWillEnter() {\n//    this.can_use_web_share = (typeof navigator.share === \"function\");\n//    this.can_share = Capacitor.isNativePlatform() || this.can_use_web_share;\n\n    this.p = this.parent.p;\n\n    this.formGroup = this.formBuilder.group({});\n    this.formGroup.addControl('option_name', new UntypedFormControl(\"\", [Validators.required], [unique_name_validator$(of(this.p.oids.map(oid => this.p.options[oid].name)))]));\n    this.formGroup.addControl('option_desc', new UntypedFormControl(\"\"));\n    this.formGroup.addControl('option_url', new UntypedFormControl(\"\", Validators.pattern(this.G.urlRegex)));\n\n    this.ready = true;\n  }\n\n  @ViewChild('focus_element', { static: false }) focus_element: IonInput;\n\n  ionViewDidEnter() {\n    setTimeout(() => this.focus_element.setFocus(), 100);\n  }\n\n  isAddButtonDisabled(): boolean {\n      // Combine both conditions here\n      return !this.formGroup.valid || !this.p.can_add_option();\n    }\n\n  OK_button_clicked() {\n    if (!this.isAddButtonDisabled()) {\n      /** add the option */\n      const name = this.formGroup.get('option_name').value,\n            desc = this.formGroup.get('option_desc').value,\n            url = this.formGroup.get('option_url').value,\n            o = new Option(this.G, this.p, null, name, desc, url);\n      LocalNotifications.schedule({\n        notifications: [{\n          title: this.translate.instant(\"addoption.notification-added-title\"),\n          body: name,\n          id: 0\n        }]\n      })\n      .then(res => {\n      }).catch(err => {\n      });\n      if (this.parent.delegation_status == 'agreed') {\n        this.G.Del.update_my_delegation(this.p.pid, o.oid, true);\n      }\n      this.p.set_my_own_rating(o.oid, this.G.S.default_wap);\n      this.parent.oidsorted.push(o.oid);\n      this.parent.sortingcounter++;\n      this.ref.detectChanges();\n      // need to wait a little for the view to refresh:\n      setTimeout(() => {\n        this.p.tally_all();\n        this.popover.dismiss();\n      }, 200);\n    }\n  }\n\n  ClosePopover()\n  {\n    this.popover.dismiss();\n  }\n\n  validation_messages = {\n    'option_name': [\n      { type: 'required', message: 'validation.option-name-required' },\n      { type: 'not_unique', message: 'validation.option-name-unique' },\n    ],\n    'option_desc': [\n    ],\n    'option_url': [\n      { type: 'pattern', message: 'validation.option-url-valid' },\n    ]\n  }\n\n  // SHARING OPTIONS, NOT YET ACTIVE:\n/*\n  compose_message() {\n    this.poll_link = environment.magic_link_base_url + \"poll/\" + this.p.pid;\n    this.message_body = (this.translate.instant('delegation-request.message-body-greeting') + \"\\n\\n\" \n                + this.translate.instant('delegation-request.message-body-before-title') + \"\\n\\n\"\n                + String.fromCharCode(160).repeat(4) + this.p.title + \".\\n\\n\"\n                + this.translate.instant('delegation-request.message-body-closes', {due: this.G.D.format_date(this.p.due)}) + \"\\n\\n\"\n                + this.translate.instant('delegation-request.message-body-explanation') + \"\\n\\n\" \n                + this.translate.instant('delegation-request.message-body-before-link') + \"\\n\\n\" \n                + this.translate.instant('delegation-request.message-body-dont-share') + \"\\n\\n\"\n                + this.translate.instant('delegation-request.message-body-regards'));\n  }\n\n  share_button_clicked() {\n    this.G.L.entry(\"AddoptionDialogPage.share_button_clicked\");\n    this.compose_message();\n    Share.share({\n      title: this.message_title,\n      text: this.message_body,\n//      url: this.poll_link,\n      dialogTitle: 'Share vodle delegation link',\n    }).then(res => {\n      this.G.L.info(\"AddoptionDialogPage.share_button_clicked succeeded\", res);\n      this.popover.dismiss();\n    }).catch(err => {\n      this.G.L.error(\"AddoptionDialogPage.share_button_clicked failed\", err);\n    });\n  }\n\n  copy_button_clicked() {\n    this.G.L.entry(\"AddoptionDialogPage.copy_button_clicked\");\n    this.compose_message();\n    window.navigator.clipboard.writeText(this.poll_link);\n    LocalNotifications.schedule({\n      notifications: [{\n        title: this.translate.instant(\"delegation-request.notification-copied-link-title\"),\n        body: this.translate.instant(\"delegation-request.notification-copied-link-body\", \n                                     {nickname: this.formGroup.get('delegate_nickname').value}),\n        id: null\n      }]\n    })\n    .then(res => {\n      this.G.L.trace(\"AddoptionDialogPage.copy_button_clicked localNotifications.schedule succeeded:\", res);\n    }).catch(err => {\n      this.G.L.warn(\"AddoptionDialogPage.copy_button_clicked localNotifications.schedule failed:\", err);\n    });\n    this.popover.dismiss();\n    this.G.L.exit(\"AddoptionDialogPage.copy_button_clicked\");\n  }\n\n  email_button_clicked(ev: MouseEvent) {\n    this.G.L.entry(\"AddoptionDialogPage.email_button_clicked\");\n    this.compose_message();\n    this.popover.dismiss();\n    this.G.L.exit(\"AddoptionDialogPage.email_button_clicked\");\n  }\n*/\n\n}\n","import {\n  AbstractControl,\n  ValidationErrors,\n  AsyncValidatorFn,\n} from \"@angular/forms\";\nimport { Observable, of } from \"rxjs\";\nimport { map, take } from \"rxjs/operators\";\n\n/** The option-name has to be unique */\n\nexport function unique_name_validator$(\n  value$: Observable<string[]>\n): AsyncValidatorFn {\n  return (control: AbstractControl): Observable<ValidationErrors | null> => {\n    if (!control.valueChanges || control.pristine) {\n      return of(null);\n    }\n\n    return value$.pipe(\n      map((names) => {\n        return names.includes(control.value) ? { not_unique: true } : null;\n      }),\n      take(1)\n    );\n  };\n}\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}