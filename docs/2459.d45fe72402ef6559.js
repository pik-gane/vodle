"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2459],{2459:(h,_,o)=>{o.r(_),o.d(_,{DelegationDialogPage:()=>m,DelegationDialogPageModule:()=>A});var c=o(4666),s=o(2508),g=o(8139),r=o(2004),u=o(1302),p=o(5099),f=o(8921),D=o(5568),x=o(2340),e=o(2135),k=o(2518);const y=["focus_element"];function Z(n,l){if(1&n&&(e._UZ(0,"div",18),e.ALo(1,"translate")),2&n){const t=e.oxw().$implicit;e.Q6J("innerHtml",e.lcZ(1,1,t.message),e.oJD)}}function v(n,l){if(1&n&&(e.ynx(0),e.YNc(1,Z,2,3,"div",17),e.BQk()),2&n){const t=l.$implicit,a=e.oxw(3);e.xp6(1),e.Q6J("ngIf",a.formGroup.get("delegate_nickname").hasError(t.type)&&(a.formGroup.get("delegate_nickname").dirty||a.formGroup.get("delegate_nickname").touched))}}function J(n,l){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-item",3)(2,"ion-col",4)(3,"small"),e._UZ(4,"p",5),e.ALo(5,"translate"),e.qZA()()(),e.TgZ(6,"ion-item",12)(7,"ion-button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(3);return e.KtG(i.share_button_clicked())}),e._UZ(8,"span",5),e.ALo(9,"translate"),e._uU(10,"\xa0 "),e._UZ(11,"ion-icon",19),e.qZA()(),e.BQk()}if(2&n){const t=e.oxw(3);e.xp6(4),e.Q6J("innerHtml",e.lcZ(5,3,"delegation-request.request-options-with-share"),e.oJD),e.xp6(3),e.Q6J("disabled",!t.formGroup.valid),e.xp6(1),e.Q6J("innerHtml",e.lcZ(9,5,"inviteto.share"),e.oJD)}}function b(n,l){1&n&&(e.ynx(0),e.TgZ(1,"ion-item",3)(2,"ion-col",4)(3,"small"),e._UZ(4,"p",5),e.ALo(5,"translate"),e.qZA()()(),e.BQk()),2&n&&(e.xp6(4),e.Q6J("innerHtml",e.lcZ(5,1,"delegation-request.request-options-without-share"),e.oJD))}function G(n,l){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"form",1)(2,"ion-list",2)(3,"ion-item",3)(4,"ion-col",4),e._UZ(5,"h1",5),e.ALo(6,"translate"),e._UZ(7,"p",5),e.ALo(8,"translate"),e.qZA()(),e.TgZ(9,"ion-item"),e._UZ(10,"ion-label",6),e.ALo(11,"translate"),e.TgZ(12,"ion-input",7,8),e.NdJ("ionChange",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.delegate_nickname_changed())})("ionBlur",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.delegate_nickname_changed())}),e.ALo(14,"translate"),e.qZA()(),e.TgZ(15,"div",9),e.YNc(16,v,2,1,"ng-container",10),e.qZA(),e.TgZ(17,"ion-item")(18,"small"),e._UZ(19,"ion-label",6),e.ALo(20,"translate"),e.TgZ(21,"ion-input",11),e.NdJ("ionChange",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.from_changed())})("ionBlur",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.from_changed())}),e.ALo(22,"translate"),e.qZA()()(),e.YNc(23,J,12,7,"ng-container",0),e.YNc(24,b,6,3,"ng-container",0),e.TgZ(25,"ion-item",12)(26,"ion-button",13),e.NdJ("click",function(i){e.CHM(t);const d=e.oxw(2);return e.KtG(d.email_button_clicked(i))}),e.TgZ(27,"a",14),e._UZ(28,"span",5),e.ALo(29,"translate"),e._uU(30,"\xa0 "),e._UZ(31,"ion-icon",15),e.qZA()()(),e.TgZ(32,"ion-item",12)(33,"ion-button",13),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.copy_button_clicked())}),e._UZ(34,"span",5),e.ALo(35,"translate"),e._uU(36,"\xa0 "),e._UZ(37,"ion-icon",16),e.qZA()()()(),e.BQk()}if(2&n){const t=e.oxw(2);e.xp6(1),e.Q6J("formGroup",t.formGroup),e.xp6(4),e.Q6J("innerHtml",e.lcZ(6,17,"delegation-request.header"),e.oJD),e.xp6(2),e.Q6J("innerHtml",e.lcZ(8,19,"delegation-request.intro"),e.oJD),e.xp6(3),e.Q6J("innerHtml",e.lcZ(11,21,"delegation-request.nickname-label"),e.oJD),e.xp6(2),e.Q6J("placeholder",e.lcZ(14,23,"delegation-request.nickname-placeholder"))("maxlength",t.E.max_len.name),e.xp6(4),e.Q6J("ngForOf",t.validation_messages.delegate_nickname),e.xp6(3),e.Q6J("innerHtml",e.lcZ(20,25,"delegation-request.from-label"),e.oJD),e.xp6(2),e.Q6J("placeholder",e.lcZ(22,27,"delegation-request.from-placeholder"))("maxlength",t.E.max_len.name),e.xp6(2),e.Q6J("ngIf",t.can_share),e.xp6(1),e.Q6J("ngIf",!t.can_share),e.xp6(2),e.Q6J("disabled",!t.formGroup.valid),e.xp6(1),e.Q6J("href",t.mailto_url,e.LSH),e.xp6(1),e.Q6J("innerHtml",e.lcZ(29,29,"delegation-request.compose-email"),e.oJD),e.xp6(5),e.Q6J("disabled",!t.formGroup.valid),e.xp6(1),e.Q6J("innerHtml",e.lcZ(35,31,"delegation-request.copy-link"),e.oJD)}}function P(n,l){if(1&n){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-list",2)(2,"ion-item",3),e._UZ(3,"span",5),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-item",12)(6,"ion-button",20),e.NdJ("click",function(){e.CHM(t);const i=e.oxw(2);return e.KtG(i.close())}),e._UZ(7,"span",5),e.ALo(8,"translate"),e._uU(9,"\xa0 "),e.qZA()()(),e.BQk()}2&n&&(e.xp6(3),e.Q6J("innerHtml",e.lcZ(4,2,"delegation-request.disabled"),e.oJD),e.xp6(4),e.Q6J("innerHtml",e.lcZ(8,4,"OK"),e.oJD))}function T(n,l){if(1&n&&(e.TgZ(0,"ion-content"),e.YNc(1,G,38,33,"ng-container",0),e.YNc(2,P,10,6,"ng-container",0),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.E.delegation.enabled),e.xp6(1),e.Q6J("ngIf",!t.E.delegation.enabled)}}let m=(()=>{class n{constructor(t,a,i,d){this.popover=t,this.formBuilder=a,this.translate=i,this.G=d,this.E=x.N,this.ready=!1,this.validation_messages={delegate_nickname:[{type:"required",message:"validation.delegate-nickname-required"}],from:[]}}ngOnInit(){}ionViewWillEnter(){this.can_use_web_share="function"==typeof navigator.share,this.can_share=p.dV.isNativePlatform()||this.can_use_web_share,this.formGroup=this.formBuilder.group({delegate_nickname:new s.p4("",s.kI.required),from:new s.p4(this.G.S.email)}),[this.p,this.did,this.request,this.private_key,this.agreement]=this.G.Del.prepare_delegation(this.parent.pid),this.message_title=this.translate.instant("delegation-request.message-subject",{due:this.G.D.format_date(this.p.due)}),this.update_request(),this.ready=!0}ionViewDidEnter(){setTimeout(()=>this.focus_element.setFocus(),100)}delegate_nickname_changed(){const t=this.formGroup.get("delegate_nickname").value;this.G.D.setp(this.p.pid,"del_nickname."+this.did,t),this.update_request()}from_changed(){const t=this.formGroup.get("from").value;this.G.D.setp(this.p.pid,"del_from."+this.did,t),this.set_delegation_link(t),this.update_request()}update_request(){this.G.L.entry("DelegationDialogPage.update_request"),this.mailto_url="mailto:"+encodeURIComponent(this.formGroup.get("delegate_nickname").value)+"?subject="+encodeURIComponent(this.message_title)+"&body="+encodeURIComponent(this.message_body)}ClosePopover(){this.popover.dismiss()}set_delegation_link(t){this.delegation_link=this.G.Del.get_delegation_link(this.parent.pid,this.did,t,this.private_key),this.message_body=this.translate.instant("delegation-request.message-body-greeting")+"\n\n"+this.translate.instant("delegation-request.message-body-before-title")+"\n\n"+String.fromCharCode(160).repeat(4)+this.p.title+".\n\n"+this.translate.instant("delegation-request.message-body-closes",{due:this.G.D.format_date(this.p.due)})+"\n\n"+this.translate.instant("delegation-request.message-body-explanation")+"\n\n"+this.translate.instant("delegation-request.message-body-before-link")+"\n\n"+String.fromCharCode(160).repeat(4)+this.delegation_link+"\n\n"+this.translate.instant("delegation-request.message-body-dont-share")+"\n\n"+this.translate.instant("delegation-request.message-body-regards")}share_button_clicked(){this.G.L.entry("DelegationDialogPage.share_button_clicked"),this.delegate_nickname_changed(),this.from_changed(),f.m.share({title:this.message_title,text:this.message_body,dialogTitle:"Share vodle delegation link"}).then(t=>{this.G.L.info("DelegationDialogPage.share_button_clicked succeeded",t),this.G.Del.after_request_was_sent(this.parent.pid,this.did,this.request,this.private_key,this.agreement),this.popover.dismiss()}).catch(t=>{this.G.L.error("DelegationDialogPage.share_button_clicked failed",t)})}copy_button_clicked(){this.G.L.entry("DelegationDialogPage.copy_button_clicked"),this.delegate_nickname_changed(),this.from_changed(),window.navigator.clipboard.writeText(this.delegation_link),this.G.Del.after_request_was_sent(this.parent.pid,this.did,this.request,this.private_key,this.agreement),D.s.schedule({notifications:[{title:this.translate.instant("delegation-request.notification-copied-link-title"),body:this.translate.instant("delegation-request.notification-copied-link-body",{nickname:this.formGroup.get("delegate_nickname").value}),id:null}]}).then(t=>{this.G.L.trace("DelegationDialogPage.copy_button_clicked localNotifications.schedule succeeded:",t)}).catch(t=>{this.G.L.warn("DelegationDialogPage.copy_button_clicked localNotifications.schedule failed:",t)}),this.parent.update_delegation_info(),this.popover.dismiss(),this.G.L.exit("DelegationDialogPage.copy_button_clicked")}email_button_clicked(t){this.G.L.entry("DelegationDialogPage.email_button_clicked"),this.delegate_nickname_changed(),this.from_changed(),this.G.Del.after_request_was_sent(this.parent.pid,this.did,this.request,this.private_key,this.agreement),this.parent.update_delegation_info(),this.popover.dismiss(),this.G.L.exit("DelegationDialogPage.email_button_clicked")}close(){this.popover.dismiss()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(r.Dh),e.Y36(s.QS),e.Y36(g.sK),e.Y36(k.U))},n.\u0275cmp=e.Xpm({type:n,selectors:[["app-delegation-dialog"]],viewQuery:function(t,a){if(1&t&&e.Gf(y,5),2&t){let i;e.iGM(i=e.CRH())&&(a.focus_element=i.first)}},inputs:{parent:"parent"},decls:1,vars:1,consts:[[4,"ngIf"],[3,"formGroup"],["lines","full"],["lines","none"],[1,"ion-no-padding","ion-no-margin"],[3,"innerHtml"],["position","floating","color","primary",3,"innerHtml"],["formControlName","delegate_nickname","autofocus","true","debounce","100","type","text",3,"placeholder","maxlength","ionChange","ionBlur"],["focus_element",""],[1,"validation-errors"],[4,"ngFor","ngForOf"],["formControlName","from","debounce","100","type","text",3,"placeholder","maxlength","ionChange","ionBlur"],["lines","none","text-wrap","",1,"ion-text-end"],["color","primary","slot","end","shape","round",3,"disabled","click"],["target","_top",2,"color","inherit","text-decoration","inherit",3,"href"],["name","mail-open-outline"],["name","copy-outline"],["class","error-message",3,"innerHtml",4,"ngIf"],[1,"error-message",3,"innerHtml"],["name","share-social-outline"],["color","primary","slot","end","shape","round",3,"click"]],template:function(t,a){1&t&&e.YNc(0,T,3,2,"ion-content",0),2&t&&e.Q6J("ngIf",a.ready)},dependencies:[c.sg,c.O5,s._Y,s.JJ,s.JL,s.nD,r.YG,r.wI,r.W2,r.gu,r.pK,r.Ie,r.Q$,r.q_,r.j9,s.sg,s.u,g.X$],styles:['@charset "UTF-8";']}),n})();const q=[{path:"",component:m}];let Q=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[u.Bz.forChild(q),u.Bz]}),n})(),A=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[c.ez,s.u5,r.Pc,s.UX,Q,g.aw.forChild()]}),n})()},8921:(h,_,o)=>{o.d(_,{m:()=>s});const s=(0,o(5099).fo)("Share",{web:()=>o.e(3656).then(o.bind(o,3656)).then(g=>new g.ShareWeb)})}}]);
//# sourceMappingURL=2459.d45fe72402ef6559.js.map