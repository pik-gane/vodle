{"version":3,"mappings":"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","names":["ExpandableComponent","constructor","renderer","ngAfterViewInit","this","setStyle","expandWrapper","nativeElement","expandHeight","ngOnInit","i0","selectors","ElementRef","ctx_r8","ctx_r11","ctx_r34","ctx_r40","i","ctx_r45","ctx_r51","oxw","ctx_r53","ctx_r54","ctx_r56","ctx_r57","ctx_r59","ctx_r60","ctx_r83","ctx_r85","ctx_r91","ctx_r98","ctx_r100","ctx_r101","ctx_r102","ctx_r103","ctx_r104","ctx_r105","ctx_r106","ctx_r107","ctx_r108","ctx_r109","ctx_r110","ctx_r112","ctx_r115","ctx_r117","ctx_r118","ctx_r119","ctx_r120","ctx_r121","ctx_r122","ctx_r123","PollPage","changeDetector","router","route","routerOutlet","loadingController","alertCtrl","popover","modalController","translate","G","Array","Math","Object","window","environment","PI","Set","Map","undefined","L","entry","params","subscribe","pid","ionViewWillEnter","D","page","f","ev","detectChanges","addEventListener","specs","JSON","parse","getp","details_expanded","incoming_delegation_expanded","option_expanded","exit","ionViewDidEnter","ready","onDataReady","debug","P","polls","warn","navigate","p","state","error","info","tally_all","oidsorted","T","oids_descending","update_order","setTimeout","bind","show_stats","update_delegation_info","on_delegate_toggle_change","have_seen","onDataChange","news","N","filter","ionViewWillLeave","oid","delegate","rate_yourself_toggle","set_my_own_rating","round","get_slider_value","auto_dismiss","dismiss","key","setp","stringify","ionViewDidLeave","save_state","n_indirect_clients","get_n_indirect_clients","myvid","cache","incoming_dids_caches","accepted_requests","declined_requests","did","from","url","status","push","startsWith","Del","get_my_outgoing_dids_cache","get","trace","get_delegate_nickname","agreement","get_agreement","delegation_status","update_delegation_toggles","a","accepted_oids","active_oids","has","onScroll","scroll_position","detail","scrollTop","on_rate_yourself_toggle_change","update_my_delegation","sum","b","entries","n_delegated","approval_scores_map","shares_map","approvals_map","votedfor","votes_map","oids","n_not_abstaining","share","bar","document","getElementById","pie","R","pieradius","dx","sin","two_pi","dy","cos","more_than_180_degrees_flag","approved","x","width","baseVal","valueAsString","toString","setAttribute","c","set_slider_color","get_my_proxy_rating","needle","knob","delegate_vid","get_potential_effective_delegate","rating","proxy_ratings_map","x2","cx","force","length","needs_refresh","refresh_paused","loadingElement","create","message","instant","spinner","duration","present","onDidDismiss","sortingcounter","col","l1","onRatingColPointerdown","l2","onRatingColPointerup","l3","onRatingColTouchstart","l4","onRatingColTouchup","listeners","old","removeEventListener","set","value","slidercolor","expand","get_slider","set_slider_values","slider","o","Number","apply_sliders_rating","onRatingSliderFocus","onRatingSliderChange","onRatingSliderBlur","rating_change_ended","have_acted","end_if_past_due","allow_voting","dragged_oid","pos","get_knob_pos","PointerEvent","clientX","touches","options","name","left","right","swallow_event","onRatingColClick","onBodyPointerup","onBodyTouchup","slider_rect","get_screen_coords","knob_center_x","element","getBoundingClientRect","DOMRect","stopPropagation","stopImmediatePropagation","preventDefault","checkmark_clicked","buttons","text","role","handler","delegate_dialog","event","component","DelegationDialogPage","translucent","showBackdrop","componentProps","parent","then","popoverElement","assist_dialog","modal","AssistPage","backdropDismiss","currentModal","explain_approval_dialog","ExplainApprovalPage","cssClass","swipeToClose","presentingElement","nativeEl","modalElement","revoke_delegation_dialog","nickname","console","log","revoke_delegation","add_option","AddoptionDialogPage","glossary","glossary_key","show_glossary","dismiss_glossary","IonContent","ctx","routes","path","PollPageRoutingModule","RouterModule","PollPageModule","CommonModule","FormsModule","IonicModule","SharedcomponentsModule","TranslateModule"],"sources":["./src/app/sharedcomponents/expandable/expandable.component.ts","./src/app/sharedcomponents/expandable/expandable.component.html","./src/app/poll/poll.page.html","./src/app/poll/poll.page.ts","./src/app/poll/poll-routing.module.ts","./src/app/poll/poll.module.ts"],"sourcesContent":["import { Component, OnInit, ElementRef, Renderer2, Input, ViewChild } from '@angular/core';\n\n@Component({\n  selector: 'app-expandable',\n  templateUrl: './expandable.component.html',\n  styleUrls: ['./expandable.component.scss']\n})\nexport class ExpandableComponent implements OnInit {\n\n  @ViewChild('expandWrapper', {read: ElementRef}) expandWrapper;\n  @Input('expanded') expanded;\n  @Input('expandHeight') expandHeight;\n\n  constructor(public renderer: Renderer2) {\n\n  }\n\n  ngAfterViewInit(){\n      this.renderer.setStyle(this.expandWrapper.nativeElement, 'height', this.expandHeight + 'px');    \n  }\n\n  ngOnInit() { }\n}\n","<div #expandWrapper class='expand-wrapper' [class.collapsed]=\"!expanded\">\n  <ng-content></ng-content>\n</div>","<!--\n(C) Copyright 2015â€“2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n-->\n\n<!--\n  TODO: \n  - \"fix\" slider element's absolute vertical position on screen while using it, even when note above it changes height. achieve this by automatically \"scrolling\" to compensate such layout changes.  \n-->\n\n<!--\nSuggestion\n\nvodle suggests that you look for a possible compromise between\nY\nand Z.\n\nWhy?\n\nY currently gets the share of A% of the participants, including yours.\nEither: You don't approve Z, but it gets the share of B% of the participants.\nOr: The share of another B% goes to Z.\nTogether, you might be able to agree on a better compromise with all these participants.\n\nHow?\n\nTry to find some other option X that appeals to both groups.\nMaybe this option is already on the list, or you might have to add it.\nThen suggest that all participants whose share now goes to Y or Z \nconsider giving option X a wap of more than 100-C.\nIf they all do so, then they all approve X.\nThe share of all these participants will then move to X.\nYou yourself would have to give X a wap of more than 100-C as well, of course. \nYour share will then also move to X, \nbut only if the others approve X as well.\n\nInstead of having A% Y plus B% Z, you would then have C% X (or more, if even more approve X).\n\n[Diagram: Pie A + Pie B -> Pie C for some other option X?]\n\n-->\n\n<!-- HEADER: -->\n\n<ion-header \n    (pointerup)=\"onBodyPointerup($event)\"\n    (touchup)=\"onBodyTouchup($event)\">\n  <ion-toolbar style=\"padding-right: 11px; padding-left: 16px;\">\n    <ion-buttons slot=\"start\" style=\"margin-right: 0px; margin-left: 0px; padding-left: 0px; padding-right: 0px;\">\n      <ion-menu-button style=\"padding-left: 0px!important; padding-right: 0px!important; position: relative; left: -9px;\"></ion-menu-button>\n    </ion-buttons>\n    <ion-text *ngIf=\"scroll_position < 70\" \n      style=\"font-weight: bold; font-size: larger; padding-left: 0px;\"\n      [innerHtml]=\"'poll.-page-title' | translate\">\n    </ion-text>\n    <ion-text *ngIf=\"scroll_position >= 70\"><b><i [innerHtml]=\"p.title\"></i></b></ion-text>\n    <ion-buttons slot=\"end\">\n\n      <!-- OFFLINE SIGN -->\n      <ng-container *ngIf=\"!window.navigator.onLine\">\n        <ion-icon name=\"cloud-offline-outline\" color=\"grey\"\n          style=\"position: relative; bottom: -1px;\">\n        </ion-icon>\n        <ion-icon name=\"alert-outline\" color=\"grey\">\n        </ion-icon>\n      </ng-container> \n\n      <!-- SYNCING SIGN -->\n      <ion-spinner *ngIf=\"!!p && p.syncing && window.navigator.onLine\" name=\"crescent\" color=\"grey\"></ion-spinner>\n\n      <!-- TRANSMITTED SIGN -->\n      <ion-button *ngIf=\"!!p && p.have_acted && !p.syncing && window.navigator.onLine\" class=\"ion-no-margin ion-no-padding\" fill=\"clear\" (click)=\"checkmark_clicked()\">\n        <ion-icon size=\"large\" name=\"checkmark\" color=\"grey\" slot=\"icon-only\"></ion-icon>\n      </ion-button>\n\n      <!-- DELEGATE BUTTON: -->\n      <ion-button *ngIf=\"!!p && delegation_status!='agreed' && p.allow_voting\"\n          (click)=\"delegate_dialog($event)\" \n          shape=\"round\" size=\"large\" color=\"primary\" class=\"ion-no-padding ion-no-margin\">\n        <span *ngIf=\"scroll_position < 70\"\n          [innerHtml]=\"'poll.delegate-button' | translate\">\n        </span><ion-button class=\"ion-no-margin ion-no-padding\"\n            style=\"position: relative; right: -4px;\"\n            shape=\"round\" fill=\"solid\" color=\"primary\">\n          <ion-icon class=\"ion-no-margin ion-no-padding\" src=\"./assets/icon/delegate-simple.svg\">\n          </ion-icon>\n        </ion-button>\n      </ion-button>\n\n    </ion-buttons>\n  </ion-toolbar>\n</ion-header>\n\n<!-- SCROLLABLE CONTENT: -->\n\n<ion-content *ngIf=\"ready && !!p\" \n    (pointerup)=\"onBodyPointerup($event)\"\n    [scrollEvents]=\"true\"\n    (ionScroll)=\"onScroll($event)\"    \n    >\n  <ion-list lines=\"full\" class=\"ion-no-margin ion-no-padding\">\n\n    <!-- NEWS -->\n\n    <ion-card *ngFor=\"let n of news\">\n      <ion-card-content class=\"ion-no-margin ion-no-padding\">\n        <ion-item lines=\"none\" class=\"ion-no-margin ion-no-padding item-text-wrap\" color=\"warning\">\n          &nbsp;&nbsp;\n          <ion-label class=\"ion-no-margin ion-no-padding\">\n            {{n.title}}\n            <small *ngIf=\"n.body\">\n              <br/>\n              {{n.body}}\n            </small>  \n          </ion-label>\n          <ion-button slot=\"end\" class=\"ion-no-margin ion-no-padding\" fill=\"clear\" size=\"small\" (click)=\"news.delete(n);G.N.dismiss(n.key)\">\n            <ion-icon slot=\"icon-only\" name=\"close-outline\" style=\"color:gray!important\">\n            </ion-icon>    \n          </ion-button>  \n        </ion-item>\n      </ion-card-content>\n    </ion-card>\n\n    <!-- GENERAL POLL INFORMATION -->\n\n    <ion-item color=\"primary\" class=\"ion-no-margin\" lines=\"none\">\n      <ion-grid class=\"ion-no-padding ion-no-margin\">\n        <ion-row class=\"ion-no-padding ion-no-margin\">\n          <ion-col class=\"ion-no-padding ion-no-margin\">\n\n            <!-- NOTIFY OF DIFFERENT LANGUAGE: -->\n\n            <small *ngIf=\"(!!p.language) && (p.language != G.S.language)\">\n              <p [innerHtml]=\"'poll.different-language' | translate: {language: G.S.language_names[p.language]}\"></p>\n            </small>\n\n            <!-- POLL TITLE -->\n\n            <h3><b><i [innerHtml]=\"p.title\"></i></b></h3>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n    </ion-item>\n    <ion-item *ngIf=\"(p.desc||'')!='' || (p.url||'') != ''\"\n        color=\"primary\" class=\"ion-padding-left ion-padding-right\" \n        style=\"cursor: pointer; --min-height: 0!important;\" lines=\"none\"\n        (click)=\"details_expanded =! details_expanded\">\n      <ion-grid class=\"ion-no-padding ion-padding-bottom ion-no-margin\" style=\"width: 100%;\">\n        <ion-row class=\"ion-no-padding ion-no-margin\">\n          <ion-col class=\"ion-no-padding ion-no-margin\">\n\n            <!-- POLL DESCRIPTION, \"READ MORE\" LINK -->\n\n            <div [style]=\"\n                details_expanded\n                ? 'white-space: normal; overflow: hidden; text-overflow: ellipsis; width: 100%!important;'\n                : 'white-space: nowrap; overflow: hidden; text-overflow: ellipsis; width: 100%!important;'\n                \">\n              <i *ngIf=\"(p.desc||'')!=''\" [innerHtml]=\"p.desc\"></i><span *ngIf=\"(p.desc||'')!='' && (p.url||'') != ''\">&nbsp;</span>\n              <small *ngIf=\"(p.url||'') != ''\">\n                (<span (click)=\"G.open_url_in_new_tab(G.D.fix_url(p.url));details_expanded=!details_expanded\"><ion-text \n                  class=\"externallink\"  \n                  [innerHtml]=\"'read-more' | translate\">\n                </ion-text>&nbsp;<ion-icon name=\"open-outline\" style=\"position: relative; top: 2px;\"></ion-icon></span>)\n              </small>\n              <small *ngIf=\"details_expanded\">\n                &nbsp;\n                (<ion-text \n                  class=\"externallink\" \n                  [innerHtml]=\"'hide' | translate\">\n                </ion-text>)\n              </small>\n            </div>\n\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n    </ion-item>\n    <ion-item color=\"primary\" class=\"ion-no-margin ion-padding-left ion-padding-right\" >\n      <ion-grid class=\"ion-no-padding ion-no-margin\">\n        <ion-row class=\"ion-no-padding ion-no-margin\">\n          <ion-col class=\"ion-no-padding ion-no-margin\" style=\"padding-bottom: 8px\">\n\n            <!-- ASSIST BUTTON: -->\n\n            <ion-button *ngIf=\"p.allow_voting\"\n                (click)=\"assist_dialog()\" \n                size=\"small\" fill=\"clear\" class=\"ion-float-right ion-no-padding ion-no-margin\"\n                style=\"position: relative; top: 5px; right: 10px; margin-left:20px;\">\n              <ion-label *ngIf=\"details_expanded\" style=\"color:#88e950; white-space: normal; text-align: right; font-size: 11.5px;\"\n                [innerHtml]=\"'poll.assist-me-button' | translate\">\n              </ion-label>&nbsp;<ion-button shape=\"round\" class=\"ion-no-padding ion-no-margin\" color=\"success\">\n                <ion-icon name=\"color-wand-outline\" slot=\"icon-only\" \n                  style=\"margin: 5px;\"></ion-icon>\n              </ion-button>\n            </ion-button>\n\n            <!-- CLOSING DATE, CLOSING SOON BADGE: -->\n\n            <small>\n              <span style=\"white-space: nowrap;\">\n                <ion-badge *ngIf=\"p.allow_voting && p.is_closing_soon\" \n                  class=\"ion-no-margin\" \n                  style=\"position: relative; bottom: -5.5px; font-size: 11.5px;\" \n                  color=\"danger\" \n                  [innerHtml]=\"'badges.closing-soon'|translate\">\n                </ion-badge>\n                <span *ngIf=\"p.allow_voting && !p.is_closing_soon\"\n                  [innerHtml]=\"'poll.closes' | translate\">\n                </span><span *ngIf=\"!p.allow_voting\"\n                  [innerHtml]=\"'poll.closed' | translate\">\n                </span>&nbsp;<b \n                  [innerHtml]=\"G.D.format_date(p.due)\">\n                </b>\n              </span>&nbsp;&nbsp;&nbsp;&nbsp;\n              <span style=\"white-space: nowrap;\">\n                <ion-icon color=\"light\" style=\"position: relative; top: 2px\" [name]=\"(p.type=='share')?'cut-outline':'trophy-outline'\"></ion-icon>&nbsp;<span [innerHtml]=\"((p.type=='share')?'poll.type-share':'poll.type-winner')|translate\"></span>\n              </span>\n            </small>\n            <br/>\n\n            <!-- STATISTICS: -->\n\n            <small style=\"white-space: nowrap;\">\n              <span style=\"white-space: nowrap;\">\n                <ion-icon \n                    color=\"light\" style=\"position: relative; top: 2px\" \n                    name=\"people-outline\">\n                </ion-icon>&nbsp;<b>{{p.T.n_not_abstaining}}</b>&nbsp;<span class=\"externallink\" (click)=\"glossary('non-abstaining')\" [innerHtml]=\"'non-abstaining-voters'|translate\"></span>&nbsp;&nbsp;&nbsp;\n  <!--              <ion-button\n                    class=\"ion-no-padding ion-no-margin\" fill=\"clear\" size=\"small\" \n                    [routerLink]=\"'/inviteto/'+p.pid\" >\n                  <ion-icon \n                      class=\"ion-no-padding ion-no-margin\" \n                      style=\"font-size: 14px; position: relative; top: -1px\"\n                      name=\"share-social-outline\" \n                      color=\"light\">\n                  </ion-icon>\n                </ion-button>&nbsp;<span class=\"externallink\" [routerLink]=\"'/inviteto/'+p.pid\">Mehr einladen</span>-->\n                <br/>\n              </span>\n            </small>\n            <small style=\"white-space: nowrap;\">\n              <span style=\"white-space: nowrap;\">\n                <ion-icon \n                    color=\"light\" style=\"position: relative; top: 2px\" \n                    [name]=\"p.agreement_level == 1 ? 'checkmark-done-outline' : 'analytics-outline'\">\n                </ion-icon><b>&nbsp;{{Math.round(p.agreement_level * 1000) / 10}}</b>%&nbsp;<span class=\"externallink\" (click)=\"glossary('level-of-agreement')\"[innerHtml]=\"'level-of-agreement'|translate\"></span>\n              </span>&nbsp;&nbsp;&nbsp;\n              <ion-badge *ngIf=\"false\"\n                    class=\"ion-no-margin\" \n                    style=\"position: absolute; right:10px; bottom:7px; font-size: 11.5px; padding-top:2px\" \n                    color=\"success\" \n                    >\n                <ion-icon name=\"bulb-outline\" class=\"ion-no-padding ion-no-margin\"\n                  style=\"position: relative; top: 1.5px;\"></ion-icon>&nbsp;<span [innerHtml]=\"'<b>3</b> suggestions'\"></span> \n              </ion-badge>\n            </small>\n          </ion-col>\n        </ion-row>\n      </ion-grid>\n    </ion-item>\n\n    <!-- VOTE STATUS BANNER: -->\n\n    <ng-container *ngIf=\"p.allow_voting\">\n      <ion-item *ngIf=\"p.am_abstaining\" color=\"danger\">\n        <small>\n          <p>\n            <span style=\"font-size: medium\" [innerHtml]=\"'poll.hint-abstaining-1'|translate\"></span>&nbsp;<wbr/>\n            <span [innerHtml]=\"'poll.hint-abstaining-2-before-wap'|translate\"></span><wbr/><span (click)=\"glossary('wap')\" style=\"cursor: pointer; white-space: nowrap\"><span class=\"externallink\" [innerHtml]=\"'poll.hint-abstaining-2-wap'|translate\"></span><ion-icon name=\"help-circle-outline\" style=\"font-size: 16px; position: relative; top:4px;\"></ion-icon></span><span [innerHtml]=\"'poll.hint-abstaining-2-after-wap'|translate\"></span>\n            <!-- assist link: -->\n            &nbsp;<wbr/><span style=\"white-space: nowrap;\">\n              (<a \n                (click)=\"assist_dialog()\"\n                [innerHtml]=\"'poll.assist-me-inline' | translate\">\n              </a>)\n            </span>\n          </p>\n        </small>\n      </ion-item>\n      <ion-item *ngIf=\"p.my_n_rated_positive == 1\" color=\"warning\">\n        <small>\n          <p>\n            <span style=\"font-size: medium\" [innerHtml]=\"'poll.hint-only1positive-1-before-wap'|translate\"></span><wbr/><span (click)=\"glossary('wap')\" style=\"cursor: pointer; white-space: nowrap\"><span style=\"font-size: medium\" class=\"externallink\" [innerHtml]=\"'poll.hint-only1positive-1-wap'|translate\"></span><ion-icon name=\"help-circle-outline\" style=\"font-size: 16px; position: relative; top:3px;\"></ion-icon></span><span style=\"font-size: medium\" [innerHtml]=\"'poll.hint-only1positive-1-after-wap'|translate\"></span>&nbsp;<wbr/>\n            <span [innerHtml]=\"'poll.hint-only1positive-2'|translate\"></span>\n            <!-- assist link: -->\n            &nbsp;<wbr/><span style=\"white-space: nowrap;\">\n              (<a \n                (click)=\"assist_dialog()\"\n                [innerHtml]=\"'poll.assist-me-inline' | translate\">\n              </a>)\n            </span>\n          </p>\n        </small>\n      </ion-item>\n      <ion-item *ngIf=\"p.my_n_rated_positive != 1 && p.my_n_approved == 1\" color=\"secondary\">\n        <small>\n          <p>\n            <span style=\"font-size: medium\" [innerHtml]=\"'poll.hint-only1approved-1-before-approving'|translate\"></span><wbr/><span (click)=\"glossary('approve')\" style=\"cursor: pointer; white-space: nowrap\"><span style=\"font-size: medium\" class=\"externallink\" [innerHtml]=\"'poll.hint-only1approved-1-approving'|translate\"></span><ion-icon name=\"help-circle-outline\" style=\"font-size: 16px; position: relative; top:3px;\"></ion-icon></span><span style=\"font-size: medium\" [innerHtml]=\"'poll.hint-only1approved-1-after-approving'|translate\"></span>&nbsp;<wbr/>\n            <span [innerHtml]=\"'poll.hint-only1approved-2-before-wap'|translate\"></span><wbr/><span (click)=\"glossary('wap')\" style=\"cursor: pointer; white-space: nowrap\"><span class=\"externallink\" [innerHtml]=\"'poll.hint-only1approved-2-wap'|translate\"></span><ion-icon name=\"help-circle-outline\" style=\"font-size: 16px; position: relative; top:4px;\"></ion-icon></span><span [innerHtml]=\"'poll.hint-only1approved-2-after-wap'|translate\"></span>\n            <!-- assist link: -->\n            &nbsp;<wbr/><span style=\"white-space: nowrap;\">\n              (<a \n                (click)=\"assist_dialog()\"\n                [innerHtml]=\"'poll.assist-me-inline' | translate\">\n              </a>)\n            </span>\n          </p>\n        </small>\n      </ion-item>\n      <ion-item *ngIf=\"p.my_n_approved > 1 && !p.T.approvals_map.get(oidsorted[0]).get(p.myvid)\" color=\"light\">\n        <small>\n          <p>\n            <span [innerHtml]=\"'poll.hint-mostapproved-1'|translate\"></span>\n          </p>\n        </small>\n      </ion-item>\n      \n    </ng-container>\n\n    <!-- FINAL RESULTS (if ended and results are ready): -->\n\n    <!-- TODO!! -->\n\n    <!-- winner exists: -->\n    <ng-container *ngIf=\"p.has_results && p.type=='winner'\">\n      <ion-item color=\"light\">\n        <p [innerHtml]=\"'poll.results'|translate\">\n        </p>\n      </ion-item>\n      <ion-item color=\"danger\">\n        <h3>\n          <b [innerHtml]=\"'poll.winner-is'|translate:{winner:p.options[p.winner].name}\"></b>\n        </h3>\n      </ion-item>\n      <ion-item color=\"warning\">\n        <p>\n          <b [innerHtml]=\"'poll.reason'|translate\"></b>&nbsp;\n          <span \n            *ngIf=\"p.T.n_not_abstaining == 0\" \n            [innerHtml]=\"'poll.reason-all-abstained'|translate:{}\"></span>\n          <span \n            *ngIf=\"p.T.n_not_abstaining > 0 && p.T.approval_scores_map.get(oidsorted[0]) == p.T.n_not_abstaining && p.T.approval_scores_map.get(oidsorted[1]) < p.T.n_not_abstaining\" \n            [innerHtml]=\"'poll.reason-full-consensus-unique'|translate:{}\"></span>\n          <span \n            *ngIf=\"p.T.n_not_abstaining > 0 && p.T.approval_scores_map.get(oidsorted[0]) == p.T.n_not_abstaining && p.T.approval_scores_map.get(oidsorted[1]) == p.T.n_not_abstaining\" \n            [innerHtml]=\"'poll.reason-full-consensus-highest'|translate:{}\"></span>\n          <span \n            *ngIf=\"p.T.n_not_abstaining > 0 && p.T.approval_scores_map.get(oidsorted[0]) < p.T.n_not_abstaining && p.winner == oidsorted[0]\" \n            [innerHtml]=\"'poll.reason-largest-approval'|translate:{\n              approval:Math.round(p.T.approval_scores_map.get(oidsorted[0])/p.T.n_not_abstaining*1000)/10,\n              disapproval:100-Math.round(p.T.approval_scores_map.get(oidsorted[0])/p.T.n_not_abstaining*1000)/10}\"></span>\n          <span \n            *ngIf=\"p.T.n_not_abstaining > 0 && p.T.approval_scores_map.get(oidsorted[0]) < p.T.n_not_abstaining && p.winner != oidsorted[0]\" \n            [innerHtml]=\"'poll.reason-smaller-approval'|translate:{\n              share:Math.round(p.T.shares_map.get(p.winner)*1000)/10}\"></span>\n        </p>\n      </ion-item>\n    </ng-container>\n\n    <!-- shares exist: -->\n    <ng-container *ngIf=\"p.has_results && p.type=='share'\">\n      <ion-item color=\"light\">\n        <p [innerHtml]=\"'poll.results'|translate\">\n        </p>\n      </ion-item>\n      <ion-item color=\"danger\">\n        <ion-text>\n          <ng-container *ngFor=\"let item of [].constructor(oidsorted.length); let i = index\">\n            <ng-container *ngIf=\"p.T.shares_map.get(oidsorted[i]) > 0\">\n                <h3><b>\n                  <span [innerHtml]=\"'poll.of-the-budget-go-to'|translate:{share:Math.round(p.T.shares_map.get(oidsorted[i]) * 1000) / 10, option:p.options[oidsorted[i]].name}\"></span>\n                </b></h3> \n            </ng-container>\n          </ng-container>\n        </ion-text>   \n      </ion-item>\n    </ng-container>\n\n    <!-- FINAL WAPS EXPANDER (if ended): -->\n\n    <ion-item *ngIf=\"!p.allow_voting\" \n        color=\"light\"\n        (click)=\"final_expanded=!final_expanded\"\n        style=\"cursor: pointer;\">\n      <ion-icon \n        [name]=\"final_expanded?'caret-down-outline':'caret-forward-outline'\" \n        size=\"small\" color=\"primary\">\n      </ion-icon>&nbsp;&nbsp;<ion-label>\n        <span [innerHtml]=\"'poll.final-ratings'|translate\"></span>\n      </ion-label>\n    </ion-item>\n    \n    <!-- POTENTIALLY HIDDEN CONTENT: -->\n\n    <div [style.display]=\"p.allow_voting || final_expanded ? 'block' : 'none'\">\n\n      <!-- INCOMING DELEGATIONS BANNER: -->\n\n      <ion-item *ngIf=\"(accepted_requests.length > 0) || (declined_requests.length > 0)\"\n          color=\"light\">\n        <ion-grid class=\"ion-no-padding ion-no-margin\">\n\n          <!-- SUMMARY: -->\n\n          <ion-row \n              class=\"ion-no-padding ion-no-margin\" \n              style=\"padding-top: 5px; padding-bottom: 6px; cursor: pointer;\"\n              (click)=\"incoming_delegation_expanded =! incoming_delegation_expanded\">\n            <ion-col class=\"ion-no-margin ion-padding-right\" >\n              <small>\n                <ion-icon \n                  [name]=\"(incoming_delegation_expanded) ? 'chevron-down-outline' : 'chevron-forward-outline'\" \n                  size=\"smaller\" class=\"ion-no-margin\" \n                  style=\"color:black; position: relative; left: -2px; top: 2px;\">\n                </ion-icon>\n                <span *ngIf=\"accepted_requests.length > 0\" \n                  [innerHtml]=\"\n                    ((n_indirect_clients == 1 ? 'poll.also-for-other' : 'poll.also-for-others' )\n                    | translate: {n_others: n_indirect_clients})\n                    + ' '\n                  \">\n                </span>\n                <span *ngIf=\"declined_requests.length > 0\" \n                  [innerHtml]=\"(n_indirect_clients == 0 ? 'poll.declined-all' : 'poll.declined-some') | translate\">\n                </span>\n                &nbsp;\n              </small>\n            </ion-col>\n          </ion-row>\n\n          <!-- EXPANDABLE DETAILS: -->\n\n          <!-- Accepted requests: -->\n\n          <ion-row *ngIf=\"incoming_delegation_expanded && accepted_requests.length > 0\">\n            <ion-col class=\"ion-text-right\">\n              <small>\n                <span [innerHtml]=\"'poll.have-accepted' | translate\"></span>\n                <ion-chip *ngFor=\"let r of accepted_requests\" \n                    [routerLink]=\"r.url\" \n                    outline=\"true\">\n                  <ion-icon \n                    name=\"mail-open-outline\"\n                    style=\"color:grey\" size=\"small\">\n                  </ion-icon>\n                  <small>{{r.from}}</small>\n                </ion-chip>\n              </small>\n            </ion-col>\n          </ion-row>\n\n          <!-- Declined requests: -->\n\n          <ion-row *ngIf=\"incoming_delegation_expanded && declined_requests.length > 0\">\n            <ion-col class=\"ion-text-right\">\n              <small>\n                <span [innerHtml]=\"'poll.have-declined' | translate\"></span>\n                <ion-chip *ngFor=\"let r of declined_requests\" \n                    [routerLink]=\"r.url\" \n                    outline=\"true\">\n                  <ion-icon \n                    name=\"mail-open-outline\"\n                    style=\"color:grey\" size=\"small\">\n                  </ion-icon>\n                  <small>{{r.from}}</small>\n                </ion-chip>\n              </small>\n            </ion-col>\n          </ion-row>\n\n        </ion-grid>\n      </ion-item>\n\n      <!-- OUTGOING DELEGATION BANNER: -->\n\n      <ion-item *ngIf=\"delegation_status=='pending'\" \n          color=\"warning\"> \n        <ion-grid class=\"ion-no-padding ion-no-margin\">\n          <ion-row class=\"ion-no-padding ion-no-margin ion-align-items-center\">\n\n            <!-- Info about how many ratings the delegate controls: -->\n\n            <ion-col class=\"ion-no-margin ion-padding-right\">\n              <small>\n                <p>\n                  <span style=\"font-size: medium;\">{{delegate}}</span>&nbsp;\n                  <span [innerHtml]=\"\n                    'poll.delegate-not-responded' | translate\n                    \">\n                  </span>\n                </p>\n              </small>\n            </ion-col>\n\n            <!-- Revoke delegation button: -->\n\n            <ion-col size=\"auto\" class=\"ion-no-margin\">\n              <ion-button \n                  [disabled]=\"!p.allow_voting\"\n                  fill=\"clear\" (click)=\"revoke_delegation_dialog()\">\n                <ion-icon name=\"trash-outline\" style=\"color:black\"></ion-icon>\n              </ion-button>\n            </ion-col>\n\n          </ion-row>\n        </ion-grid>\n      </ion-item>\n\n      <ion-item *ngIf=\"delegation_status=='agreed'\" \n          color=\"warning\"> \n        <ion-grid class=\"ion-no-padding ion-no-margin\">\n          <ion-row class=\"ion-no-padding ion-no-margin ion-align-items-center\">\n\n            <!-- Info about how many ratings the delegate controls: -->\n\n            <ion-col class=\"ion-no-margin ion-padding-right\">\n              <small>\n                <p>\n                  <span style=\"font-size: medium;\">{{delegate}}</span>&nbsp;\n                  <span [innerHtml]=\"\n                    'poll.delegate-controls-' \n                    + (n_delegated == oidsorted.length ? 'all' \n                      : 2*n_delegated > oidsorted.length ? 'most' \n                      : n_delegated > 0 ? 'some' : 'none'\n                      ) | translate\n                    \">\n                  </span>\n                </p>\n              </small>\n            </ion-col>\n\n            <!-- Revoke delegation button: -->\n\n            <ion-col size=\"auto\" class=\"ion-no-margin\">\n              <ion-button fill=\"clear\" (click)=\"revoke_delegation_dialog()\">\n                <ion-icon name=\"trash-outline\" style=\"color:black\"></ion-icon>\n              </ion-button>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n            </ion-col>\n\n            <!-- Help text for delegation toggles: -->\n\n            <ion-col \n                size=\"auto\" \n                class=\"ion-no-padding ion-no-margin ion-padding-left ion-text-right\" \n                style=\"padding-bottom:3px;\">\n              <small>\n                <p>\n                  <span [innerHtml]=\"'poll.choose-whose-ratings' | translate\"></span>&nbsp;\n                  <ion-icon \n                    name=\"arrow-down-outline\" \n                    style=\"position:relative;top:3px;\">\n                  </ion-icon>\n                </p>\n              </small>\n            </ion-col>\n          </ion-row>\n        </ion-grid>\n      </ion-item>\n\n      <!-- TABLE HEADER: -->\n\n      <ion-item class=\"ion-no-padding ion-no-margin\" lines=\"none\"\n            style=\"--min-height: 0px!important; font-weight: bold;\">\n        <small (click)=\"glossary('share')\" style=\"padding-top: 8px!important;padding-left: 6px; width: 68px!important; color: #769596; text-align: center;\">\n  <!--        <ion-icon name=\"help-circle-outline\" style=\"position: relative; top: 4px; font-size: medium; padding: 0px; color: #9abcbd\"></ion-icon>--><span style=\"width: 100%!important\" class=\"externallink\" [innerHtml]=\"'share'|translate\"></span>\n        </small>\n        <small (click)=\"glossary('wap')\" style=\"padding-left: 6px!important; padding-top: 8px!important; flex-grow: 1; color: #769596;\"><!--#62a73b;-->\n  <!--        <ion-icon name=\"help-circle-outline\" style=\"position: relative; top: 4px; font-size: medium; padding: 0px; color: #9abcbd\"></ion-icon>--><span class=\"externallink\" [innerHtml]=\"'wap'|translate\"></span><!-- &rarr;-->\n        </small>\n        <!-- TODO: make padding robustly correct accross devices: -->\n        <small (click)=\"glossary('approve')\" [style]=\"'padding-top: 8px!important; padding-right: '+(delegation_status=='agreed'?62:10)+'px; color: #769596;'\"><!--#9abcbd--><!--&larr; -->\n          <ion-icon name=\"caret-down\" style=\"position: relative; top: 2px;\"></ion-icon>\n          <span class=\"externallink\" [innerHtml]=\"'approval'|translate\"></span><!--<ion-icon name=\"help-circle-outline\" style=\"position: relative; top: 4px; font-size: medium; padding: 0px;  color: #9abcbd\"></ion-icon>-->\n        </small>\n      </ion-item>\n\n      <!-- OPTIONS: -->\n\n      <ion-item *ngFor=\"let item of [].constructor(oidsorted.length); let i = index\" style=\"align-items:flex-start\">\n\n        <!-- ALWAYS VISIBLE STUFF: -->\n\n        <ion-grid class=\"ion-no-padding ion-no-margin\">\n\n          <ion-row class=\"ion-no-padding ion-no-margin\">\n\n            <!-- PIE CHART WITH WINNING PROBABILITY: -->\n\n            <ion-col size=\"auto\" class=\"ion-no-padding ion-no-margin\">\n              <div style=\"width: 60px!important\"></div>\n              <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"60px\" height=\"60px\" style=\"position:absolute; bottom:0px;\"><!--top:12px;-->\n                <circle cx=\"21\" cy=\"25\" r=\"20\" fill=\"#bce4e5\" stroke=\"none\" />\n                <path [id]=\"'pie_'+oidsorted[i]\" d=\"M 21,25 l 0,-20 a 20 20 0 0 1 0 0 Z\" fill=\"#9abcbd\" />\n                <line [attr.display]=\"option_expanded[oidsorted[i]] ? 'inline' : 'none'\"\n                  x1=\"21\" y1=\"48\" x2=\"21\" y2=\"60\" stroke=\"#769596\" stroke-width=\"1\" stroke-dasharray=\"1 1\"></line>\n              </svg>\n            </ion-col>\n\n            <ion-col>\n\n              <ion-grid class=\"ion-no-padding ion-no-margin\">\n\n                <ion-row class=\"ion-no-padding ion-no-margin\" style=\"padding-top: 8px; cursor: pointer; position: relative; left: -6px; z-index:20; \"\n                    (click)=\"expand(oidsorted[i])\">\n                  <ion-col class=\"ion-no-padding ion-no-margin\">\n\n                    <ion-input style=\"display: none;\"></ion-input><!--this is needed so that the following ion-label is not greyed out when the ion-range below is disabled!-->\n                    <ion-label class=\"ion-no-padding ion-no-margin\" style=\"max-width: 100%!important;\">\n    \n                      <ion-icon \n                        [name]=\"(option_expanded[oidsorted[i]]) ? 'chevron-down-outline' : 'chevron-forward-outline'\" \n                        size=\"small\" class=\"ion-no-margin\" \n                        style=\"color:black; position: relative; top: 3px;\">\n                      </ion-icon>\n\n                      <!-- OPTION NAME: -->\n    \n                      <b><i>&nbsp;<span [innerHtml]=\"p.options[oidsorted[i]].name\"></span>&nbsp;</i></b>\n                    </ion-label>\n    \n                  </ion-col>\n                </ion-row>\n\n                <!-- RATING CONTROLS: -->\n\n                <ion-row class=\"ion-no-padding ion-no-margin\">\n\n                  <ion-col \n                      [id]=\"'_slider_'+oidsorted[i]+'_'+sortingcounter\"\n                      class=\"ion-no-padding ion-no-margin\" \n                      (click)=\"onRatingColClick(oidsorted[i], $event)\" \n                      (pointerdown)=\"onRatingColPointerdown(oidsorted[i], $event)\" \n                      (touchstart)=\"onRatingColTouchstart(oidsorted[i], $event)\" \n                      (touchup)=\"onRatingColTouchup(oidsorted[i], $event)\"\n                      (pointerup)=\"onRatingColPointerup(oidsorted[i], $event)\"\n                      >\n\n                    <!-- SLIDER: -->\n\n                    <!-- TODO: sometimes looks strange in Chrome (white shadowed large knob, bar displaced too low)-->\n                    <ion-range \n                        [disabled]=\"!p.allow_voting\"\n                        [id]=\"'slider_'+oidsorted[i]+'_'+sortingcounter\" \n                        [color]=\"slidercolor[oidsorted[i]]\"\n                        [value]=\"p.get_my_proxy_rating(oidsorted[i])\" \n                        (ionFocus)=\"onRatingSliderFocus(oidsorted[i])\" \n                        (ionChange)=\"onRatingSliderChange(oidsorted[i])\" \n                        (ionBlur)=\"onRatingSliderBlur(oidsorted[i])\"\n                        mode=\"md\" pin=\"true\" pinFormatter=\"(v)=>100-v\"\n                        min=\"0\" max=\"100\" step=\"1\" snaps=\"true\" ticks=\"false\"\n                        [style]=\"''\n                          + (rate_yourself_toggle[oidsorted[i]] || delegation_status!='agreed'\n                          ? 'pointer-events:; --bar-height: 7px; --knob-size: 35px'\n                          : 'pointer-events: none; --bar-height: 5px; --knob-size: 17px')\" \n                        class=\"ion-no-padding ion-no-margin\">\n\n                      <ion-label \n                          slot=\"end\" \n                          class=\"ion-no-padding ion-no-margin\" \n                          style=\"margin-right:12px;\">\n                          <!--don't do width:100% in ion-label since otherwise the slider is not working properly!-->\n\n                        <!-- APPROVAL BAR: -->\n\n                        <div style=\"position: absolute; bottom: 0px; right: 11px; z-index: -10; width: 100%; padding-left: 11px\">\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"35px\">\n                            <rect [id]=\"'bar_' + oidsorted[i]\" \n                              x=\"100%\" width=\"0%\" y=\"8\" height=\"18\" \n                              fill=\"#bce4e5\" stroke=\"none\" /><!--Note: width will change dynamically-->\n                            <line x1=\"100%\" y1=\"0\" x2=\"100%\" y2=\"34\" fill=\"none\" stroke=\"#bce4e5\" stroke-width=\"5\" />\n                            <line x1=\"0%\" x2=\"100%\" y1=\"17\" y2=\"17\" stroke=\"#b4dbdb\" stroke-width=\"2\" stroke-dasharray=\"2 2\" />\n                            <!--<rect x=\"0%\" width=\"100%\" y=\"16\" height=\"2\" fill=\"#b4dbdb\" stroke=\"none\" />-->\n                          </svg>\n                        </div>\n\n                        <!-- Numerical annotations when expanded: -->\n\n                        <div style=\"position: absolute; bottom: 0px; right: 11px; z-index: 10; width: 100%; padding-left: 11px; pointer-events: none;\">\n                          <svg [attr.display]=\"option_expanded[oidsorted[i]] ? 'inline' : 'none'\" \n                              xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"45px\">\n                            <!--\n                            <text x=\"0%\" y=\"20\" \n                              style=\"font-weight: bold; font-size: 12px;\" fill=\"slidercolor[oidsorted[i]]\" \n                              [innerHtml]=\"p.get_my_proxy_rating(oidsorted[i])\">\n                            </text>\n                            -->\n                            <text x=\"100%\" y=\"15\" \n                              style=\"font-weight: bold; font-size: 12px;\" text-anchor=\"end\" fill=\"#9abcbd\" [innerHtml]=\"\n                                Math.round(p.T.approval_scores_map.get(oidsorted[i]) / Math.max(1, p.T.n_not_abstaining) * 1000) / 10 + '%&nbsp;&nbsp;'\n                              \">\n                            </text>\n                          </svg>\n                        </div>\n\n                        <!-- DELEGATE'S RATING -->\n\n                        <div style=\"position: absolute; top: -2px; right: 11px; z-index: -5; width: 100%; padding-left: 11px\"\n                            [style.display]=\"delegation_status=='agreed' && rate_yourself_toggle[oidsorted[i]] ? 'inline' : 'none'\">\n                          <svg xmlns=\"http://www.w3.org/2000/svg\" width=\"100%\" height=\"15px\">\n                            <line [id]=\"'del_needle_' + oidsorted[i]\" x1=\"0\" y1=\"8\" x2=\"50%\" y2=\"8\" fill=\"none\" stroke=\"#9abcbd\" stroke-width=\"2\" stroke-dasharray=\"3 2\" />\n                            <circle [id]=\"'del_knob_' + oidsorted[i]\" cx=\"50%\" cy=\"8\" r=\"5\" fill=\"#9abcbd\" stroke=\"none\"/>\n                            <!--FIXME: circle is cropped when close to either endpoint. how to avoid this?-->\n                          </svg>\n                        </div>\n\n                      </ion-label>\n                    </ion-range>\n                  </ion-col>\n\n                  <!-- DELEGATION TOGGLE: -->\n\n                  <ion-col *ngIf=\"delegation_status=='agreed'\" \n                      class=\"ion-no-margin ion-no-padding\" \n                      size=\"auto\">&nbsp;&nbsp;&nbsp;\n                    <ion-toggle [id]=\"'rate_yourself_toggle_' + oidsorted[i]\" \n                      [disabled]=\"!p.allow_voting\"\n                      (ionChange)=\"on_rate_yourself_toggle_change(oidsorted[i])\"\n                      class=\"ion-no-margin ion-no-padding ion-padding-bottom ion-padding-top\" \n                      style=\"position:relative; top:-8px;\" \n                      [(ngModel)]=\"rate_yourself_toggle[oidsorted[i]]\">\n                    </ion-toggle>\n                    <div style=\"position:absolute; z-index:10; top:22px; right:1px; text-align:right;\">\n                      <small [innerHtml]=\"\n                        rate_yourself_toggle[oidsorted[i]] \n                        ? ('poll.my-own' | translate) \n                        : ('poll.delegate-s' | translate: {delegate: delegate})\n                        \" >\n                      </small>\n                    </div>\n                  </ion-col>  \n                </ion-row>\n              </ion-grid>\n            </ion-col>\n          </ion-row>\n          <ion-row class=\"ion-no-padding ion-no-margin\">\n            <ion-col class=\"ion-no-padding ion-no-margin\">\n              <ion-grid class=\"ion-no-padding ion-no-margin\">\n\n                <!-- EXPANDABLE OPTION DETAILS -->\n\n                <!-- TODO: replace by simpler container: -->\n                <app-expandable [id]=\"'expander_'+oidsorted[i]+'_'+sortingcounter\" \n                    [expanded]=\"option_expanded[oidsorted[i]]\">\n                  <ion-row class=\"ion-no-padding ion-padding-bottom ion-no-margin\">\n                    <ion-col class=\"ion-no-padding ion-no-margin\">\n                      <b>\n                        <!-- Winning chance/budget share: -->\n                        <span style=\"color:#769596;\">\n                          <span style=\"white-space: nowrap;\" [innerHtml]=\"\n                            (p.type == 'winner' \n                                ? (p.allow_voting?'poll.chance-to-win':'poll.final-chance-to-win') \n                                : (p.allow_voting?'poll.of-the-budget':'poll.final-budget')) \n                            | translate: {percentage: \n                              Math.round(p.T.shares_map.get(oidsorted[i]) * 1000) / 10\n                            }\">\n                          </span><small><wbr> <span style=\"color:#4c822e;\" \n                              [style.display]=\"(votedfor == oidsorted[i]) ? 'inline' : 'none'\"\n                              [innerHtml]=\"'poll.including-your-share' | translate\">\n                            </span>,\n                          </small>\n                        </span><small><wbr> </small>\n                        <!-- Approval: -->\n                        <span style=\"color:#9abcbd; white-space: nowrap;\">\n                          <span [innerHtml]=\"\n                            'poll.approved-by' | translate: {percentage:\n                              Math.round(p.T.approval_scores_map.get(oidsorted[i]) / Math.max(1, p.T.n_not_abstaining) * 1000) / 10\n                            }\">\n                          </span>\n                        </span>\n                        <small>\n                          <span style=\"color:#62a73b\" \n                            [style.display]=\"approved[oidsorted[i]] ? 'inline' : 'none'\"\n                            [innerHtml]=\"'poll.including-you' | translate\">\n                          </span>\n                        </small>\n                        <small>\n                        <!-- avg. rating: -->\n                        <span *ngIf=\"(i>0 \n                                  && p.T.approval_scores_map.get(oidsorted[i-1]) \n                                  == p.T.approval_scores_map.get(oidsorted[i])) \n                              || (i<oidsorted.length-1 \n                                  && p.T.approval_scores_map.get(oidsorted[i+1]) \n                                  == p.T.approval_scores_map.get(oidsorted[i]))\" \n                              style=\"color:#9abcbd\">,\n                          <span style=\"white-space: nowrap;\" [innerHtml]=\"\n                            'poll.average-rating' | translate: {average:\n                              Math.round(p.T.total_effective_ratings_map.get(oidsorted[i]) / Math.max(1, p.T.n_not_abstaining) * 10) / 10\n                            }\">\n                          </span>\n                        </span>&nbsp;\n                        <!-- explanation link: -->\n                        <span style=\"color:#9abcbd; white-space: nowrap;\">\n                          (<a \n                            (click)=\"explain_approval_dialog(oidsorted[i])\"\n                            [innerHtml]=\"'poll.explain' | translate\">\n                          </a>)\n                        </span>\n                      </small>\n                      </b>\n                      <span [style.display]=\"(!!p.options[oidsorted[i]].desc || !!p.options[oidsorted[i]].url) ? 'inline' : 'none'\">\n                        <br/>\n                      </span>\n                      <span [style.display]=\"p.options[oidsorted[i]].desc != '' ? 'inline' : 'none'\">\n                        <i><span [innerHtml]=\"p.options[oidsorted[i]].desc\"></span>&nbsp;&nbsp;</i>\n                      </span>\n                      <span [style.display]=\"p.options[oidsorted[i]].url != '' ? 'inline' : 'none'\">\n                        <small>\n                          (<span (click)=\"G.open_url_in_new_tab(G.D.fix_url(p.options[oidsorted[i]].url))\"><ion-text \n                              class=\"externallink\"  \n                              [innerHtml]=\"'read-more' | translate\">\n                          </ion-text>&nbsp;<ion-icon name=\"open-outline\" style=\"position: relative; top: 2px;\"></ion-icon></span>)\n                        </small>\n                      </span>\n\n                      <!-- debugging info: - ->\n\n                      <small>\n                        <br/>direct_delegation_map: {{G.map2str(p.direct_delegation_map.get(oidsorted[i]))}}\n                        <br/>inv_direct_delegation_map: {{G.map2str(p.inv_direct_delegation_map.get(oidsorted[i]))}}\n                        <br/>indirect_delegation_map: {{G.map2str(p.indirect_delegation_map.get(oidsorted[i]))}}\n                        <br/>inv_indirect_delegation_map: {{G.map2str(p.inv_indirect_delegation_map.get(oidsorted[i]))}}\n                        <br/>effective_delegation_map: {{G.map2str(p.effective_delegation_map.get(oidsorted[i]))}}\n                        <br/>inv_effective_delegation_map: {{G.map2str(p.inv_effective_delegation_map.get(oidsorted[i]))}}\n                        <br/>ratings_ascending_map: {{G.map2str(p.T.ratings_ascending_map)}}\n                        <br/>thresholds_map: {{G.map2str(p.T.thresholds_map)}}\n                        <br/>approval_scores_map: {{G.map2str(p.T.approval_scores_map)}}\n                        <br/>total_effective_ratings_map: {{G.map2str(p.T.total_effective_ratings_map)}}\n                        <br/>votes_map: {{G.map2str(p.T.votes_map)}}\n                        <br/>n_votes_map: {{G.map2str(p.T.n_votes_map)}}\n                        <br/>shares_map: {{G.map2str(p.T.shares_map)}}\n                      </small>\n                      <!---->\n                      \n                    </ion-col>\n                  </ion-row>\n                </app-expandable>\n              </ion-grid>\n            </ion-col>\n          </ion-row>\n        </ion-grid>\n\n      </ion-item>\n\n      <!-- ADD OPTION BUTTON: -->\n\n      <ng-container *ngIf=\"p.allow_voting\">\n        <ion-item lines=\"none\" class=\"ion-no-padding\" style=\"padding-left: 10px; padding-top: 10px;\">\n          <ion-fab-button \n            size=\"small\" (click)=\"add_option($event)\" fill=\"clear\" color=\"primary\">\n            <ion-icon name=\"add\"></ion-icon>\n          </ion-fab-button>\n          <ion-button \n            class=\"ion-no-padding ion-no-margin\" fill=\"clear\" (click)=\"add_option($event)\"\n            [innerHtml]=\"'poll.add-option' | translate\"> \n          </ion-button>\n        </ion-item>\n        <ion-item lines=\"none\" style=\"padding-bottom: 10px!important;\">\n          <small [innerHtml]=\"'poll.add-option-info' | translate\"></small>\n        </ion-item>\n      </ng-container>\n\n    </div>\n\n    <!-- DEBUGGING AREA (not in production mode): -->\n\n    <ng-container *ngIf=\"false && !environment.production\">\n      <ion-item></ion-item>\n      <ion-item class=\"ion-text-right\" lines=\"none\">\n        <ion-col><small><p style=\"color: grey;\">\n          Debugging info: state={{p.state}}, vid={{p.myvid}}, oids={{p.oids}}, oidsorted={{oidsorted}}/{{p.T.oids_descending}}, scores_map={{G.map2str(p.T.scores_map)}}. \n          Simulate state (off:closed, on:running): \n        </p></small></ion-col>\n        <ion-buttons slot=\"end\">\n          <!-- only in debug: simulate closing -->\n          <ion-toggle color=\"light\"\n            [(ngModel)]=\"p.allow_voting\">\n          </ion-toggle>\n        </ion-buttons>\n      </ion-item>\n    </ng-container>\n\n  </ion-list>\n</ion-content>\n\n<!-- OPTIONAL GLOSSARY: -->\n\n<ion-footer *ngIf=\"show_glossary\" style=\"box-shadow: 0px -3px 4px #eeeeee;\">\n  <ion-item color=\"light\">\n    <ion-text>\n    <ion-button (click)=\"dismiss_glossary()\" fill=\"clear\" class=\"ion-float-right ion-margin-right ion-margin-left ion-no-padding\"\n        style=\"position: relative; right: -6px; top: 3px;\">\n      <ion-icon class=\"ion-no-margin ion-no-padding\" slot=\"icon-only\" name=\"close\" color=\"primary\"></ion-icon>\n    </ion-button>\n    <small [innerHtml]=\"'glossary.'+glossary_key|translate\"></small>\n  </ion-text>\n  </ion-item>\n</ion-footer>\n\n","/*\n(C) Copyright 2015â€“2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { Component, OnInit, ViewChild, ChangeDetectorRef } from '@angular/core';\nimport { Router, ActivatedRoute } from \"@angular/router\";\nimport { TranslateService } from '@ngx-translate/core';\nimport { LoadingController, IonContent, IonRouterOutlet, PopoverController, AlertController, ModalController } from '@ionic/angular'; \n\nimport { environment } from '../../environments/environment';\nimport { GlobalService } from \"../global.service\";\nimport { Poll } from '../poll.service';\nimport { news_t } from '../data.service';\n\nimport { DelegationDialogPage } from '../delegation-dialog/delegation-dialog.module';  \nimport { AssistPage } from '../assist/assist.module';  \nimport { AddoptionDialogPage } from '../addoption-dialog/addoption-dialog.module';  \nimport { ExplainApprovalPage } from '../explain-approval/explain-approval.module';  \n\n@Component({\n  selector: 'app-poll',\n  templateUrl: './poll.page.html',\n  styleUrls: ['./poll.page.scss'],\n})\nexport class PollPage implements OnInit {\n\n  Array = Array;\n  Math = Math;\n  Object = Object;\n  window = window;\n  environment = environment;\n\n  @ViewChild(IonContent, { static: false }) content: IonContent;\n\n  page = \"poll\";\n\n  pid: string;\n  p: Poll;\n\n  delegate: string;\n  delegation_status = \"none\";\n\n  n_indirect_clients = 1;\n  accepted_requests = [];\n  declined_requests = [];\n\n  oidsorted: string[] = [];\n  sortingcounter: number = 0;\n\n  approved = {}; // whether option is approved by me\n  votedfor = null; // oid my prob. share goes to\n\n  // gui layout choices by user:\n  final_expanded = false;\n  details_expanded = true;\n  incoming_delegation_expanded = false;\n  option_expanded = {};\n\n  // other:\n\n  pieradius = 20;\n  two_pi = 2*Math.PI; \n  slidercolor = {};\n\n  refresh_paused = false;\n  needs_refresh = false;\n\n  scroll_position = 0;\n  rate_yourself_toggle: Record<string, boolean> = {};\n  n_delegated = 0;\n\n  news: Set<news_t> = new Set();\n\n  // LIFECYCLE:\n\n  ready = false;  \n\n  constructor(\n      private changeDetector: ChangeDetectorRef,\n      private router: Router,\n      private route: ActivatedRoute,\n      private routerOutlet: IonRouterOutlet,\n      public loadingController: LoadingController,\n      public alertCtrl: AlertController,\n      private popover: PopoverController,\n      private modalController: ModalController,\n      public translate: TranslateService,\n      public G: GlobalService) {\n    this.G.L.entry(\"PollsPage.constructor\");\n    // get pid of opened poll:\n    this.route.params.subscribe( params => { \n      this.pid = params['pid'];\n    } );\n  }\n\n  ngOnInit() {\n    this.G.L.entry(\"PollsPage.ngOnInit\");\n  }\n\n  ionViewWillEnter() {\n    this.G.L.entry(\"PollPage.ionViewWillEnter\");\n    this.G.D.page = this;\n    const f = (ev => { this.changeDetector.detectChanges(); });\n    window.addEventListener('offline', f);\n    window.addEventListener('online', f);\n    // get gui state:\n    const specs = JSON.parse(this.G.D.getp(this.pid, \"poll_page\") || \"{}\");\n    this.details_expanded = (specs['details_expanded'] != false);\n    this.incoming_delegation_expanded = (specs['incoming_delegation_expanded'] == true);\n    this.option_expanded = specs['option_expanded'] || {};\n    this.G.L.exit(\"PollPage.ionViewWillEnter\", specs);\n  }\n\n  ionViewDidEnter() {\n    this.G.L.entry(\"PollPage.ionViewDidEnter\");\n    if (this.G.D.ready) {\n      this.onDataReady();\n    }\n    this.G.L.debug(\"PollPage.ready:\", this.ready);\n  }\n\n  onDataReady() {\n    // called when DataService initialization was slower than view initialization\n    this.G.L.entry(\"PollPage.onDataReady\");\n    if (this.pid in this.G.P.polls) {\n      this.p = this.G.P.polls[this.pid];\n      if (this.p.state == 'draft') {\n        this.G.L.error(\"PollPage not showing draft poll, redirecting to mypolls page\", this.pid);\n        this.router.navigate([\"/mypolls\"]);\n      } else {\n        this.G.L.info(\"PollPage showing poll\", this.pid);\n      }\n      // TODO: check if running or closed!\n    } else {\n      this.G.L.warn(\"PollPage unknown pid ignored, redirecting to mypolls page\", this.pid, this.G.P.polls);\n      this.router.navigate([\"/mypolls\"]);\n      return;\n    }\n    this.p.tally_all();\n    // TODO: optimize sorting performance:\n    this.oidsorted = [...this.p.T.oids_descending]; \n    this.ready = true;\n    this.update_order(true);\n    /*\n    for (let oid of this.oidsorted) {\n      this.option_expanded[oid] = false;\n    }\n    */\n    window.setTimeout(() => {\n      this.update_order.bind(this)(true);\n      this.show_stats.bind(this)();\n    }, 200);\n    this.update_delegation_info();\n    this.on_delegate_toggle_change();\n    this.p.have_seen = true;\n    this.G.L.exit(\"PollPage.onDataReady\");\n  }\n\n  onDataChange() {\n    this.G.L.entry(\"PollPage.onDataChange\");\n    this.p.tally_all();\n    this.update_order();\n    this.update_delegation_info();\n    this.news = this.G.N.filter({pid: this.pid});\n    this.changeDetector.detectChanges();\n    this.G.L.exit(\"PollPage.onDataChange\");\n  }\n\n  ionViewWillLeave() {\n    // make sure current slider values are really stored in database:\n    for (let oid of this.oidsorted) {\n      if (!this.delegate || this.rate_yourself_toggle[oid]) {\n        this.p.set_my_own_rating(oid, Math.round(this.get_slider_value(oid)), true);\n      }\n    }\n    // dismiss auto-dismissing news:\n    for (const news of this.news) {\n      if (news.auto_dismiss) {\n        this.G.N.dismiss(news.key);\n      }\n    }\n    // store gui state:\n    const specs = {\n      'details_expanded': this.details_expanded,\n      'incoming_delegation_expanded': this.incoming_delegation_expanded,\n      'option_expanded': this.option_expanded\n    }\n    this.G.D.setp(this.pid, \"poll_page\", JSON.stringify(specs));\n    this.G.L.exit(\"PollPage.ionViewWillLeave\", specs);\n  }\n\n  ionViewDidLeave() {\n    this.G.L.entry(\"PollPage.ionViewDidLeave\");\n    this.G.D.save_state();\n    this.G.L.exit(\"PollPage.ionViewDidLeave\");\n  }\n\n  update_delegation_info() {\n    // determine own weight:\n    this.n_indirect_clients = this.p.get_n_indirect_clients(this.p.myvid);\n    // find incoming delegations:\n    const cache = this.G.D.incoming_dids_caches[this.pid];\n    this.accepted_requests = [];\n    this.declined_requests = [];\n    if (cache) {\n      for (const [did, [from, url, status]] of cache) {\n        if (status == 'agreed') {\n          this.accepted_requests.push({from:from, url:url});\n        } else if (status.startsWith('declined')) {\n          this.declined_requests.push({from:from, url:url});\n        } \n      }\n    }\n    // find outgoing delegation:\n    const did = this.G.Del.get_my_outgoing_dids_cache(this.pid).get(\"*\");\n    this.G.L.trace(\"PollPage.update_delegation_info did\", did);\n    if (did) {\n      this.delegate = this.G.Del.get_delegate_nickname(this.pid, did);\n      const agreement = this.G.Del.get_agreement(this.pid, did);\n      this.G.L.trace(\"PollPage.update_delegation_info agreement\", agreement);\n      this.delegation_status = agreement.status;\n    }\n    this.update_delegation_toggles();\n  }\n\n  update_delegation_toggles() {\n    for (let oid of this.oidsorted) {\n      let did = this.G.Del.get_my_outgoing_dids_cache(this.pid).get(oid);\n      if (!did) {\n        did = this.G.Del.get_my_outgoing_dids_cache(this.pid).get(\"*\");\n      }\n      if (did) {\n        const a = this.G.Del.get_agreement(this.pid, did);\n        this.G.L.trace(\"PollPage found did, agreement\", oid, did, a, [...a.accepted_oids], [...a.active_oids]);\n        this.rate_yourself_toggle[oid] = !a.active_oids.has(oid);\n      } else {\n        this.G.L.trace(\"PollPage found no did for\", oid);\n        this.rate_yourself_toggle[oid] = true;\n      }\n    }\n  }\n\n  async onScroll(ev) {\n    /** find scroll position to be able to react to it */ \n    // TODO: make sure the page does not scroll away under a \"held\" slider?\n    // if so, this.scroll_position needs to be used somehow to adjust the window's actual scroll position in that case...\n    /*\n    const elem = this.content;\n  \n    // the ion content has its own associated scrollElement\n    const scrollElement = await ( elem as any).getScrollElement();\n  \n    const totalContentHeight = scrollElement.scrollHeight;\n    const viewportHeight = scrollElement.offsetHeight;\n    const scrollPosition = ev.detail.scrollTop;\n    this.scroll_position = scrollPosition / (totalContentHeight - viewportHeight);\n    */\n    this.scroll_position = ev.detail.scrollTop;      \n  }\n\n  on_rate_yourself_toggle_change(oid:string) {\n//    const new_rating = this.p.own_ratings_map.get(oid).get(this.p.myvid);\n    // update delegation data:\n    this.G.Del.update_my_delegation(this.pid, oid, !this.rate_yourself_toggle[oid]);\n    // update slider value:\n//    this.get_slider(oid).value = new_rating.toString();\n    this.on_delegate_toggle_change();\n  }\n\n  on_delegate_toggle_change() {\n    // update n_delegated: // TODO: make more efficient\n    let sum = 0;\n    for (let [oid, b] of Object.entries(this.rate_yourself_toggle)) {\n      if (!b) sum++;\n    }\n    this.n_delegated = sum;\n  }\n\n  show_stats() { \n    /** update pies and bars, but not order! */\n    if (!this.ready) {\n      return\n    }\n    this.G.L.entry(\"PollPage.show_stats\");\n    const p = this.p, T = p.T, myvid = p.myvid, \n          approval_scores_map = T.approval_scores_map,\n          shares_map = T.shares_map, approvals_map = T.approvals_map;\n    this.votedfor = T.votes_map.get(this.p.myvid);\n    for (const oid of p.oids) {\n      // FIXME: bar and pie are sometimes null here, but not when running the getElementById in the console. why?\n      const a = (approval_scores_map.get(oid) / T.n_not_abstaining) || 0,\n            share = shares_map.get(oid),\n            bar = <SVGRectElement><unknown>document.getElementById('bar_'+oid),\n            pie = <SVGPathElement><unknown>document.getElementById('pie_'+oid),\n            R = this.pieradius,\n            dx = R * Math.sin(this.two_pi * share),\n            dy = R * (1 - Math.cos(this.two_pi * share)),\n            more_than_180_degrees_flag = share > 0.5 ? 1 : 0; \n      this.approved[oid] = approvals_map.get(oid).get(myvid);\n      if (bar) {\n        bar.width.baseVal.valueAsString = (100 * a).toString() + '%';\n        bar.x.baseVal.valueAsString = (100 * (1 - a)).toString() + '%';\n      } else {\n        this.G.L.warn(\"PollPage.show_stats couldn't change slider bar\", oid);\n      }\n      if (pie) {\n        if (share < 1) {\n          pie.setAttribute('d', \"M 21,25 l 0,-\"+R+\" a \"+R+\" \"+R+\" 0 \"+more_than_180_degrees_flag+\" 1 \"+dx+\" \"+dy+\" Z\");\n        } else { // a full circle\n          pie.setAttribute('d', \"M 21,25 l 0,-20 a 20 20 0 1 1 0 \"+(2*R)+\" a 20 20 0 1 1 0 \"+(-2*R)+\" Z\");\n        }\n      } else {\n        this.G.L.warn(\"PollPage.show_stats couldn't change pie piece\", oid);\n      }\n      this.set_slider_color(oid, p.get_my_proxy_rating(oid));\n      if (this.rate_yourself_toggle[oid]) {\n        // update dashed needle showing delegate's rating\n        const needle = <SVGLineElement><unknown>document.getElementById('del_needle_'+oid),\n              knob = <SVGCircleElement><unknown>document.getElementById('del_knob_'+oid),\n              delegate_vid = this.G.Del.get_potential_effective_delegate(this.pid, oid);\n//        this.G.L.trace(\"PollPage.show_stats needle know delegate_vid\", needle, knob, delegate_vid);\n        if (delegate_vid) {\n          const rating = (this.p.proxy_ratings_map.get(oid)||new Map()).get(delegate_vid)||0;\n          this.G.L.trace(\"PollPage.show_stats rating\", rating);\n          if (needle) {\n            needle.x2.baseVal.valueAsString = (rating).toString() + '%';\n          }\n          if (knob) {\n            knob.cx.baseVal.valueAsString = (rating).toString() + '%';\n          }    \n        }\n      }\n    }\n  }\n\n  listeners: Map<any, any[]> = new Map(); // cache for event listeners used in update_order\n  final_rand: number = 0;\n  \n  async update_order(force=false) {\n    // TODO: rather have this triggered by tally function!\n    if (this.oidsorted.length != this.p.oids.length) {\n      this.needs_refresh = true;\n    } else {\n      for (let i in this.oidsorted) { // loops over the indices\n        if (this.oidsorted[i] != this.p.T.oids_descending[i]) {\n  //        this.G.L.trace(\"PollPage.update_order\", this.oidsorted[i], this.p.T.oids_descending[i]);\n          this.needs_refresh = true;\n          break;\n        }\n      }  \n    }\n    if (force || (this.needs_refresh && !(this.refresh_paused))) {\n      if (!force) {\n        // link displayed sorting to poll's sorting:\n        const loadingElement = await this.loadingController.create({\n          message: this.translate.instant('poll.sorting'),\n          spinner: 'crescent',\n          duration: 100\n        });\n        await loadingElement.present();\n        await loadingElement.onDidDismiss();\n      }\n      // now actually tell html to use the new ordering:\n      this.oidsorted = [...this.p.T.oids_descending];\n      this.sortingcounter++;\n      this.needs_refresh = false;\n      setTimeout(()=>{\n        this.show_stats.bind(this)();\n        // add event listeners to catch events outside knob also on Android:\n        for (let i in this.oidsorted) {\n          const oid = this.oidsorted[i],\n                col = document.getElementById('_slider_'+this.oidsorted[i]+\"_\"+this.sortingcounter),\n                // new event listeners:\n                l1 = (ev => { this.onRatingColPointerdown.bind(this)(oid, ev) }),\n                l2 = (ev => { this.onRatingColPointerup.bind(this)(oid, ev) }),\n                l3 = (ev => { this.onRatingColTouchstart.bind(this)(oid, ev) }),\n                l4 = (ev => { this.onRatingColTouchup.bind(this)(oid, ev) });\n          if (!!col) {\n            if (this.listeners.has(col)) {\n              // remove previous listeners since they might belong to a different oid:\n              this.G.L.trace(\"PollPage.update_order removing old event listeners\");\n              const old = this.listeners.get(col);\n              col.removeEventListener(\"pointerdown\", old[0], true);\n              col.removeEventListener(\"pointerup\", old[1], true);\n              col.removeEventListener(\"touchstart\", old[2], true);\n              col.removeEventListener(\"touchup\", old[3], true);\n            }\n            // add new listeners for this oid:\n            col.addEventListener(\"pointerdown\", l1, true);\n            col.addEventListener(\"pointerup\", l2, true);\n            col.addEventListener(\"touchstart\", l3 , true);\n            col.addEventListener(\"touchup\", l4, true);\n            this.listeners.set(col, [l1, l2, l3, l4]);  \n          }\n        }  \n        //window.alert(\"updated\");\n        this.G.L.trace(\"PollPage.update_order registered event listeners\", this.sortingcounter);\n      }, 100);\n    } \n  }\n\n  set_slider_color(oid: string, value: number) {\n    this.slidercolor[oid] = \n      (value == 0) ? 'vodlered' : \n      (this.votedfor == oid) ? 'vodledarkgreen' :\n      (value + ((this.p.T.approval_scores_map.get(oid) / this.p.T.n_not_abstaining) || 0) * 100 <= 100) ? 'vodleblue' : \n      'vodlegreen';\n  }\n\n  // CONTROLS:\n\n  expand(oid: string) {\n    this.option_expanded[oid] = !this.option_expanded[oid];\n  }\n\n  // rating slider:\n  // TODO: 1 second after any change to a rating, wait another second if the pointer/mouse is currently down, else call rating_change_ended().\n\n  get_slider(oid: string) {\n    this.G.L.trace(\"PollPage.get_slider \", this.sortingcounter);\n    return <HTMLInputElement>document.getElementById('slider_'+oid+\"_\"+this.sortingcounter);\n  }\n\n  set_slider_values() {\n    /** update slider knob positions to current proxy ratings from cache */\n    for (let oid of this.p.oids) {\n      this.get_slider(oid).value = this.p.proxy_ratings_map.get(oid).get(this.p.myvid).toString();\n    }\n  }\n\n  get_slider_value(oid: string) {\n    /** get slider knob position */\n    const slider = this.get_slider(oid);\n    return !slider ? 0 : Number(slider.value);\n  }\n\n  apply_sliders_rating(oid: string) {\n    /** update own rating in cache on basis of slider knob position,\n     *  but don't store it in the database yet (see also rating_change_ended()).\n     */\n    if (!this.delegate || this.rate_yourself_toggle[oid]) {\n      this.p.set_my_own_rating(oid, Math.round(this.get_slider_value(oid)), false);\n    }\n    this.show_stats();\n  }\n\n  onRatingSliderFocus(oid: string): boolean {\n    /** called as soon as range slider gets focus */\n    this.G.L.entry(\"PollPage.onRatingSliderFocus\");\n    return true;\n  }\n\n  onRatingSliderChange(oid: string): boolean {\n    /** called whenever a slider is moved */\n    var slider = this.get_slider(oid),\n        value = Number(slider.value);\n    // window.alert(\"onRatingChange \" + value);\n    this.set_slider_color(oid, value);\n    this.apply_sliders_rating(oid);\n    return true;\n  }\n\n  onRatingSliderBlur(oid: string): boolean {\n    /** called when the slider loses focus */\n    this.G.L.entry(\"PollPage.onRatingSliderBlur\");\n    this.rating_change_ended(oid);\n    return true;\n  }\n\n  rating_change_ended(oid: string) {\n    /** Called right after releasing the slider. \n     *  Stores slider position in own rating cache AND database. */\n    // TODO: make sure this is really always called right after releasing the slider!\n    this.G.L.entry(\"PollPage.rating_change_ended\");\n    this.p.have_acted = true;\n    if (!this.delegate || this.rate_yourself_toggle[oid]) {\n      this.p.set_my_own_rating(oid, Math.round(this.get_slider_value(oid)), true);\n    }\n    this.update_order();\n    this.G.D.save_state();\n  }\n\n  dragged_oid: string = undefined; // used in onRatingColPointerdown\n\n  // The following three handlers prevent the slider from responding when pointer is not on knob:\n  \n  onRatingColPointerdown(oid: string, ev: Event): boolean {\n    /** event listener called when user starts clicking slider */\n    this.p.end_if_past_due();\n    if (!this.p.allow_voting) return false;\n    this.dragged_oid = oid;\n    const pos = this.get_knob_pos(oid), x = !ev ? 0 : (ev instanceof PointerEvent) ? (<PointerEvent>ev).clientX : (<TouchEvent>ev).touches[0].clientX;\n    this.G.L.entry(\"onRatingColPointerdown\", this.sortingcounter, oid, this.p.options[oid].name, x, pos);\n    // window.alert(\"onRatingColPointerdown \" + pos.left + \" \" + x + \" \" + pos.right);\n    if ((x < pos.left) || (x > pos.right)) {\n      this.swallow_event(ev);\n      return false;\n    }\n    return true;\n  }\n\n  onRatingColTouchstart(oid: string, ev: Event): boolean {\n    /** event listener called when user starts touching slider */\n    this.p.end_if_past_due();\n    if (!this.p.allow_voting) return false;\n    this.dragged_oid = oid;\n    const pos = this.get_knob_pos(oid), x = !ev ? 0 : (ev instanceof PointerEvent) ? (<PointerEvent>ev).clientX : (<TouchEvent>ev).touches[0].clientX;\n    this.G.L.entry(\"onRatingColTouchstart\", oid, x, pos);\n    // window.alert(\"onRatingColTouchstart \" + pos.left + \" \" + x + \" \" + pos.right);\n    if ((x < pos.left) || (x > pos.right)) {\n      this.swallow_event(ev);\n      return false;\n    }\n    return true;\n  }\n\n  onRatingColPointerup(oid: string, ev: Event): boolean {\n    /** event listener called when user stops clicking slider */\n    this.p.end_if_past_due();\n    if (!this.p.allow_voting) return false;\n    // FIXME: not always firing on Android if click is too short\n    this.G.L.entry(\"onRatingColPointerup\", oid, this.dragged_oid);\n    if (oid != this.dragged_oid) {\n      this.swallow_event(ev);\n      this.dragged_oid = null;\n      return false;\n    } else {\n      this.rating_change_ended(oid);\n      this.dragged_oid = null;\n      return true;\n    }\n  }\n\n  onRatingColTouchup(oid: string, ev: Event): boolean {\n    /** event listener called when user stops touching slider */\n    this.p.end_if_past_due();\n    if (!this.p.allow_voting) return false;\n    // FIXME: not always firing on Android if click is too short\n    this.G.L.entry(\"onRatingColTouchup\", oid, this.dragged_oid);\n    if (oid != this.dragged_oid) {\n      this.swallow_event(ev);\n      this.dragged_oid = null;\n      return false;\n    } else {\n      this.rating_change_ended(oid);\n      this.dragged_oid = null;\n      return true;\n    }\n  }\n\n  onRatingColClick(oid: string, ev: MouseEvent): boolean {\n    /** event listener called after clicking or touching slider has ended */\n    this.p.end_if_past_due();\n    if (!this.p.allow_voting) return false;\n    const pos = this.get_knob_pos(oid), x = ev.clientX;\n    this.G.L.entry(\"onRatingColClick\", oid, this.p.options[oid].name, x, pos);\n    // window.alert(\"onRatingColClick \" + pos.left + \" \" + x + \" \" + pos.right);\n    if ((x < pos.left) || (x > pos.right)) {\n      this.swallow_event(ev);\n      return false;\n    }\n    return true;\n  }\n\n  onBodyPointerup(ev: Event): boolean {\n    /** event listener called when click ended outside slider area */\n    this.p.end_if_past_due();\n    if (!this.p.allow_voting) return false;\n    // if clicking started in a slider, call that slider's pointerup handler:\n    if (this.dragged_oid) {\n      this.G.L.entry(\"onBodyPointerup\");\n      this.onRatingColPointerup(this.dragged_oid, ev);\n    }\n    return true;\n  }\n\n  onBodyTouchup(ev: Event): boolean {\n    /** event listener called when touching ended outside slider area */\n    this.p.end_if_past_due();\n    if (!this.p.allow_voting) return false;\n    // if touching started in a slider, call that slider's touchup handler:\n    if (this.dragged_oid) {\n      this.G.L.entry(\"onBodyTouchup\");\n      this.onRatingColTouchup(this.dragged_oid, ev);\n    }\n    return true;\n  }\n\n  get_knob_pos(oid: string) {\n    /** get the slider knob position (left and right pixel coordinates)\n     *  to be able to compare with click/touch coordinate:\n     */\n    const slider = this.get_slider(oid), \n          slider_rect = this.get_screen_coords(slider),\n          value = this.get_slider_value(oid),\n          knob_center_x = slider_rect.left + (slider_rect.right - slider_rect.left) * value / 100;\n    this.G.L.trace(\"pointer slider value\", value);\n    return {left: knob_center_x - 20, right: knob_center_x + 20}\n  }\n\n  get_screen_coords(element: HTMLElement): DOMRect {\n    /** get the screen coordinates of an HTML element */\n    if (!element) return new DOMRect();\n    return element.getBoundingClientRect();\n  }\n\n  swallow_event(ev: Event) {\n    /** Stop any form of propagation of an event. \n     *  Used to disable slider reaction outside knob. */\n    this.G.L.trace(\"swallowing event\", ev);\n    // window.alert(\"swallow 1\");\n    // FIXME: does not work in Android app and Chrome-simulated mobile devices yet!\n    if (!!ev) {\n      // window.alert(\"swallow 2\");\n      ev.stopPropagation();\n      ev.stopImmediatePropagation();\n      ev.preventDefault();  \n    }\n  }\n\n  // DIALOGS:\n\n  currentModal = null;\n\n  async checkmark_clicked() {\n    const confirm = await this.alertCtrl.create({ \n      message: this.translate.instant(\n        'poll.checkmark-clicked'), \n      buttons: [\n        { \n          text: this.translate.instant('OK'),\n          role: 'Ok', \n          handler: () => {\n          } \n        } \n      ] \n    }); \n    await confirm.present(); \n  }\n\n  delegate_dialog(event: Event) {\n    /** open the delegation dialog popover */\n    this.p.end_if_past_due();\n    if (this.p.allow_voting) {\n      this.popover.create({\n        event, \n        component: DelegationDialogPage, \n        translucent: true,\n        showBackdrop: true,\n        componentProps: {parent: this}\n      })\n      .then((popoverElement)=>{\n        popoverElement.present();\n      });\n    }\n  }\n\n  async assist_dialog() {\n    /** open the assist modal */\n    this.p.end_if_past_due();\n    if (this.p.allow_voting) {\n      const modal = await this.modalController.create({\n          component: AssistPage, \n  //        translucent: true,\n  //        cssClass: 'assist',\n  //        showBackdrop: true,\n          componentProps: {P: this},\n          backdropDismissâ€‹: false\n  //        swipeToClose: true,\n  //        presentingElement: this.routerOutlet.nativeEl\n      });\n      modal.present();\n\n      this.currentModal = modal;\n    }\n  }\n  \n  explain_approval_dialog(oid: string) {\n    /** open the explanation dialog modal */\n    this.modalController.create({\n        component: ExplainApprovalPage, \n//        translucent: true,\n        cssClass: 'explain-approval',\n        showBackdrop: true,\n        componentProps: {parent: this, oid: oid},\n        swipeToClose: true,\n        presentingElement: this.routerOutlet.nativeEl\n    })\n    .then((modalElement)=>{\n      modalElement.present();\n    })\n  }\n\n  async revoke_delegation_dialog() { \n    /** open the delegation revokation confirmation dialog alert */\n    this.p.end_if_past_due();\n    if (this.p.allow_voting) {\n      const confirm = await this.alertCtrl.create({ \n        message: this.translate.instant(\n          'poll.revoke_delegation', {nickname: this.delegate}), \n        buttons: [\n          { \n            text: this.translate.instant('cancel'), \n            role: 'Cancel',\n            handler: () => { \n              console.log('Confirm Cancel.');  \n            } \n          },\n          { \n            text: this.translate.instant('OK'),\n            role: 'Ok', \n            handler: () => {\n              this.G.Del.revoke_delegation(this.pid, this.G.Del.get_my_outgoing_dids_cache(this.pid).get(\"*\"), '*');\n              this.delegate = null;\n              this.delegation_status = 'none';\n              this.update_delegation_info();\n              this.G.D.save_state();\n            } \n          } \n        ] \n      }); \n      await confirm.present(); \n    }\n  } \n\n  add_option(event: Event) {\n    /** open the add option dialog popover */\n    this.p.end_if_past_due();\n    if (this.p.allow_voting) {\n      // TODO: also add delegation if ospec.type == \"-\"?\n      this.popover.create({\n  //      event, // TODO: use this from Ionic v6 on!\n  //      side: 'top', // TODO: use this from Ionic v6 on!\n        component: AddoptionDialogPage, \n        translucent: true,\n        showBackdrop: true,\n        cssClass: 'add-option-class',\n        componentProps: {parent: this}\n      })\n      .then((popoverElement)=>{\n        popoverElement.present();\n      });\n    }\n  }\n\n  // Glossary buttons:\n\n  show_glossary = false;\n  glossary_key: string;\n\n  glossary(key: string) {\n    this.glossary_key = key;\n    this.show_glossary = true;\n  }\n  dismiss_glossary() {\n    this.show_glossary=false;\n  }\n\n}\n","/*\n(C) Copyright 2015â€“2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { PollPage } from './poll.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: PollPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class PollPageRoutingModule {}\n","/*\n(C) Copyright 2015â€“2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { PollPageRoutingModule } from './poll-routing.module';\nimport { SharedcomponentsModule } from '../sharedcomponents/sharedcomponents.module';\n\nimport { PollPage } from './poll.page';\nexport { PollPage } from './poll.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    PollPageRoutingModule,\n    SharedcomponentsModule,\n    TranslateModule.forChild()\n  ],\n  declarations: [PollPage]\n})\nexport class PollPageModule {}\n"],"sourceRoot":"webpack:///","file":"186.60646d26eebb8048.js"}