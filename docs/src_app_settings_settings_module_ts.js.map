{"version":3,"file":"src_app_settings_settings_module_ts.js","mappings":"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","sources":["./src/app/settings/settings-routing.module.ts","./src/app/settings/settings.module.ts","./src/app/settings/settings.page.ts"],"sourcesContent":["/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { SettingsPage } from './settings.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: SettingsPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class SettingsPageRoutingModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule, ReactiveFormsModule } from '@angular/forms';\nimport { IonicModule } from '@ionic/angular';\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { SettingsPageRoutingModule } from './settings-routing.module';\nimport { SharedcomponentsModule } from '../sharedcomponents/sharedcomponents.module';\n\nimport { SettingsPage } from './settings.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    ReactiveFormsModule,\n    SettingsPageRoutingModule,\n    SharedcomponentsModule,\n    TranslateModule.forChild()\n  ],\n  declarations: [SettingsPage]\n})\nexport class SettingsPageModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { Component, OnInit, ViewChild, ViewChildren, QueryList } from '@angular/core';\nimport { Validators, UntypedFormBuilder, UntypedFormGroup, UntypedFormControl, ValidationErrors, AbstractControl } from '@angular/forms';\nimport { TranslateService } from '@ngx-translate/core';\n\nimport { IonInput, IonSelect } from '@ionic/angular';\n\nimport { GlobalService } from \"../global.service\";\nimport { SelectServerComponent } from '../sharedcomponents/select-server/select-server.component';\nimport { environment } from 'src/environments/environment';\n\n/*\nTODO:\n- when changing password or server, alert that user needs to update password or server on other devices as well\n*/\n\n\n// PAGE:\n\n@Component({\n  selector: 'app-settings',\n  templateUrl: './settings.page.html',\n  styleUrls: ['./settings.page.scss'],\n})\nexport class SettingsPage implements OnInit {\n\n  // ATTRIBUTES:\n\n  E = environment;\n  \n  // template components:\n\n  @ViewChild(IonInput, { static: false }) input_retype_password: IonInput;\n  @ViewChild(SelectServerComponent, { static: false }) select_server: SelectServerComponent;\n  @ViewChildren(IonSelect) ionSelects: QueryList<IonSelect>;\n\n  // form:\n\n  formGroup: UntypedFormGroup;\n  editing_email: boolean;\n  editing_password: boolean;\n  showing_password: boolean;\n  advanced_expanded: boolean;\n  notify_of: { \n    delegation_accepted?: boolean,\n    delegation_declined?: boolean,\n    new_option?: boolean,\n    poll_closing_soon?:boolean,\n    poll_closed?: boolean\n  };\n\n  // LIFECYCLE:\n\n  ready = false;  \n\n  constructor(\n      public formBuilder: UntypedFormBuilder,\n      public translate: TranslateService,\n      public G: GlobalService) { \n    this.G.L.entry(\"SettingsPage.constructor\");\n  }\n\n  ngOnInit() {\n    this.G.L.entry(\"SettingsPage.ngOnInit\");\n    this.formGroup = this.formBuilder.group({\n      email: new UntypedFormControl('', Validators.compose([Validators.required, Validators.email])),\n      pw: this.formBuilder.group({\n        password: new UntypedFormControl('', Validators.compose([\n          Validators.required,\n          Validators.minLength(8),\n          Validators.pattern(this.G.S.password_regexp)\n        ])),\n        confirm_password: new UntypedFormControl('', Validators.required),\n      }, {\n        validators: [this.G.S.passwords_match]\n      }),\n      language: new UntypedFormControl('', Validators.required),\n      theme: new UntypedFormControl('', Validators.required),\n      default_wap: new UntypedFormControl('')\n    });\n  }\n  \n  ionViewWillEnter() {\n    this.G.L.entry(\"SettingsPage.ionViewWillEnter\");\n    this.G.D.page = this;\n    this.editing_email = false;\n    this.editing_password = false;\n    this.showing_password = false;\n    this.advanced_expanded = false;\n    this.notify_of = {};\n  }\n\n  ionViewDidEnter() {\n    this.G.L.entry(\"SettingsPage.ionViewDidEnter\");\n    if (this.G.D.ready && !this.ready) this.onDataReady();\n  }\n\n  onDataReady() {\n    // called when DataService initialization was slower than view initialization\n    this.G.L.entry(\"SettingsPage.onDataReady\");\n    this.ready = true;\n  }\n\n  onSelectServerReady(select_server:SelectServerComponent) {\n    // called by SelectServerComponent is ready\n    this.select_server = select_server;\n    this.fill_form();\n  }\n\n  ionViewDidLeave() {\n    this.G.L.entry(\"SettingsPage.ionViewDidLeave\");\n    this.G.D.save_state();\n    this.G.L.exit(\"SettingsPage.ionViewDidLeave\");\n  }\n\n  // OTHER HOOKS:\n  \n  // for DataService:\n\n  onDataChange() {\n    // called whenever data stored in database has changed\n    this.G.L.entry(\"SettingsPage.onDataChange\");\n    this.fill_form();\n  }\n\n  // for form actions:\n\n  set_email() {\n    let c = this.formGroup.get('email');\n    if (c.valid) this.G.S.email = c.value; // will trigger data move\n  }\n  set_password() {\n    let fg = this.formGroup.get('pw');\n    if (fg.valid) this.G.S.password = fg.get('password').value; // will trigger data move\n  }\n  set_language() {\n    let c = this.formGroup.get('language');\n    if (c.valid) this.G.S.language = c.value;\n  }\n  set_theme() {\n    let c = this.formGroup.get('theme');\n    if (c.valid) this.G.S.theme = c.value;\n  }\n  set_default_wap() {\n    let c = this.formGroup.get('default_wap');\n    this.G.S.default_wap = c.value;\n  }\n\n  // selectServer component hooks:\n\n  set_db(value: string) {\n    this.G.S.db = value;\n  }\n  set_db_from_pid(value: string) {\n    this.G.S.db_from_pid = value;\n  }\n  set_db_custom_server_url(value: string) {\n    this.G.S.db_custom_server_url = value;\n  }\n  set_db_custom_password(value: string) {\n    this.G.S.db_custom_password = value;\n  }\n\n  // OTHER METHODS:\n\n  private fill_form() {\n    this.G.L.entry(\"SettingsPage.fill_form\");\n    // fill form fields with values from data or defaults\n    const preferred_lang = navigator.language.slice(0,2);\n    this.formGroup.setValue({\n      email: this.G.S.email||'',\n      pw: {\n        password: this.G.S.password||'',\n        confirm_password: this.G.S.password||'',\n      },\n      language: this.G.S.language||(this.translate.langs.includes(preferred_lang)?preferred_lang:'en'),\n      theme: this.G.S.theme||'light',\n      default_wap: this.G.S.default_wap||0\n    });\n    this.select_server.selectServerFormGroup.setValue({\n      db: this.G.S.db||'',\n      db_from_pid: this.G.S.db_from_pid||'',\n      db_custom_server_url: this.G.S.db_custom_server_url||'',\n      db_custom_password: this.G.S.db_custom_password||'',\n    });\n    for (const cls of this.G.S.notification_classes) {\n      this.notify_of[cls] = this.G.S.get_notify_of(cls);\n    }\n  }\n\n  notify_changed() {\n    for (const [cls, value] of Object.entries(this.notify_of)) {\n      this.G.S.set_notify_of(cls, value as boolean);\n      this.G.L.trace(\"SettingsPage.notify_changed\", cls, value);\n    }\n  }\n\n}\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}