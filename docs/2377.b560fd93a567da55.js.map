{"version":3,"mappings":"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","names":["i0","ctx_r3","ctx_r5","routes","path","component","constructor","router","route","translate","G","this","L","entry","params","subscribe","pid","ngOnInit","ionViewWillEnter","D","page","came_from_preview","details_expanded","can_use_web_share","navigator","share","can_share","Capacitor","ionViewDidEnter","ready","onDataReady","debug","P","polls","p","state","warn","navigate","invite_link","environment","encodeURIComponent","db_server_url","db_password","password","info","message_title","instant","due","format_date","message_body","String","fromCharCode","repeat","title","email_href","ionViewDidLeave","save_state","exit","share_button_clicked","Share","text","dialogTitle","then","res","catch","err","error","copy_button_clicked","window","clipboard","writeText","LocalNotifications","notifications","body","id","trace","InvitetoPage","selectors","InvitetoPageRoutingModule","RouterModule","InvitetoPageModule","CommonModule","FormsModule","IonicModule","TranslateModule"],"sources":["./src/app/inviteto/inviteto.page.html","./src/app/inviteto/inviteto-routing.module.ts","./src/app/inviteto/inviteto.page.ts","./src/app/inviteto/inviteto.module.ts"],"sourcesContent":["<!--\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK) authors, and contributors, see AUTHORS.md.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n-->\n\n<ion-header>\n  <ion-toolbar style=\"padding-right:11px;\">\n    <ion-buttons slot=\"start\">\n      <ion-menu-button></ion-menu-button>\n    </ion-buttons>\n    <ion-title [innerHtml]=\"'inviteto.-page-title'|translate\"></ion-title>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content *ngIf=\"ready && (p!=null)\">\n  <ion-list lines=\"full\">\n    <ion-item color=\"warning\">\n      <ion-col class=\"ion-no-padding ion-no-margin\">\n        <p [innerHtml]=\"(came_from_preview?'inviteto.first-intro':'inviteto.later-intro')|translate\"></p>\n      </ion-col>\n    </ion-item>\n<!--\n    <ion-item (click)=\"details_expanded=!details_expanded\">\n      <ion-col class=\"ion-no-padding ion-no-margin\">\n        <ion-icon class=\"poll-type\"\n          [name]=\"p.type=='winner'?'trophy':'cut'\"\n          style=\"color:black\">\n        </ion-icon>&nbsp;\n        <i [innerHtml]=\"p.title\"></i>\n        <ng-container *ngIf=\"details_expanded\">\n          <p *ngIf=\"((p.desc||'')!='')||((p.url||'')!='')\">\n            <i *ngIf=\"(p.desc||'')!=''\"><small [innerHtml]=\"p.desc\"></small></i>\n            <small *ngIf=\"(p.url||'')!=''\">\n              &nbsp;(<a [href]=\"G.D.fix_url(p.url)\" target=\"_blank\" rel=\"noopener noreferrer\">\n                  <ion-text color=\"primary\" [innerHtml]=\"'read-more'|translate\"></ion-text>\n                </a>)\n            </small>\n          </p>\n          <p>\n            <small [innerHtml]=\"'previewpoll.closes'|translate\"></small>&nbsp;<small color=\"primary\" [innerHtml]=\"((p.due_type!='custom')?('draftpoll.due-type-'+p.due_type|translate):G.D.format_date(p.due))+'.'\"></small>\n          </p>\n        </ng-container>\n      </ion-col>\n      <ion-buttons slot=\"end\">\n        <ion-icon \n          [name]=\"details_expanded?'caret-down-outline':'caret-back-outline'\" \n          size=\"small\" color=\"primary\">\n        </ion-icon>\n      </ion-buttons>\n    </ion-item>\n-->\n    <!--TODO: disable buttons and notify if due is in the past by now-->\n    <ng-container *ngIf=\"can_share\">\n      <ion-item lines=\"none\">\n        <ion-col class=\"ion-no-padding ion-no-margin\">\n          <p [innerHtml]=\"'inviteto.caution-with-share1'|translate\"></p> \n          <small><p [innerHtml]=\"'inviteto.caution2'|translate\"></p></small> \n        </ion-col>      \n      </ion-item>\n      <ion-item lines=\"none\" class=\"ion-text-end\" text-wrap>\n        <ion-button size=\"large\" color=\"primary\" slot=\"end\" [disabled]=\"false\" \n            shape=\"round\"\n            (click)=\"share_button_clicked()\">\n          <span [innerHtml]=\"'inviteto.share'|translate\"></span>&nbsp;\n          <ion-icon name=\"share-social-outline\"></ion-icon> <!--TODO: use correct share icon-->\n        </ion-button>\n      </ion-item>\n    </ng-container>\n    <ng-container *ngIf=\"!can_share\">\n      <ion-item lines=\"none\">\n        <ion-col class=\"ion-no-padding ion-no-margin\">\n          <p [innerHtml]=\"'inviteto.caution-without-share1'|translate\"></p> \n          <p><small [innerHtml]=\"'inviteto.caution2'|translate\"></small></p> \n        </ion-col>      \n      </ion-item>\n    </ng-container>\n    <ion-item \n        lines=\"none\" class=\"ion-text-end\" text-wrap>\n      <!--TODO: disable if due is in the past by now-->\n      <ion-button size=\"large\" color=\"primary\" slot=\"end\" [disabled]=\"false\" \n            shape=\"round\">\n        <a [href]=\"email_href\" target=\"_top\" style=\"color:inherit;text-decoration:inherit\">\n          <span [innerHtml]=\"'inviteto.compose-email'|translate\"></span>&nbsp;\n          <ion-icon name=\"mail-open-outline\"></ion-icon> <!--TODO: make icon show in correct size and alignment-->\n        </a>\n      </ion-button>\n    </ion-item>\n    <ion-item \n        lines=\"none\" class=\"ion-text-end\" text-wrap>\n      <!--TODO: disable if due is in the past by now-->\n      <ion-button size=\"large\" color=\"primary\" slot=\"end\" [disabled]=\"false\" \n          shape=\"round\"\n          (click)=\"copy_button_clicked()\">\n        <span [innerHtml]=\"'inviteto.copy-link'|translate\"></span>&nbsp;\n        <ion-icon name=\"copy-outline\"></ion-icon> <!--TODO: use correct clipboard icon-->\n      </ion-button>\n    </ion-item>\n\n    <ion-item lines=\"none\" class=\"ion-text-center\">\n        <p>&nbsp;</p>\n        <p>&nbsp;</p>\n        <ion-button class=\"ion-no-margin ion-no-padding\" fill=\"clear\" size=\"small\" [routerLink]=\"'/poll/'+p.pid\">\n          <ion-icon name=\"arrow-forward-outline\" size=\"small\"></ion-icon>&nbsp;<span [innerHtml]=\"'go-to-poll'|translate\"></span>\n        </ion-button>  \n    </ion-item>  \n\n\n  </ion-list>\n\n</ion-content>\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK) authors, and contributors, see AUTHORS.md.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { InvitetoPage } from './inviteto.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: InvitetoPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class InvitetoPageRoutingModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK) authors, and contributors, see AUTHORS.md.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { Component, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { TranslateService } from '@ngx-translate/core';\n\nimport { Capacitor } from '@capacitor/core';\nimport { Share } from '@capacitor/share';\nimport { LocalNotifications } from '@capacitor/local-notifications';\n\nimport { GlobalService } from \"../global.service\";\nimport { Poll } from '../poll.service';\n\nimport { environment } from '../../environments/environment';\n\n@Component({\n  selector: 'app-inviteto',\n  templateUrl: './inviteto.page.html',\n  styleUrls: ['./inviteto.page.scss'],\n})\nexport class InvitetoPage implements OnInit {\n\n  pid: string;\n  p: Poll;\n  came_from_preview: boolean;\n  details_expanded: boolean;\n  invite_link: string;\n  message_title: string;\n  message_body: string;\n  email_href: string;\n  can_use_web_share: boolean;\n  can_share: boolean;\n\n  // LIFECYCLE:\n\n  ready = false;  \n\n  constructor(\n    public router: Router,\n    private route: ActivatedRoute,\n    public translate: TranslateService,\n    public G: GlobalService) {\n    this.G.L.entry(\"InvitetoPage.constructor\");\n    this.route.params.subscribe( params => { \n      this.pid = params['pid'];\n    } );\n  }\n\n  ngOnInit() {\n    this.G.L.entry(\"InvitetoPage.ngOnInit\");\n  }\n\n  ionViewWillEnter() {\n    this.G.L.entry(\"InvitetoPage.ionViewWillEnter\");\n    this.G.D.page = this;\n    this.came_from_preview = true; // TODO: set depending on url!\n    this.details_expanded = false;\n    this.can_use_web_share = (typeof navigator.share === \"function\");\n    this.can_share = Capacitor.isNativePlatform() || this.can_use_web_share;\n  }\n\n  ionViewDidEnter() {\n    this.G.L.entry(\"InvitetoPage.ionViewDidEnter\");\n    if (this.G.D.ready) {\n      this.onDataReady();\n    }\n    this.G.L.debug(\"InvitetoPage.ready:\", this.ready);\n  }\n\n  onDataReady() {\n    // called when DataService initialization was slower than view initialization\n    this.G.L.entry(\"InvitetoPage.onDataReady\");\n    if (this.pid in this.G.P.polls) {\n      this.p = this.G.P.polls[this.pid];\n      if (this.p.state == 'draft') {\n        this.G.L.warn(\"InvitetoPage called for draft poll, redirecting to mypolls page\", this.pid);\n        this.router.navigate([\"/mypolls\"]);\n      } \n    } else {\n      this.G.L.warn(\"InvitetoPage unknown pid ignored, redirecting to mypolls page\", this.pid, this.G.P.polls);\n      this.router.navigate([\"/mypolls\"]);\n    }\n    this.invite_link = (\n      environment.magic_link_base_url + \"joinpoll/\" \n      + encodeURIComponent(this.p.db_server_url) + \"/\" \n      + encodeURIComponent(this.p.db_password) + \"/\" \n      + this.pid + \"/\" \n      + this.p.password);\n    this.G.L.info(\"InvitetoPage invite link:\", this.invite_link);\n    // TODO: make indentation in body work:\n    this.message_title = this.translate.instant('invite-email.subject', {due: this.G.D.format_date(this.p.due)});\n    this.message_body = (this.translate.instant('invite-email.body-greeting') + \"\\n\\n\" \n                + this.translate.instant('invite-email.body-before-title') + \"\\n\\n\"\n                + String.fromCharCode(160).repeat(4) + this.p.title + \".\\n\\n\"\n                + this.translate.instant('invite-email.body-closes', {due: this.G.D.format_date(this.p.due)}) + \"\\n\\n\"\n                + this.translate.instant('invite-email.body-before-link') + \"\\n\\n\" \n                + String.fromCharCode(160).repeat(4) + this.invite_link + \"\\n\\n\"\n                + this.translate.instant('invite-email.body-dont-share') + \"\\n\\n\"\n                + this.translate.instant('invite-email.body-regards'));\n    this.email_href = \"mailto:?subject=\" + encodeURIComponent(this.message_title) + \"&body=\" + encodeURIComponent(this.message_body);\n    this.ready = true;\n  }\n\n  ionViewDidLeave() {\n    this.G.L.entry(\"InvitetoPage.ionViewDidLeave\");\n    this.G.D.save_state();\n    this.G.L.exit(\"InvitetoPage.ionViewDidLeave\");\n  }\n  \n  // HOOKS:\n\n  share_button_clicked() {\n    this.G.L.entry(\"InvitetoPage.share_button_clicked\");\n    Share.share({\n      title: this.message_title,\n      text: this.message_body,\n//      url: this.invite_link, // not added since contained in body, otherwise will appear twice...\n      dialogTitle: 'Share vodle invite link',\n    }).then(res => {\n      this.G.L.info(\"InvitetoPage.share_button_clicked succeeded\", res);\n    }).catch(err => {\n      this.G.L.error(\"InvitetoPage.share_button_clicked failed\", err);\n    });\n/*\n    try {\n      navigator.share({ title: title, url: this.invite_link })\n      .then(() => {\n        console.log(\"Data was shared successfully\");\n      }).catch(err => {\n      console.error(\"Share failed:\", err);\n      });\n    } catch (err) {\n      console.error(\"Share not invoked:\", err);\n    }\n*/\n  }\n\n  copy_button_clicked() {\n    this.G.L.entry(\"InvitetoPage.copy_button_clicked\");\n    window.navigator.clipboard.writeText(this.invite_link);\n    LocalNotifications.schedule({\n      notifications: [{\n        title: this.translate.instant(\"inviteto.notification-copied-link-title\"),\n        body: this.translate.instant(\"inviteto.notification-copied-link-body\"),\n        id: null\n      }]\n    })\n    .then(res => {\n      this.G.L.trace(\"InvitetoPage.copy_button_clicked localNotifications.schedule succeeded:\", res);\n    }).catch(err => {\n      this.G.L.warn(\"InvitetoPage.copy_button_clicked localNotifications.schedule failed:\", err);\n    });\n    this.G.L.exit(\"InvitetoPage.copy_button_clicked\");\n  }\n}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK) authors, and contributors, see AUTHORS.md.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { InvitetoPageRoutingModule } from './inviteto-routing.module';\n\nimport { InvitetoPage } from './inviteto.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    InvitetoPageRoutingModule,\n    TranslateModule.forChild()\n  ],\n  declarations: [InvitetoPage]\n})\nexport class InvitetoPageModule {}\n"],"sourceRoot":"webpack:///","file":"2377.b560fd93a567da55.js"}