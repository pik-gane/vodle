{"version":3,"file":"src_app_mypolls_mypolls_module_ts.js","mappings":"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","sources":["./src/app/mypolls/mypolls.page.ts","./src/app/mypolls/mypolls-routing.module.ts","./src/app/mypolls/mypolls.page.scss","./src/app/mypolls/mypolls.module.ts"],"sourcesContent":["/*\r\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\r\n\r\nThis file is part of vodle.\r\n\r\nvodle is free software: you can redistribute it and/or modify it under the \r\nterms of the GNU Affero General Public License as published by the Free \r\nSoftware Foundation, either version 3 of the License, or (at your option) \r\nany later version.\r\n\r\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \r\nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \r\nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \r\ndetails.\r\n\r\nYou should have received a copy of the GNU Affero General Public License \r\nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \r\n*/\r\n\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { TranslateService } from '@ngx-translate/core';\r\nimport { news_t } from '../data.service';\r\n\r\nimport { GlobalService } from \"../global.service\";\r\nimport { Poll } from \"../poll.service\";\r\nimport { RouterModule } from '@angular/router';\r\nimport { IonicModule } from '@ionic/angular';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\nimport { CommonModule } from '@angular/common';\r\n@Component({\r\n  imports: [ CommonModule, IonicModule, TranslateModule, RouterModule ],\r\n  selector: 'app-mypolls',\r\n  templateUrl: './mypolls.page.html',\r\n  styleUrls: ['./mypolls.page.scss'],\r\n})\r\nexport class MypollsPage implements OnInit {\r\n\r\n  Object = Object;\r\n  window = window;\r\n\r\n  news: Set<news_t> = new Set();\r\n\r\n  unanswered_requests = []; \r\n\r\n  closed_expanded = false;\r\n  drafts_expanded = false;\r\n  older_expanded = false;\r\n\r\n  // LIFECYCLE:\r\n\r\n  ready: boolean;\r\n\r\n  constructor(\r\n    public G: GlobalService,\r\n    public translate: TranslateService\r\n  ) { \r\n    this.G.L.entry(\"MypollsPage.constructor\");\r\n  }\r\n  \r\n  ngOnInit() {\r\n    this.G.L.entry(\"MypollsPage.ngOnInit\");\r\n    this.ready = false;\r\n  }\r\n\r\n  ionViewWillEnter() {\r\n    this.G.L.entry(\"MypollsPage.ionViewWillEnter\");\r\n    this.G.D.page = this;\r\n    if (this.ready) this.onDataChange();\r\n  }\r\n\r\n  ionViewDidEnter() {\r\n    this.G.L.entry(\"MypollsPage.ionViewDidEnter\", this.G.D.ready, this.ready);\r\n    if (this.G.D.ready && !this.ready) this.onDataReady();\r\n  }\r\n\r\n  onDataReady() {\r\n    // called when DataService initialization was slower than view initialization\r\n    this.G.L.entry(\"MypollsPage.onDataReady\");\r\n    this.onDataChange();\r\n    this.ready = true;\r\n  }\r\n\r\n  onDataChange() {\r\n    this.G.L.entry(\"MypollsPage.onDataChange\");\r\n    this.news = new Set([\r\n      ...this.G.N.filter({class: 'new_option'}),\r\n      ...this.G.N.filter({class: 'delegation_accepted'}),\r\n      ...this.G.N.filter({class: 'delegation_declined'}),\r\n      ...this.G.N.filter({class: 'poll_closed'})      \r\n    ]);\r\n    this.unanswered_requests = [];\r\n    for (const pid in this.G.P.polls) {\r\n      const cache = this.G.D.incoming_dids_caches[pid];\r\n      var newcache = this.G.D.incoming_dids_caches[pid];\r\n      if (cache) {\r\n        for (let [did, [from, url, status]] of cache) {\r\n          if ([\"possible\",\"two-way\",\"cycle\"].includes(status)) {\r\n            console.log(\"onDataChange\", pid, did, from, url, status);\r\n            this.G.L.trace(\"MypollsPage.onDataChange found unanswered request\", did, from, url, status);\r\n            // check if request has been revoked:\r\n            const a = this.G.Del.get_agreement(pid, did);\r\n            if (this.G.D.getv(pid, \"del_status.\" + did, a.client_vid) === 'revoked') {\r\n              // delete request from cache:\r\n              newcache.delete(did);\r\n              continue;\r\n            }\r\n\r\n            this.unanswered_requests.push({pid:pid, did:did, from:from, url:url, status:status});\r\n          }\r\n        }  \r\n      }\r\n      this.G.D.incoming_dids_caches[pid] = newcache; // update cache to remove revoked requests\r\n    }\r\n  }\r\n\r\n  ionViewWillLeave() {\r\n    this.G.L.entry(\"MypollsPage.ionViewWillLeave\");\r\n    this.G.L.exit(\"MypollsPage.ionViewWillLeave\");\r\n  }\r\n\r\n  ionViewDidLeave() {\r\n    this.G.L.entry(\"MypollsPage.ionViewDidLeave\");\r\n    this.G.D.save_state();\r\n    this.G.L.exit(\"MypollsPage.ionViewDidLeave\");\r\n  }\r\n\r\n  // user actions:\r\n\r\n  can_invite(p: Poll) {\r\n    // TODO: only author can invite? \r\n    return p.creator == this.G.S.email;\r\n  }\r\n\r\n  // helper methods:\r\n\r\n  get running_polls(): Poll[] {\r\n    // return polls sorted by what part of their time is left:\r\n    return Object.values(this.G.P.polls)\r\n      .filter((p) => p.state=='running')\r\n      .sort((p1, p2) => p1.remaining_time_fraction - p2.remaining_time_fraction);\r\n  } \r\n\r\n  get closed_polls(): Poll[] {\r\n    // return polls sorted by due:\r\n    return Object.values(this.G.P.polls)\r\n      .filter((p) => p.state=='closed' && !!p.due)\r\n      .sort((p1, p2) => p2.due.getTime() - p1.due.getTime());\r\n  } \r\n\r\n}\r\n","/*\r\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\r\n\r\nThis file is part of vodle.\r\n\r\nvodle is free software: you can redistribute it and/or modify it under the \r\nterms of the GNU Affero General Public License as published by the Free \r\nSoftware Foundation, either version 3 of the License, or (at your option) \r\nany later version.\r\n\r\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \r\nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \r\nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \r\ndetails.\r\n\r\nYou should have received a copy of the GNU Affero General Public License \r\nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \r\n*/\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { Routes, RouterModule } from '@angular/router';\r\n\r\nimport { MypollsPage } from './mypolls.page';\r\n\r\nconst routes: Routes = [\r\n  {\r\n    path: '',\r\n    component: MypollsPage\r\n  }\r\n];\r\n\r\n@NgModule({\r\n  imports: [RouterModule.forChild(routes)],\r\n  exports: [RouterModule],\r\n})\r\nexport class MypollsPageRoutingModule {}\r\n","// Imports\nvar ___CSS_LOADER_API_SOURCEMAP_IMPORT___ = require(\"../../../node_modules/css-loader/dist/runtime/sourceMaps.js\");\nvar ___CSS_LOADER_API_IMPORT___ = require(\"../../../node_modules/css-loader/dist/runtime/api.js\");\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, `@charset \"UTF-8\";\n/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/`, \"\",{\"version\":3,\"sources\":[\"webpack://./src/app/mypolls/mypolls.page.scss\"],\"names\":[],\"mappings\":\"AAAA,gBAAgB;AAAhB;;;;;;;;;;;;;;;;;CAAA\",\"sourcesContent\":[\"/*\\r\\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\\r\\n\\r\\nThis file is part of vodle.\\r\\n\\r\\nvodle is free software: you can redistribute it and/or modify it under the \\r\\nterms of the GNU Affero General Public License as published by the Free \\r\\nSoftware Foundation, either version 3 of the License, or (at your option) \\r\\nany later version.\\r\\n\\r\\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \\r\\nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \\r\\nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \\r\\ndetails.\\r\\n\\r\\nYou should have received a copy of the GNU Affero General Public License \\r\\nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \\r\\n*/\\r\\n\\r\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nmodule.exports = ___CSS_LOADER_EXPORT___.toString();\n","/*\r\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\r\n\r\nThis file is part of vodle.\r\n\r\nvodle is free software: you can redistribute it and/or modify it under the \r\nterms of the GNU Affero General Public License as published by the Free \r\nSoftware Foundation, either version 3 of the License, or (at your option) \r\nany later version.\r\n\r\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \r\nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \r\nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \r\ndetails.\r\n\r\nYou should have received a copy of the GNU Affero General Public License \r\nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \r\n*/\r\n\r\nimport { NgModule } from '@angular/core';\r\nimport { CommonModule } from '@angular/common';\r\nimport { FormsModule } from '@angular/forms';\r\nimport { TranslateModule } from '@ngx-translate/core';\r\n\r\nimport { IonicModule } from '@ionic/angular';\r\n\r\nimport { MypollsPageRoutingModule } from './mypolls-routing.module';\r\n\r\nimport { MypollsPage } from './mypolls.page';\r\n\r\n@NgModule({\r\n  imports: [\r\n    CommonModule,\r\n    FormsModule,\r\n    IonicModule,\r\n    MypollsPageRoutingModule,\r\n    TranslateModule.forChild(),\r\n    MypollsPage\r\n  ]\r\n})\r\nexport class MypollsPageModule {}\r\n"],"names":["Component","TranslateService","GlobalService","RouterModule","IonicModule","TranslateModule","CommonModule","MypollsPage","constructor","G","translate","Object","window","news","Set","unanswered_requests","closed_expanded","drafts_expanded","older_expanded","L","entry","ngOnInit","ready","ionViewWillEnter","D","page","onDataChange","ionViewDidEnter","onDataReady","N","filter","class","pid","P","polls","cache","incoming_dids_caches","newcache","did","from","url","status","includes","console","log","trace","a","Del","get_agreement","getv","client_vid","delete","push","ionViewWillLeave","exit","ionViewDidLeave","save_state","can_invite","p","creator","S","email","running_polls","values","state","sort","p1","p2","remaining_time_fraction","closed_polls","due","getTime","__decorate","imports","selector","template","__NG_CLI_RESOURCE__0","NgModule","routes","path","component","MypollsPageRoutingModule","forChild","exports","FormsModule","MypollsPageModule"],"sourceRoot":"webpack:///","x_google_ignoreList":[]}