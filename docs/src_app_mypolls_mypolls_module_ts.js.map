{"version":3,"file":"src_app_mypolls_mypolls_module_ts.js","mappings":"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","sources":["./src/app/mypolls/mypolls-routing.module.ts","./src/app/mypolls/mypolls.module.ts","./src/app/mypolls/mypolls.page.ts"],"sourcesContent":["/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\n\nimport { MypollsPage } from './mypolls.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: MypollsPage\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule],\n})\nexport class MypollsPageRoutingModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { TranslateModule } from '@ngx-translate/core';\n\nimport { IonicModule } from '@ionic/angular';\n\nimport { MypollsPageRoutingModule } from './mypolls-routing.module';\n\nimport { MypollsPage } from './mypolls.page';\n\n@NgModule({\n  imports: [\n    CommonModule,\n    FormsModule,\n    IonicModule,\n    MypollsPageRoutingModule,\n    TranslateModule.forChild()\n  ],\n  declarations: [MypollsPage]\n})\nexport class MypollsPageModule {}\n","/*\n(C) Copyright 2015–2022 Potsdam Institute for Climate Impact Research (PIK), authors, and contributors, see AUTHORS file.\n\nThis file is part of vodle.\n\nvodle is free software: you can redistribute it and/or modify it under the \nterms of the GNU Affero General Public License as published by the Free \nSoftware Foundation, either version 3 of the License, or (at your option) \nany later version.\n\nvodle is distributed in the hope that it will be useful, but WITHOUT ANY \nWARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR \nA PARTICULAR PURPOSE. See the GNU Affero General Public License for more \ndetails.\n\nYou should have received a copy of the GNU Affero General Public License \nalong with vodle. If not, see <https://www.gnu.org/licenses/>. \n*/\n\nimport { Component, OnInit } from '@angular/core';\nimport { TranslateService } from '@ngx-translate/core';\nimport { news_t } from '../data.service';\n\nimport { GlobalService } from \"../global.service\";\nimport { Poll } from \"../poll.service\";\n\n@Component({\n  selector: 'app-mypolls',\n  templateUrl: './mypolls.page.html',\n  styleUrls: ['./mypolls.page.scss'],\n})\nexport class MypollsPage implements OnInit {\n\n  Object = Object;\n  window = window;\n\n  news: Set<news_t> = new Set();\n\n  unanswered_requests = []; \n\n  closed_expanded = false;\n  drafts_expanded = false;\n  older_expanded = false;\n\n  // LIFECYCLE:\n\n  ready: boolean;\n\n  constructor(\n    public G: GlobalService,\n    public translate: TranslateService\n  ) { \n    this.G.L.entry(\"MypollsPage.constructor\");\n  }\n  \n  ngOnInit() {\n    this.G.L.entry(\"MypollsPage.ngOnInit\");\n    this.ready = false;\n  }\n\n  ionViewWillEnter() {\n    this.G.L.entry(\"MypollsPage.ionViewWillEnter\");\n    this.G.D.page = this;\n    if (this.ready) this.onDataChange();\n  }\n\n  ionViewDidEnter() {\n    this.G.L.entry(\"MypollsPage.ionViewDidEnter\", this.G.D.ready, this.ready);\n    if (this.G.D.ready && !this.ready) this.onDataReady();\n  }\n\n  onDataReady() {\n    // called when DataService initialization was slower than view initialization\n    this.G.L.entry(\"MypollsPage.onDataReady\");\n    this.onDataChange();\n    this.ready = true;\n  }\n\n  onDataChange() {\n    this.G.L.entry(\"MypollsPage.onDataChange\");\n    this.news = new Set([\n      ...this.G.N.filter({class: 'new_option'}),\n      ...this.G.N.filter({class: 'delegation_accepted'}),\n      ...this.G.N.filter({class: 'delegation_declined'}),\n      ...this.G.N.filter({class: 'poll_closed'})      \n    ]);\n    this.unanswered_requests = [];\n    for (const pid in this.G.P.polls) {\n      const cache = this.G.D.incoming_dids_caches[pid];\n      if (cache) {\n        for (let [did, [from, url, status]] of cache) {\n          if ([\"possible\",\"two-way\",\"cycle\"].includes(status)) {\n            this.G.L.trace(\"MypollsPage.onDataChange found unanswered request\", did, from, url, status);\n            this.unanswered_requests.push({pid:pid, did:did, from:from, url:url, status:status});\n          }\n        }  \n      }\n    }\n  }\n\n  ionViewWillLeave() {\n    this.G.L.entry(\"MypollsPage.ionViewWillLeave\");\n    this.G.L.exit(\"MypollsPage.ionViewWillLeave\");\n  }\n\n  ionViewDidLeave() {\n    this.G.L.entry(\"MypollsPage.ionViewDidLeave\");\n    this.G.D.save_state();\n    this.G.L.exit(\"MypollsPage.ionViewDidLeave\");\n  }\n\n  // user actions:\n\n  can_invite(p: Poll) {\n    // TODO: only author can invite? \n    return p.creator == this.G.S.email;\n  }\n\n  // helper methods:\n\n  get running_polls(): Poll[] {\n    // return polls sorted by what part of their time is left:\n    return Object.values(this.G.P.polls)\n      .filter((p) => p.state=='running')\n      .sort((p1, p2) => p1.remaining_time_fraction - p2.remaining_time_fraction);\n  } \n\n  get closed_polls(): Poll[] {\n    // return polls sorted by due:\n    return Object.values(this.G.P.polls)\n      .filter((p) => p.state=='closed' && !!p.due)\n      .sort((p1, p2) => p2.due.getTime() - p1.due.getTime());\n  } \n\n}\n"],"names":[],"sourceRoot":"webpack:///","x_google_ignoreList":[]}