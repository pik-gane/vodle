;
(self.AMP=self.AMP||[]).push({m:1,v:"2203281422000",n:"amp-story-360",ev:"0.1",l:!0,f:function(t,i){(()=>{var i,n=class{constructor(){this.promise=new Promise(((t,i)=>{this.resolve=t,this.reject=i}))}},s="load-end",{isArray:e}=Array,{hasOwnProperty:o,toString:r}=Object.prototype;function a(t,i,n,s,e,o,r,a,h,l,c){return t}function h(t){if(a(function(t){const i=t.tagName;return i.startsWith("AMP-")&&!("AMP-STICKY-AD-TOP-PADDING"==i||"AMP-BODY"==i)}(t)),t.createdCallback)return Promise.resolve(t);if(!t.__AMP_UPG_PRM){const i=new n;t.__AMP_UPG_PRM=i.promise,t.__AMP_UPG_RES=i.resolve}const i=t.__AMP_UPG_PRM;return a(i),i}function l(t,i,n){return i in t?Object.defineProperty(t,i,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[i]=n,t}function c(t,i){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);i&&(s=s.filter((function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable}))),n.push.apply(n,s)}return n}function u(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?c(Object(n),!0).forEach((function(i){l(t,i,n[i])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):c(Object(n)).forEach((function(i){Object.defineProperty(t,i,Object.getOwnPropertyDescriptor(n,i))}))}return t}function m(t,i){if(!!i===i||null==i)return;if(Array.isArray(i))return void i.forEach((i=>{m(t,i)}));const n=i;t.appendChild(n.nodeType?n:self.document.createTextNode(String(i)))}function p(t,i,...n){if("string"!=typeof t)return t(u(u({},i),{},{children:n}));const s=null==i?void 0:i.xmlns;s&&delete i.xmlns;const e=s?self.document.createElementNS(s,t):self.document.createElement(t);return m(e,n),i&&Object.keys(i).forEach((t=>{!function(t,i,n){if(!1!==n&&null!=n)if("function"!=typeof n||"o"!==i[0]||"n"!==i[1])t.setAttribute(i,!0===n?"":String(n));else{const s=i.toLowerCase().substring(2);t.addEventListener(s,n)}}(e,t,i[t])})),e}function f(t){return(t.ownerDocument||t).defaultView}var d=self.AMP_CONFIG||{},v=("string"==typeof d.thirdPartyFrameRegex?new RegExp(d.thirdPartyFrameRegex):d.thirdPartyFrameRegex,("string"==typeof d.cdnProxyRegex?new RegExp(d.cdnProxyRegex):d.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/);function g(t){if(!self.document||!self.document.head)return null;if(self.location&&v.test(self.location.origin))return null;const i=self.document.head.querySelector(`meta[name="${t}"]`);return i&&i.getAttribute("content")||null}function x(t){if(!t)return null;const i=t.match(/^(.*)\/(.*)-([0-9.]+|latest)(\.max)?\.(?:js|mjs)$/i),n=i?i[2]:void 0,s=i?i[3]:void 0;return n&&s?{extensionId:n,extensionVersion:s}:null}d.thirdPartyUrl,d.thirdPartyFrameHost,d.cdnUrl||g("runtime-host"),d.errorReportingUrl,d.betaErrorReportingUrl,d.localDev,d.geoApiUrl||g("amp-geo-api"),self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};var y=self.__AMP_LOG;function _(t,i){throw new Error("failed to call initLogConstructor")}function P(t){return y.user||(y.user=w()),function(t,i){return i&&i.ownerDocument.defaultView!=t}(y.user.win,t)?y.userForEmbed||(y.userForEmbed=w()):y.user}function w(t){return _()}function b(t,i,n,s,e,o,r,a,h,l,c){return t}function A(t,i,n,s,e,o,r,a,h,l,c){return P().assert(t,i,n,s,e,o,r,a,h,l,c)}function R(t,i){return S(t=function(t){return t.__AMP_TOP||(t.__AMP_TOP=t)}(t),i)}function M(t,i){return V(t,i)}function I(t){return t.nodeType?(i=f(t),R(i,"ampdoc")).getAmpDoc(t):t;var i}function E(t){const i=I(t);return i.isSingleDoc()?i.win:i}function S(t,i){b(q(t,i));const n=O(t)[i];return n.obj||(b(n.ctor),b(n.context),n.obj=new n.ctor(n.context),b(n.obj),n.context=null,n.resolve&&n.resolve(n.obj)),n.obj}function T(t,i){const s=V(t,i);if(s)return s;const e=O(t);return e[i]=function(){const t=new n,{promise:i,reject:s,resolve:e}=t;return i.catch((()=>{})),{obj:null,promise:i,resolve:e,reject:s,context:null,ctor:null}}(),e[i].promise}function V(t,i){const n=O(t)[i];return n?n.promise?n.promise:(S(t,i),n.promise=Promise.resolve(n.obj)):null}function O(t){let i=t.__AMP_SERVICES;return i||(i=t.__AMP_SERVICES={}),i}function q(t,i){const n=t.__AMP_SERVICES&&t.__AMP_SERVICES[i];return!(!n||!n.ctor)}var z,j=t=>function(t,i){return S(E(I(t)),i)}(t,"owners"),k=t=>function(t,i,n,s,e){return M(t,i)||function(t,i,n,s,e){return(o=t.document,new Promise((t=>function(t,i){!function(t,i,n){if(i())n();else{const s=new(f(t).MutationObserver)((()=>{i()&&(s.disconnect(),n())}));s.observe(t,{childList:!0})}}(t.documentElement,(()=>!!t.body),i)}(o,t)))).then((()=>{const i=R(t,"extensions");return function(t,i,n){return function(t){if(!t)return[];const i=t.querySelectorAll("script[custom-element],script[custom-template]"),n=[];for(let t=0;t<i.length;t++){const s=i[t],e=s.getAttribute("custom-element")||s.getAttribute("custom-template"),o=x(s.src);e&&o&&n.push({script:s,extensionId:e,extensionVersion:o.extensionVersion})}return n}(t.document.head).some((({extensionId:t,extensionVersion:s})=>i==t&&n==s))}(i.win,n,s)?i.waitForExtension(n,s):null})).then((n=>n?e?M(t,i):function(t,i){return T(t,i)}(t,i):null));var o}(t,i,n,s,e)}(t,"story-store","amp-story","1.0"),F=t=>{return i="localization",T(E(t),i);var i},G=t=>function(t,i){const n=E(I(t));return q(n,i)?S(n,i):null}(t,"localization");function D(t,i,n,s){let e;const o=new Promise((s=>{e=function(t,i,n,s){let e=n;const o=function(t,i,n,s){let e=t,o=n,r=t=>{try{return o(t)}catch(t){var i,n;throw null===(i=(n=self).__AMP_REPORT_ERROR)||void 0===i||i.call(n,t),t}};const a=function(){if(void 0!==z)return z;z=!1;try{const t={get capture(){return z=!0,!1}};self.addEventListener("test-options",null,t),self.removeEventListener("test-options",null,t)}catch(t){}return z}(),h=!(null==s||!s.capture);return e.addEventListener(i,r,a?s:h),()=>{null==e||e.removeEventListener(i,r,a?s:h),o=null,e=null,r=null}}(t,i,(t=>{try{e(t)}finally{e=null,o()}}),s);return o}(t,i,s,n)}));return o.then(e,e),s&&s(e),o}var C="\n    #ifdef GL_FRAGMENT_PRECISION_HIGH\n      precision highp   float;\n    #else\n      precision mediump float;\n    #endif\n\n    const   float     pi = 3.14159265359;\n    uniform float     uPxSize;\n    uniform mat3      uRot;\n    uniform sampler2D uTex;\n    varying vec2      vPos;\n\n    vec4 sample(float dx, float dy) {\n      vec3 q = vec3(vPos + uPxSize * vec2(dx, dy), -1.0);\n      vec3 dir = normalize(uRot * q);\n      float u = (-0.5 / pi) * atan(dir[1], dir[0]) + 0.5;\n      float v = (1.0 / pi) * acos(dir[2]);\n      return texture2D(uTex, vec2(u, v));\n    }\n  ",L=class{static mul(t,i,n){console.assert(i.length==t*t&&n.length==t*t);const s=new Float32Array(t*t);for(let e=0;e<t;++e)for(let o=0;o<t;++o){let r=0;for(let s=0;s<t;++s)r+=i[e*t+s]*n[s*t+o];s[e*t+o]=r}return s}static identity(t){const i=new Float32Array(t*t);i.fill(0);for(let n=0;n<t;++n)i[n*t+n]=1;return i}static rotation(t,i,n,s){console.assert(i<t&&n<t);const e=L.identity(t),o=Math.cos(s),r=Math.sin(s);return e[i*t+i]=+o,e[i*t+n]=-r,e[n*t+i]=+r,e[n*t+n]=+o,e}},N=class{constructor(t){const i={alpha:!0,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:window.__AMP_TEST||!1};this.gl=t.getContext("webgl",i)||t.getContext("experimental-webgl",i),this.canvas=t,this.rotation=null,this.scale=1,this.orientation=null,this.vertShader=null,this.fragShaderFast=null,this.fragShaderSlow=null,this.progFast=null,this.progSlow=null,this.vbo=null,this.tex=null}init(){const t=this.gl;this.vertShader=t.createShader(t.VERTEX_SHADER),this.fragShaderFast=t.createShader(t.FRAGMENT_SHADER),this.fragShaderSlow=t.createShader(t.FRAGMENT_SHADER),this.progFast=t.createProgram(),this.progSlow=t.createProgram(),this.compile_(this.vertShader,"\n    uniform   vec2 uScale;\n    attribute vec2 aPos;\n    varying   vec2 vPos;\n\n    void main() {\n      gl_Position = vec4(aPos, 0.0, 1.0);\n      vPos = uScale * aPos;\n    }\n  "),t.attachShader(this.progFast,this.vertShader),t.attachShader(this.progFast,this.fragShaderFast),t.attachShader(this.progSlow,this.vertShader),t.attachShader(this.progSlow,this.fragShaderSlow),this.setMapping(),this.setCamera(L.identity(3),1),this.vbo=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.vbo);const i=new Float32Array([-1,-1,1,-1,-1,1,1,1]);t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),this.tex=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.tex),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null),t.bindBuffer(t.ARRAY_BUFFER,null),this.resize()}setImage(t){const i=this.gl;i.bindTexture(i.TEXTURE_2D,this.tex),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,t),i.bindTexture(i.TEXTURE_2D,null)}setImageOrientation(t=0,i=0,n=0){const s=Math.PI/180;this.orientation=this.euler_(s*t,s*i,s*n)}setMapping(t=""){this.compile_(this.fragShaderFast,C+"\n    void main() {\n      gl_FragColor = sample(0.0, 0.0);\n    }\n  "+t),this.compile_(this.fragShaderSlow,C+"\n    vec4 sampleSq(float dx, float dy) {\n      vec4 s = sample(dx, dy);\n      return vec4(s.xyz * s.xyz, s.w);\n    }\n\n    void main() {\n      // (2, 3) halton vector sequences.\n      vec4 acc = (1.0 / 16.0) * (\n        (((sampleSq(1.0 / 2.0 - 0.5,  1.0 / 3.0 - 0.5) +\n           sampleSq(1.0 / 4.0 - 0.5,  2.0 / 3.0 - 0.5)) +\n          (sampleSq(3.0 / 4.0 - 0.5,  1.0 / 9.0 - 0.5) +\n           sampleSq(1.0 / 8.0 - 0.5,  4.0 / 9.0 - 0.5))) +\n         ((sampleSq(5.0 / 8.0 - 0.5,  7.0 / 9.0 - 0.5) +\n           sampleSq(3.0 / 8.0 - 0.5,  2.0 / 9.0 - 0.5)) +\n          (sampleSq(7.0 / 8.0 - 0.5,  5.0 / 9.0 - 0.5) +\n           sampleSq(1.0 / 16.0 - 0.5,  8.0 / 9.0 - 0.5)))) +\n        (((sampleSq(9.0 / 16.0 - 0.5,  1.0 / 27.0 - 0.5) +\n           sampleSq(5.0 / 16.0 - 0.5, 10.0 / 27.0 - 0.5)) +\n          (sampleSq(13.0 / 16.0 - 0.5, 19.0 / 27.0 - 0.5) +\n           sampleSq(3.0 / 16.0 - 0.5,  4.0 / 27.0 - 0.5))) +\n         ((sampleSq(11.0 / 16.0 - 0.5, 13.0 / 27.0 - 0.5) +\n           sampleSq(7.0 / 16.0 - 0.5, 22.0 / 27.0 - 0.5)) +\n          (sampleSq(15.0 / 16.0 - 0.5,  7.0 / 27.0 - 0.5) +\n           sampleSq(1.0 / 32.0 - 0.5, 16.0 / 27.0 - 0.5))))\n     );\n      gl_FragColor = vec4(sqrt(acc.xyz), acc.w);\n    }\n  "+t),this.link_(this.progFast),this.link_(this.progSlow)}setCamera(t,i){this.rotation=t,this.scale=i}resize(){const t=this.canvas.getBoundingClientRect();this.canvas.width=t.width*devicePixelRatio,this.canvas.height=t.height*devicePixelRatio,this.gl.viewport(0,0,this.canvas.width,this.canvas.height)}render(t){const i=this.gl;i.disable(i.BLEND);const n=t?this.progFast:this.progSlow;i.useProgram(n);const s=this.scale/Math.sqrt(i.drawingBufferWidth*i.drawingBufferHeight),e=s*i.drawingBufferWidth,o=s*i.drawingBufferHeight;i.uniformMatrix3fv(i.getUniformLocation(n,"uRot"),!1,this.rotation),i.uniform2f(i.getUniformLocation(n,"uScale"),e,o),i.uniform1f(i.getUniformLocation(n,"uPxSize"),2*s),this.orientation||(this.orientation=L.identity(3)),i.uniformMatrix3fv(i.getUniformLocation(n,"uRot"),!1,L.mul(3,this.rotation,this.orientation)),i.enableVertexAttribArray(0),i.bindBuffer(i.ARRAY_BUFFER,this.vbo),i.vertexAttribPointer(0,2,i.FLOAT,!1,0,0),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.tex),i.uniform1i(i.getUniformLocation(n,"uTex"),0),i.drawArrays(i.TRIANGLE_STRIP,0,4),i.bindTexture(i.TEXTURE_2D,null),i.bindBuffer(i.ARRAY_BUFFER,null),i.useProgram(null)}compile_(t,i){const n=this.gl;n.shaderSource(t,i),n.compileShader(t);const s=n.getShaderInfoLog(t);s.length>0&&console.log(s)}link_(t){const i=this.gl;i.linkProgram(t);const n=i.getProgramInfoLog(t);n.length>0&&console.log(n)}euler_(t,i,n){const s=L.identity(3),e=-n,o=-i,r=-t,a=Math.cos(e),h=Math.sin(e),l=Math.cos(o),c=Math.sin(o),u=Math.cos(r),m=Math.sin(r),p=a*u,f=a*m,d=h*u,v=h*m;return s[0]=l*u,s[3]=-l*m,s[6]=c,s[1]=f+d*c,s[4]=p-v*c,s[7]=-h*l,s[2]=v-p*c,s[5]=d+f*c,s[8]=a*l,s}};function B(t,i){const n=G(i),s=R(f(i),"vsync"),e=[];return t.querySelectorAll("[i-amphtml-i18n-aria-label]").forEach((t=>{e.push(n.getLocalizedStringAsync(t.getAttribute("i-amphtml-i18n-aria-label")).then((i=>t.setAttribute("aria-label",i)))),t.removeAttribute("i-amphtml-i18n-aria-label")})),t.querySelectorAll("[i-amphtml-i18n-text-content]").forEach((i=>{e.push(n.getLocalizedStringAsync(i.getAttribute("i-amphtml-i18n-text-content")).then((n=>t.isConnected?s.mutatePromise((()=>{i.textContent=n})):i.textContent=n))),i.removeAttribute("i-amphtml-i18n-text-content")})),Promise.all(e)}var Y="-shadowcsshost",$=")(?:\\(((?:\\([^)(]*\\)|[^)(]*)+?)\\))?([^,{]*)";new RegExp("("+Y+$,"gim"),new RegExp("(-shadowcsscontext"+$,"gim"),new RegExp(Y,"gim"),new RegExp("-shadowcsscontext","gim"),new Set(["c","v","a","ad"]);var H="AMP_STORY_360";function X(t){return t*Math.PI/180}var Z=class{constructor(t,i,n){this.theta=t,this.phi=i,this.scale=n}static fromDegrees(t,i,n){return new Z(X(-i-90),X(90+t),1/n)}get rotation(){return L.mul(3,L.rotation(3,1,2,this.theta),L.rotation(3,0,1,this.phi))}},K=class extends t.BaseElement{constructor(t){super(t),this.wG=[],this.Or=0,this.MG=null,this.md=null,this.IG=null,this.mf=!1,this.EG=!1,this.SG=!1,this.TG=null,this.VG=null,this.OG=null,this.qG=!1,this.zG=null,this.jG=0,this.kG=0,this.FG=0,this.GG=null,this.ZD=null,this.DG=0,this.CG=null,this.LG=null}buildCallback(){const t=t=>this.element.getAttribute(t),i=(i,n=0)=>parseFloat(t(i)||n);t("duration")&&(this.Or=function(t,i=NaN){const n=t.toLowerCase().match(/^([0-9\.]+)\s*(s|ms)$/),s=n?n[1]:void 0,e=n?n[2]:void 0;return!n||3!==n.length||"s"!==e&&"ms"!==e?i:Math.round(("s"==e?1e3:1)*parseFloat(s))}(t("duration"))||0);const n=i("heading-start"),s=i("pitch-start"),e=i("zoom-start",1);if(this.wG.push(Z.fromDegrees(n,s,e)),void 0!==t("heading-end")||void 0!==t("pitch-end")||void 0!==t("zoom-end")){const t=i("heading-end",n),o=i("pitch-end",s),r=i("zoom-end",e);this.wG.push(Z.fromDegrees(t,o,r))}void 0===t("scene-heading")&&void 0===t("scene-pitch")&&void 0===t("scene-roll")||(this.jG=i("scene-heading"),this.kG=i("scene-pitch"),this.FG=i("scene-roll"));const o=this.element.ownerDocument.createElement("div");var r;this.MG=this.element.ownerDocument.createElement("canvas"),this.element.appendChild(o),o.appendChild(this.MG),(r=o).classList.add("i-amphtml-fill-content"),r.classList.add("i-amphtml-replaced-content");const a=new MutationObserver((t=>{this.zG=parseInt(t[0].target.getAttribute("distance"),10),this.NG()}));return this.BG()&&a.observe(this.BG(),{attributes:!0,attributeFilter:["distance"]}),Promise.all([k(this.win).then((i=>{this.VG=i,i.subscribe(39,(()=>this.YG())),"gyroscope"===t("controls")&&(i.subscribe(13,(t=>this.$G(t))),this.HG()),i.subscribe(33,(t=>{this.qG=t===this.XG(),this.ZG(),this.KG()})),this.VG.subscribe(22,(t=>{this.qG&&(t?this.Ob():this.jb())}))})),F(this.element).then((t=>{this.QG=t}))])}XG(){return null==this.OG&&(this.OG=this.BG().getAttribute("id")),this.OG}BG(){return function(t,i,n){let s;for(s=t;s&&void 0!==s;s=s.parentElement)if(i(s))return s;return null}(this.element,(t=>"amp-story-page"===t.tagName.toLowerCase()))}ZG(){this.qG?this.jb():(this.Ob(),this.UG())}NG(){this.md&&(this.zG<2?this.md.gl.isContextLost()&&this.CG.restoreContext():this.md.gl.isContextLost()||this.CG.loseContext())}$G(t){this.TG&&this.mutateElement((()=>{this.BG().removeChild(this.TG),this.TG=null})),"granted"===t?this.WG():"denied"===t&&(this.SG=!1)}HG(){void 0!==this.win.DeviceOrientationEvent&&(void 0===this.win.DeviceOrientationEvent.requestPermission&&this.WG(),"function"==typeof this.win.DeviceOrientationEvent.requestPermission&&this.win.DeviceOrientationEvent.requestPermission().catch((()=>{this.JG()})).then((t=>{t&&this.tY(t)})))}WG(){D(this.win,"deviceorientation").then((t=>{let i;this.SG=!0,this.iY(t.alpha),this.win.addEventListener("deviceorientation",(t=>{this.EG&&this.zG<2&&(i&&this.win.cancelAnimationFrame(i),i=this.win.requestAnimationFrame((()=>{this.qG||this.iY(t.alpha),this.nY(t)})))})),this.KG()}))}iY(t){this.DG=parseFloat(this.element.getAttribute("heading-end")||this.element.getAttribute("heading-start")||0)+90+t}KG(){if(this.qG&&this.SG&&!this.element.ownerDocument.querySelector(".i-amphtml-story-360-discovery")){const t=this.BG(),i=t&&p("div",{class:"i-amphtml-story-360-discovery","aria-live":"polite"},p("div",{class:"i-amphtml-story-360-discovery-animation"}),p("span",{class:"i-amphtml-story-360-discovery-text","i-amphtml-i18n-text-content":"96"}));B(i,t).then((()=>this.mutateElement((()=>t.appendChild(i)))))}}nY(t){let i=L.identity(3);i=L.mul(3,L.rotation(3,1,0,X(t.alpha-this.DG)),i),i=L.mul(3,L.rotation(3,2,1,X(t.beta)),i),i=L.mul(3,L.rotation(3,0,2,X(t.gamma)),i),this.LG=this.LG?i.map(((t,i)=>(t+this.LG[i])/2)):i,this.md.setCamera(this.LG,1),this.md.render(!0)}JG(){const t=this.BG();this.TG=t&&p("button",{class:"i-amphtml-story-360-activate-button",role:"button"},p("span",{"i-amphtml-i18n-text-content":"83"}),p("span",{class:"i-amphtml-story-360-activate-button-icon"},"360Â°",p("svg",{class:"i-amphtml-story-360-activate-button-icon-svg",xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none"},p("defs",{xmlns:"http://www.w3.org/2000/svg"},p("linearGradient",{id:"i-amphtml-story-360-activate-gradient",xmlns:"http://www.w3.org/2000/svg"},p("stop",{"stop-color":"white","stop-opacity":".3",xmlns:"http://www.w3.org/2000/svg"}),p("stop",{offset:"1","stop-color":"white",xmlns:"http://www.w3.org/2000/svg"})),p("ellipse",{id:"i-amphtml-story-360-activate-ellipse",ry:"11.5",rx:"7.5",cy:"12",cx:"12",stroke:"url(#i-amphtml-story-360-activate-gradient)",xmlns:"http://www.w3.org/2000/svg"})),p("use",{href:"#i-amphtml-story-360-activate-ellipse",xmlns:"http://www.w3.org/2000/svg"}),p("use",{href:"#i-amphtml-story-360-activate-ellipse",transform:"rotate(90, 12, 12)",xmlns:"http://www.w3.org/2000/svg"})))),B(this.TG,t),this.TG.addEventListener("click",(()=>this.sY())),this.mutateElement((()=>t.appendChild(this.TG)))}sY(){this.win.DeviceOrientationEvent.requestPermission&&this.win.DeviceOrientationEvent.requestPermission().then((t=>{this.tY(t)})).catch((t=>{(y.dev||(y.dev=_())).error(H,`Gyroscope permission error: ${t.message}`)}))}tY(t){"granted"===t?this.VG.dispatch(9,"granted"):"denied"===t&&this.VG.dispatch(9,"denied")}isLayoutSupported(t){return function(t){return"fixed"==t||"fixed-height"==t||"responsive"==t||"fill"==t||"flex-item"==t||"fluid"==t||"intrinsic"==t}(t)}eY(t){const i=this.md.gl.getParameter(this.md.gl.MAX_TEXTURE_SIZE);if(t.naturalWidth>i||t.naturalHeight>i){const n=document.createElement("canvas"),s=n.getContext("2d");return n.width=Math.min(t.naturalWidth,i),n.height=Math.min(t.naturalHeight,i),s.drawImage(t,0,0,n.width,n.height),n}return t}layoutCallback(){const t=this.element.querySelector("amp-img");this.GG=this.element.querySelector("amp-video");const i=t||this.GG;return A(i,"amp-story-360 must contain an amp-img or amp-video element."),i&&this.oY(i),t?this.rY(t):this.GG?this.aY():void 0}oY(t){const i=["alt","title","aria-label"].find((i=>t.getAttribute(i)));if(i){const n=t.getAttribute(i);this.MG.setAttribute("role","img"),this.MG.setAttribute("aria-label",n)}}rY(t){const i=j(this.element);return i.setOwner(t,this.element),i.scheduleLayout(this.element,t),h(t).then((()=>t.signals().whenSignal(s))).then((()=>{this.md=new N(this.MG),this.hY(),this.ZD=this.eY(this.element.querySelector("img")),this.lY()}),(()=>P().error(H,"Failed to load the amp-img.")))}aY(){return h(this.GG).then((()=>this.GG.signals().whenSignal(s))).then((()=>this.GG.querySelector("video").readyState>=2?i||(i=Promise.resolve(void 0)):D(this.GG,"loadeddata"))).then((()=>{this.md=new N(this.MG),this.hY(),this.lY()}),(()=>P().error(H,"Failed to load the amp-video.")))}hY(){this.CG=this.md.gl.getExtension("WEBGL_lose_context"),this.md.canvas.addEventListener("webglcontextlost",(t=>{t.preventDefault(),this.EG=!1})),this.md.canvas.addEventListener("webglcontextrestored",(()=>this.lY()))}lY(){this.md.init(),this.md.setImageOrientation(this.jG,this.kG,this.FG),this.md.setImage(this.ZD?this.ZD:this.GG.querySelector("video")),this.md.resize(),this.wG.length<1||(this.cY(),this.EG=!0,this.mf&&this.uY(),this.mY())}mY(){this.mutateElement((()=>{this.element.classList.add("i-amphtml-story-360-loaded")}))}YG(){this.mutateElement((()=>{this.md&&(this.md.resize(),this.mf||this.md.render(!1))}))}cY(){this.SG||this.mutateElement((()=>{this.md.setCamera(this.wG[0].rotation,this.wG[0].scale),this.md.render(!1)}))}get canAnimate(){return this.Or>0&&this.wG.length>1}uY(){this.IG||(this.IG=new class{constructor(t,i){this.maxFrame=.06*t,this.orientations=i,this.currentHeadingIndex=0,this.currentFrame=0,this.framesPerSection=this.maxFrame/(i.length-1)}pY(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2}getNextOrientation(){if(this.currentHeadingIndex<0||this.currentFrame==this.maxFrame-1)return null;this.currentFrame++;const t=(this.currentHeadingIndex+1)*this.framesPerSection;if(this.currentFrame>=t)return this.currentHeadingIndex++,this.currentHeadingIndex==this.orientations.length?(this.currentHeadingIndex=-1,null):this.orientations[this.currentHeadingIndex];const i=this.orientations[this.currentHeadingIndex+1],n=this.orientations[this.currentHeadingIndex];if(!i)return this.currentHeadingIndex=-1,null;const s=this.pY(this.currentFrame%this.framesPerSection/this.framesPerSection);return new Z(n.theta+(i.theta-n.theta)*s,n.phi+(i.phi-n.phi)*s,n.scale+(i.scale-n.scale)*s)}}(this.Or,this.wG));const t=()=>{if(!this.mf||!this.IG)return void this.md.render(!1);const i=this.IG.getNextOrientation();this.win.requestAnimationFrame((()=>{if(!i&&!this.GG)return this.mf=!1,void this.md.render(!1);if(i&&!this.SG&&this.md.setCamera(i.rotation,i.scale),this.GG){const t=this.GG.querySelector("video");t.readyState>=2&&this.md.setImage(t)}this.md.render(!0),t()}))};this.mutateElement((()=>t()))}Ob(){this.mf=!1}jb(){this.canAnimate&&(A(this.canAnimate,"amp-story-360 is either not configured to play an animation or still loading content."),this.mf=!0,this.EG&&this.uY())}UG(){this.canAnimate&&(this.IG=null,this.EG&&this.win.requestAnimationFrame((()=>{this.cY(),this.mf&&this.uY()})))}};t.registerElement("amp-story-360",K,'amp-story-360 canvas{position:absolute;width:100%!important;height:100%!important}amp-story-360 amp-img{opacity:0!important}.i-amphtml-story-360-activate-button{position:absolute!important;bottom:12px!important;right:12px!important;background:rgba(0,0,0,.8)!important;color:#fff!important;outline:none!important;border:none!important;padding:6px 6px 6px 10px!important;border-radius:18px!important;font-size:12px!important;font-family:Roboto,sans-serif!important;z-index:100000!important}.i-amphtml-story-360-activate-button,.i-amphtml-story-360-activate-button-icon{display:-ms-flexbox!important;display:flex!important;-ms-flex-align:center!important;align-items:center!important}.i-amphtml-story-360-activate-button-icon{box-sizing:border-box!important;margin-left:5px!important;font-size:6px!important;width:24px!important;height:24px!important;border:1px solid #fff!important;border-radius:100%!important;-ms-flex-pack:center!important;justify-content:center!important;font-weight:700!important;position:relative!important}.i-amphtml-story-360-activate-button-icon-svg{position:absolute!important;width:calc(100% + 2px)!important;height:calc(100% + 2px)!important;left:-1px!important;top:-1px!important}[active] .i-amphtml-story-360-activate-button-icon-svg{animation:rotate 1s 1s!important}@keyframes rotate{to{transform:rotate(360deg)}}.i-amphtml-story-360-discovery{pointer-events:none!important;position:absolute!important;bottom:0!important;left:0!important;width:100%!important;height:66%!important;perspective:550px!important;perspective-origin:center calc(100% - 145px)!important;background:linear-gradient(transparent,rgba(0,0,0,.9))!important;animation:fadeOut 1s ease-in-out 4s forwards!important;z-index:100000!important}@keyframes fadeOut{0%{opacity:1}to{opacity:0}}.i-amphtml-story-360-discovery-animation{position:absolute!important;bottom:95px!important;left:calc(50% - 30px)!important;width:55px!important;height:100px!important;border:1px solid #fff!important;border-radius:10px!important;animation:lookAround 4s!important}.i-amphtml-story-360-discovery-animation:before{content:""!important;position:absolute!important;border-top:1px solid #fff!important;width:10px!important;top:5px!important;left:calc(50% - 5px)!important}@keyframes lookAround{0%{animation-timing-function:ease-in-out;transform:rotate3d(0,0,0,0) translateZ(0)}25%{animation-timing-function:ease-in-out;transform:rotateY(45deg) rotateX(20deg) translate3d(-100px,10px,0)}50%{animation-timing-function:ease-in-out;transform:rotateX(-40deg) translate3d(0,-50px,0)}75%{animation-timing-function:ease-in-out;transform:rotateY(-45deg) rotateX(20deg) translate3d(100px,10px,0)}to{animation-timing-function:ease-in-out;transform:rotate3d(0,0,0,0) translateZ(0)}}.i-amphtml-story-360-discovery-text{font-family:Roboto,sans-serif!important;position:absolute!important;bottom:40px!important;width:100%!important;font-size:16px!important;text-align:center!important;color:#fff!important}\n/*# sourceURL=/extensions/amp-story-360/0.1/amp-story-360.css*/')})();
/*! https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
/**
* @license
* Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
* Use of this source code is governed by a BSD-style
* license that can be found in the LICENSE file or at
* https://developers.google.com/open-source/licenses/bsd
*/}});
//# sourceMappingURL=amp-story-360-0.1.mjs.map